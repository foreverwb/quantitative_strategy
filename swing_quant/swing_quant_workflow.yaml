app:
  description: è¾“å…¥1-3ä¸ªç¾è‚¡ä»£ç è·å–å‘½ä»¤æ¸…å•,æˆ–å›ä¼ æ•°æ®è·å–å®Œæ•´åˆ†æã€‚
  icon: ğŸ¤–
  icon_background: '#FCE7F3'
  mode: advanced-chat
  name: swing
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/openai_api_compatible:0.0.24@2266d6adfeafd3a161ba4a033553f4ff8a8b1d07be54f4b11ce9e68032889ac3
    version: null
kind: app
version: 0.4.0
workflow:
  conversation_variables: []
  environment_variables:
  - description: IVè·¯å¾„ç›¸å¯¹å˜åŒ–é˜ˆå€¼ç™¾åˆ†æ¯”, é˜ˆå€¼=max(2 volç‚¹, 8â€“10%ç›¸å¯¹å˜åŒ–)
    id: 6947dc09-d0c3-4aef-aade-6474c620628c
    name: IV_PATH_THRESHOLD_PCT
    selector:
    - env
    - IV_PATH_THRESHOLD_PCT
    value: '10'
    value_type: string
  - description: å¢™è¯†åˆ«ç°‡å®½åº¦ï¼ˆç°‡å®½ â‰¥ X ç›¸é‚»è¡Œæƒä»·ï¼‰ç°‡å®½â‰¥3ç›¸é‚»è¡Œæƒ
    id: 0e92e13b-cfa8-4210-87d6-5332dde7f755
    name: WALL_CLUSTER_WIDTH
    selector:
    - env
    - WALL_CLUSTER_WIDTH
    value: '3'
    value_type: string
  - description: 'å¢™è¯†åˆ«å³°å€¼å€æ•°ï¼ˆå±€éƒ¨å³° â‰¥ ç›¸é‚»Î³ä¸­ä½æ•° Ã— æ­¤å€æ•°ï¼‰

      å±€éƒ¨å³°â‰¥ç›¸é‚»Î³ä¸­ä½æ•°2å€'
    id: 0d039297-a8fd-4d8e-9475-3adb3f04e925
    name: WALL_PEAK_MULTIPLIER
    selector:
    - env
    - WALL_PEAK_MULTIPLIER
    value: '2.0'
    value_type: string
  - description: æœˆåº¦ä¸­æœŸDTEï¼ˆå½“æ— å‘¨åº¦æ•°æ®æ—¶ä½¿ç”¨ï¼‰
    id: d3156f30-66b4-4f28-a246-e9d8e5e31512
    name: DEFAULT_DTE_MONTHLY_MID
    selector:
    - env
    - DEFAULT_DTE_MONTHLY_MID
    value: '60'
    value_type: string
  - description: ''
    id: 9f7b2a95-fbb2-4032-a689-462f20895111
    name: ALPHA_VANTAGE_API_URL
    selector:
    - env
    - ALPHA_VANTAGE_API_URL
    value: https://www.alphavantage.co/query?
    value_type: string
  - description: ''
    id: 34e50e26-0669-4732-be92-45ae7ff2f4d4
    name: EM1_SQRT_FACTOR
    selector:
    - env
    - EM1_SQRT_FACTOR
    value: '0.06299'
    value_type: string
  - description: ''
    id: 56816405-1daf-4126-8efb-4f753d1375c8
    name: BREAK_WALL_THRESHOLD_LOW
    selector:
    - env
    - BREAK_WALL_THRESHOLD_LOW
    value: '0.4'
    value_type: string
  - description: ''
    id: 3ea750ec-3a32-4500-8fdf-f07acfe1323d
    name: BREAK_WALL_THRESHOLD_HIGH
    selector:
    - env
    - BREAK_WALL_THRESHOLD_HIGH
    value: '0.8'
    value_type: string
  - description: ''
    id: 6e5c1b25-eb44-4858-bcc1-968cf45ae95d
    name: MONTHLY_OVERRIDE_THRESHOLD
    selector:
    - env
    - MONTHLY_OVERRIDE_THRESHOLD
    value: '0.7'
    value_type: string
  - description: ''
    id: 42035f4f-962e-4d41-a3aa-13d4bc86f4c8
    name: MONTHLY_CLUSTER_STRENGTH_RATIO
    selector:
    - env
    - MONTHLY_CLUSTER_STRENGTH_RATIO
    value: '1.5'
    value_type: string
  - description: ''
    id: 1175c26c-d2b4-4e1c-800e-06be95429cd6
    name: CLUSTER_STRENGTH_THRESHOLD_TREND
    selector:
    - env
    - CLUSTER_STRENGTH_THRESHOLD_TREND
    value: '1.2'
    value_type: string
  - description: ''
    id: d1f43157-5c94-4f96-9fc5-40d58dc90dca
    name: CLUSTER_STRENGTH_THRESHOLD_STRONG
    selector:
    - env
    - CLUSTER_STRENGTH_THRESHOLD_STRONG
    value: '2.0'
    value_type: string
  - description: ''
    id: d699a30e-4d47-45f1-99a6-f2bf8ef10683
    name: DEX_SAME_DIR_THRESHOLD_STRONG
    selector:
    - env
    - DEX_SAME_DIR_THRESHOLD_STRONG
    value: '70'
    value_type: string
  - description: ''
    id: a6206f27-187f-49f5-85c5-b21b0ca55cd1
    name: DEX_SAME_DIR_THRESHOLD_MEDIUM
    selector:
    - env
    - DEX_SAME_DIR_THRESHOLD_MEDIUM
    value: '60'
    value_type: string
  - description: ''
    id: 1b2e29d4-4b33-4cc6-9e9f-aa81d1391ce8
    name: DEX_SAME_DIR_THRESHOLD_WEAK
    selector:
    - env
    - DEX_SAME_DIR_THRESHOLD_WEAK
    value: '50'
    value_type: string
  - description: ''
    id: ca32c770-d806-4659-944a-d4c899b5aa2b
    name: IV_PATH_THRESHOLD_VOL
    selector:
    - env
    - IV_PATH_THRESHOLD_VOL
    value: '2'
    value_type: string
  - description: ''
    id: 75b790bc-d2a1-4324-b8cf-5467923ba39b
    name: IV_NOISE_THRESHOLD
    selector:
    - env
    - IV_NOISE_THRESHOLD
    value: '30'
    value_type: string
  - description: ''
    id: a42bcd57-8084-4742-a674-468ff4b1eb23
    name: DEFAULT_STRIKES
    selector:
    - env
    - DEFAULT_STRIKES
    value: '25'
    value_type: string
  - description: ''
    id: bff94012-d3ef-4243-899a-6b838cfbd9f9
    name: DEFAULT_NET_WINDOW
    selector:
    - env
    - DEFAULT_NET_WINDOW
    value: '60'
    value_type: string
  - description: ''
    id: 9c062833-fabc-4f9a-871e-edab861724b8
    name: EXTENDED_NET_WINDOW
    selector:
    - env
    - EXTENDED_NET_WINDOW
    value: '120'
    value_type: string
  - description: ''
    id: 159562a1-174f-49f5-bc6f-e2eb5132b18c
    name: DEFAULT_DTE_WEEKLY_SHORT
    selector:
    - env
    - DEFAULT_DTE_WEEKLY_SHORT
    value: '7'
    value_type: string
  - description: ''
    id: d8ca77db-2afc-4c56-a951-0467f8337406
    name: DEFAULT_DTE_WEEKLY_MID
    selector:
    - env
    - DEFAULT_DTE_WEEKLY_MID
    value: '14'
    value_type: string
  - description: ''
    id: c98f3d63-3e41-40d2-8900-ea09dae59bce
    name: DEFAULT_DTE_MONTHLY_SHORT
    selector:
    - env
    - DEFAULT_DTE_MONTHLY_SHORT
    value: '30'
    value_type: string
  - description: ''
    id: 415be580-c0e0-42b6-8b96-455023aaf1a7
    name: DEFAULT_INDEX_PRIMARY
    selector:
    - env
    - DEFAULT_INDEX_PRIMARY
    value: SPX
    value_type: string
  - description: ''
    id: d25ff9d2-7196-440b-9e44-23246e12f4fd
    name: DEFAULT_INDEX_SECONDARY
    selector:
    - env
    - DEFAULT_INDEX_SECONDARY
    value: QQQ
    value_type: string
  - description: ''
    id: e1128bdc-b017-4da3-8493-fc1325cbaf10
    name: SCORE_WEIGHT_GAMMA_REGIME
    selector:
    - env
    - SCORE_WEIGHT_GAMMA_REGIME
    value: '0.4'
    value_type: string
  - description: ''
    id: fc04500c-157d-4ec8-beea-d651828da32e
    name: SCORE_WEIGHT_BREAK_WALL
    selector:
    - env
    - SCORE_WEIGHT_BREAK_WALL
    value: '0.3'
    value_type: string
  - description: ''
    id: 5d072a9d-5fe4-48be-80d4-7ed90134c275
    name: SCORE_WEIGHT_DIRECTION
    selector:
    - env
    - SCORE_WEIGHT_DIRECTION
    value: '0.2'
    value_type: string
  - description: ''
    id: c1c3da25-7559-49d5-aa25-8b46ed02e6b2
    name: SCORE_WEIGHT_IV
    selector:
    - env
    - SCORE_WEIGHT_IV
    value: '0.1'
    value_type: string
  - description: ''
    id: fae0be53-9900-4354-a2c3-1e2f6c013404
    name: TECHNICAL_SCORE_MAX
    selector:
    - env
    - TECHNICAL_SCORE_MAX
    value: '2'
    value_type: string
  - description: ''
    id: 27b59ab6-298e-41d9-8cfe-0b5aac4c6be3
    name: ENTRY_THRESHOLD_SCORE
    selector:
    - env
    - ENTRY_THRESHOLD_SCORE
    value: '3'
    value_type: string
  - description: ''
    id: f31e374b-b544-43bb-a19b-c2248099572d
    name: ENTRY_THRESHOLD_PROBABILITY
    selector:
    - env
    - ENTRY_THRESHOLD_PROBABILITY
    value: '60'
    value_type: string
  - description: ''
    id: 8f84deb9-de9c-4d39-8d2f-71d9a141c43c
    name: LIGHT_POSITION_PROBABILITY
    selector:
    - env
    - LIGHT_POSITION_PROBABILITY
    value: '50'
    value_type: string
  - description: ''
    id: 2e9f3d79-055e-475c-b532-6d877601d0f4
    name: MAX_SINGLE_RISK_PCT
    selector:
    - env
    - MAX_SINGLE_RISK_PCT
    value: '2'
    value_type: string
  - description: ''
    id: 338fc286-e85f-49a5-b878-1e590ebde245
    name: MAX_TOTAL_EXPOSURE_PCT
    selector:
    - env
    - MAX_TOTAL_EXPOSURE_PCT
    value: '10'
    value_type: string
  - description: ''
    id: f065de1d-7ad8-43e4-bd82-2269277505db
    name: DTE_GAP_HIGH_THRESHOLD
    selector:
    - env
    - DTE_GAP_HIGH_THRESHOLD
    value: '3'
    value_type: string
  - description: ''
    id: c5f348f3-ae62-483b-9c7d-feac529d7eef
    name: DTE_GAP_MID_THRESHOLD
    selector:
    - env
    - DTE_GAP_MID_THRESHOLD
    value: '2'
    value_type: string
  - description: ''
    id: fb7fedab-92c3-43ef-b576-7356fa0040fc
    name: DTE_MONTHLY_ADJUSTMENT
    selector:
    - env
    - DTE_MONTHLY_ADJUSTMENT
    value: '7'
    value_type: string
  - description: ''
    id: 00ce1d05-c506-45bb-8908-fb594b659983
    name: PW_CREDIT_BASE
    selector:
    - env
    - PW_CREDIT_BASE
    value: '0.5'
    value_type: string
  - description: ''
    id: 79b63b13-4f69-4045-9189-6f31050b550e
    name: PW_CREDIT_CLUSTER_COEF
    selector:
    - env
    - PW_CREDIT_CLUSTER_COEF
    value: '0.1'
    value_type: string
  - description: ''
    id: 0e39310c-a22c-47dc-95ee-793583183a82
    name: PW_CREDIT_DISTANCE_PENALTY_COEF
    selector:
    - env
    - PW_CREDIT_DISTANCE_PENALTY_COEF
    value: '0.05'
    value_type: string
  - description: ''
    id: 1452f6c4-9241-4bf9-b87f-88d2eaf603f7
    name: PW_CREDIT_MIN
    selector:
    - env
    - PW_CREDIT_MIN
    value: '0.4'
    value_type: string
  - description: ''
    id: 78159142-1ebb-4426-8140-7ccfaa771402
    name: PW_CREDIT_MAX
    selector:
    - env
    - PW_CREDIT_MAX
    value: '0.85'
    value_type: string
  - description: ''
    id: c7a44894-02d2-4375-a48b-b8a4218153f0
    name: PW_DEBIT_BASE
    selector:
    - env
    - PW_DEBIT_BASE
    value: '0.3'
    value_type: string
  - description: ''
    id: ab70607c-9c90-4d3e-8159-ee15c883f3b5
    name: PW_DEBIT_MIN
    selector:
    - env
    - PW_DEBIT_MIN
    value: '0.25'
    value_type: string
  - description: ''
    id: 356ac996-0540-4cf1-9531-9d3851698a53
    name: PW_DEBIT_MAX
    selector:
    - env
    - PW_DEBIT_MAX
    value: '0.75'
    value_type: string
  - description: ''
    id: 1d22dba3-e96f-4d77-a64f-a234739cb6c1
    name: PW_BUTTERFLY_BODY_INSIDE
    selector:
    - env
    - PW_BUTTERFLY_BODY_INSIDE
    value: '0.65'
    value_type: string
  - description: ''
    id: 23fb0ba8-d974-40de-bbaf-56da24f61f49
    name: PW_BUTTERFLY_BODY_OFFSET_1EM
    selector:
    - env
    - PW_BUTTERFLY_BODY_OFFSET_1EM
    value: '0.45'
    value_type: string
  - description: ''
    id: 2eb9a9cc-a1a3-4ced-af39-ceb1f1371bb1
    name: ENABLE_EARNINGS_API
    selector:
    - env
    - ENABLE_EARNINGS_API
    value: 'true'
    value_type: string
  - description: ''
    id: 7bc4ee89-7d0a-4015-ae7f-5bff22bbbe3c
    name: EARNINGS_CACHE_DAYS
    selector:
    - env
    - EARNINGS_CACHE_DAYS
    value: '30'
    value_type: string
  - description: ''
    id: ee0efa9d-cb6d-4973-bbed-257750b991b6
    name: ALPHA_VANTAGE_API_KEY
    selector:
    - env
    - ALPHA_VANTAGE_API_KEY
    value: TKV2HLJJYKSRGR
    value_type: string
  - description: ä¿å®ˆç­–ç•¥Deltaæœ€å°å€¼ï¼ˆæ¥è¿‘ä¸­æ€§ï¼‰
    id: e5f67890-abcd-ef12-3456-7890abcdef12
    name: CONSERVATIVE_DELTA_MIN
    selector:
    - env
    - CONSERVATIVE_DELTA_MIN
    value: '-0.1'
    value_type: string
  - description: ä¿å®ˆç­–ç•¥Deltaæœ€å¤§å€¼ï¼ˆæ¥è¿‘ä¸­æ€§ï¼‰
    id: f6789012-abcd-ef12-3456-7890abcdef23
    name: CONSERVATIVE_DELTA_MAX
    selector:
    - env
    - CONSERVATIVE_DELTA_MAX
    value: '0.1'
    value_type: string
  - description: ä¿å®ˆç­–ç•¥Thetaæœ€å°å€¼ï¼ˆæ—¶é—´ä»·å€¼è¡°å‡æ”¶ç›Šï¼‰
    id: 67890123-abcd-ef12-3456-7890abcdef34
    name: CONSERVATIVE_THETA_MIN
    selector:
    - env
    - CONSERVATIVE_THETA_MIN
    value: '5.0'
    value_type: string
  - description: ä¿å®ˆç­–ç•¥Vegaæœ€å¤§å€¼ï¼ˆåšç©ºæ³¢åŠ¨ç‡ï¼‰
    id: 78901234-abcd-ef12-3456-7890abcdef45
    name: CONSERVATIVE_VEGA_MAX
    selector:
    - env
    - CONSERVATIVE_VEGA_MAX
    value: '-10.0'
    value_type: string
  - description: å‡è¡¡ç­–ç•¥DeltaèŒƒå›´ï¼ˆÂ±æ­¤å€¼ï¼‰
    id: 89012345-abcd-ef12-3456-7890abcdef56
    name: BALANCED_DELTA_RANGE
    selector:
    - env
    - BALANCED_DELTA_RANGE
    value: '0.2'
    value_type: string
  - description: å‡è¡¡ç­–ç•¥Thetaæœ€å°å€¼
    id: 90123456-abcd-ef12-3456-7890abcdef67
    name: BALANCED_THETA_MIN
    selector:
    - env
    - BALANCED_THETA_MIN
    value: '8.0'
    value_type: string
  - description: è¿›å–ç­–ç•¥Deltaæœ€å°å€¼ï¼ˆæ˜ç¡®æ–¹å‘ï¼‰
    id: 01234567-abcd-ef12-3456-7890abcdef78
    name: AGGRESSIVE_DELTA_MIN
    selector:
    - env
    - AGGRESSIVE_DELTA_MIN
    value: '0.3'
    value_type: string
  - description: è¿›å–ç­–ç•¥Deltaæœ€å¤§å€¼
    id: 12345678-abcd-ef12-3456-7890abcdef89
    name: AGGRESSIVE_DELTA_MAX
    selector:
    - env
    - AGGRESSIVE_DELTA_MAX
    value: '0.6'
    value_type: string
  - description: è¿›å–ç­–ç•¥Vegaæœ€å°å€¼ï¼ˆåšå¤šæ³¢åŠ¨ç‡ï¼‰
    id: 23456789-abcd-ef12-3456-7890abcdef90
    name: AGGRESSIVE_VEGA_MIN
    selector:
    - env
    - AGGRESSIVE_VEGA_MIN
    value: '10.0'
    value_type: string
  - description: ä¿å®ˆç­–ç•¥Longè…¿åç§»ï¼ˆÃ— EM1$ï¼‰
    id: 34567890-abcd-ef12-3456-7890abcdefa1
    name: STRIKE_CONSERVATIVE_LONG_OFFSET
    selector:
    - env
    - STRIKE_CONSERVATIVE_LONG_OFFSET
    value: '1.5'
    value_type: string
  - description: å‡è¡¡ç­–ç•¥Wingåç§»ï¼ˆÃ— EM1$ï¼‰
    id: 45678901-abcd-ef12-3456-7890abcdefa2
    name: STRIKE_BALANCED_WING_OFFSET
    selector:
    - env
    - STRIKE_BALANCED_WING_OFFSET
    value: '1.0'
    value_type: string
  - description: æ¯”ç‡ä»·å·®å–æ–¹åç§»ï¼ˆÃ— EM1$ï¼‰
    id: 56789012-abcd-ef12-3456-7890abcdefa3
    name: STRIKE_RATIO_SHORT_OFFSET
    selector:
    - env
    - STRIKE_RATIO_SHORT_OFFSET
    value: '0.5'
    value_type: string
  - description: æ¯”ç‡ä»·å·®ä¹°æ–¹åç§»ï¼ˆÃ— EM1$ï¼‰
    id: 67890123-abcd-ef12-3456-7890abcdefa4
    name: STRIKE_RATIO_LONG_OFFSET
    selector:
    - env
    - STRIKE_RATIO_LONG_OFFSET
    value: '1.5'
    value_type: string
  - description: è¿›å–ç­–ç•¥Longè…¿åç§»ï¼ˆÃ— EM1$ï¼‰
    id: 78901234-abcd-ef12-3456-7890abcdefa5
    name: STRIKE_AGGRESSIVE_LONG_OFFSET
    selector:
    - env
    - STRIKE_AGGRESSIVE_LONG_OFFSET
    value: '0.2'
    value_type: string
  - description: ä¿¡ç”¨ä»·å·®æœ€å°å®½åº¦ï¼ˆÃ— EM1$ï¼‰
    id: 89012345-abcd-ef12-3456-7890abcdefa6
    name: WIDTH_CREDIT_MIN
    selector:
    - env
    - WIDTH_CREDIT_MIN
    value: '0.8'
    value_type: string
  - description: ä¿¡ç”¨ä»·å·®æœ€å¤§å®½åº¦ï¼ˆÃ— EM1$ï¼‰
    id: 90123456-abcd-ef12-3456-7890abcdefa7
    name: WIDTH_CREDIT_MAX
    selector:
    - env
    - WIDTH_CREDIT_MAX
    value: '1.0'
    value_type: string
  - description: å€Ÿè´·ä»·å·®æœ€å°å®½åº¦ï¼ˆÃ— EM1$ï¼‰
    id: 01234567-abcd-ef12-3456-7890abcdefa8
    name: WIDTH_DEBIT_MIN
    selector:
    - env
    - WIDTH_DEBIT_MIN
    value: '1.0'
    value_type: string
  - description: å€Ÿè´·ä»·å·®æœ€å¤§å®½åº¦ï¼ˆÃ— EM1$ï¼‰
    id: 12345678-abcd-ef12-3456-7890abcdefa9
    name: WIDTH_DEBIT_MAX
    selector:
    - env
    - WIDTH_DEBIT_MAX
    value: '1.2'
    value_type: string
  - description: ä¿¡ç”¨ä»·å·®IVR 0-25%æ—¶çš„credit ratio
    id: 23456789-abcd-ef12-3456-7890abcdefb0
    name: CREDIT_IVR_0_25
    selector:
    - env
    - CREDIT_IVR_0_25
    value: '0.20'
    value_type: string
  - description: ä¿¡ç”¨ä»·å·®IVR 25-50%æ—¶çš„credit ratio
    id: 34567890-abcd-ef12-3456-7890abcdefb1
    name: CREDIT_IVR_25_50
    selector:
    - env
    - CREDIT_IVR_25_50
    value: '0.30'
    value_type: string
  - description: ä¿¡ç”¨ä»·å·®IVR 50-75%æ—¶çš„credit ratio
    id: 45678901-abcd-ef12-3456-7890abcdefb2
    name: CREDIT_IVR_50_75
    selector:
    - env
    - CREDIT_IVR_50_75
    value: '0.40'
    value_type: string
  - description: ä¿¡ç”¨ä»·å·®IVR 75-100%æ—¶çš„credit ratio
    id: 56789012-abcd-ef12-3456-7890abcdefb3
    name: CREDIT_IVR_75_100
    selector:
    - env
    - CREDIT_IVR_75_100
    value: '0.50'
    value_type: string
  - description: å€Ÿè´·ä»·å·®IVR 0-40%æ—¶çš„debit ratio
    id: 67890123-abcd-ef12-3456-7890abcdefb4
    name: DEBIT_IVR_0_40
    selector:
    - env
    - DEBIT_IVR_0_40
    value: '0.30'
    value_type: string
  - description: å€Ÿè´·ä»·å·®IVR 40-70%æ—¶çš„debit ratio
    id: 78901234-abcd-ef12-3456-7890abcdefb5
    name: DEBIT_IVR_40_70
    selector:
    - env
    - DEBIT_IVR_40_70
    value: '0.40'
    value_type: string
  - description: å€Ÿè´·ä»·å·®IVR 70-100%æ—¶çš„debit ratio
    id: 89012345-abcd-ef12-3456-7890abcdefb6
    name: DEBIT_IVR_70_100
    selector:
    - env
    - DEBIT_IVR_70_100
    value: '0.50'
    value_type: string
  - description: Pwå€Ÿè´·è®¡ç®—ä¸­çš„DEXç³»æ•°
    id: 90123456-abcd-ef12-3456-7890abcdefb7
    name: PW_DEBIT_DEX_COEF
    selector:
    - env
    - PW_DEBIT_DEX_COEF
    value: '0.1'
    value_type: string
  - description: Pwå€Ÿè´·è®¡ç®—ä¸­çš„Vannaç³»æ•°
    id: 01234567-abcd-ef12-3456-7890abcdefb8
    name: PW_DEBIT_VANNA_COEF
    selector:
    - env
    - PW_DEBIT_VANNA_COEF
    value: '0.2'
    value_type: string
  - description: ä¿¡ç”¨ç­–ç•¥æ­¢ç›ˆç›®æ ‡ï¼ˆæƒåˆ©é‡‘è¡°å‡è‡³å‰©ä½™%ï¼‰
    id: 12345678-abcd-ef12-3456-7890abcdefb9
    name: PROFIT_TARGET_CREDIT_PCT
    selector:
    - env
    - PROFIT_TARGET_CREDIT_PCT
    value: '30'
    value_type: string
  - description: å€Ÿè´·ç­–ç•¥æ­¢ç›ˆç›®æ ‡ï¼ˆæµ®ç›ˆ%ï¼‰
    id: 23456789-abcd-ef12-3456-7890abcdefc0
    name: PROFIT_TARGET_DEBIT_PCT
    selector:
    - env
    - PROFIT_TARGET_DEBIT_PCT
    value: '60'
    value_type: string
  - description: å€Ÿè´·ç­–ç•¥æ­¢æŸçº¿ï¼ˆäºæŸ%ï¼‰
    id: 34567890-abcd-ef12-3456-7890abcdefc1
    name: STOP_LOSS_DEBIT_PCT
    selector:
    - env
    - STOP_LOSS_DEBIT_PCT
    value: '50'
    value_type: string
  - description: ä¿¡ç”¨ç­–ç•¥æ­¢æŸçº¿ï¼ˆæµ®äºè¾¾æƒåˆ©é‡‘%ï¼‰
    id: 45678901-abcd-ef12-3456-7890abcdefc2
    name: STOP_LOSS_CREDIT_PCT
    selector:
    - env
    - STOP_LOSS_CREDIT_PCT
    value: '150'
    value_type: string
  - description: åˆ°æœŸå‰å¼ºåˆ¶å¹³ä»“å¤©æ•°
    id: 56789012-abcd-ef12-3456-7890abcdefc3
    name: TIME_DECAY_EXIT_DAYS
    selector:
    - env
    - TIME_DECAY_EXIT_DAYS
    value: '3'
    value_type: string
  features:
    file_upload:
      allowed_file_extensions:
      - .JPG
      - .JPEG
      - .PNG
      - .GIF
      - .WEBP
      - .SVG
      allowed_file_types:
      - image
      allowed_file_upload_methods:
      - local_file
      - remote_url
      enabled: false
      fileUploadConfig:
        audio_file_size_limit: 50
        batch_count_limit: 5
        file_size_limit: 15
        image_file_size_limit: 10
        video_file_size_limit: 100
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 3
    opening_statement: ä½ å¥½!æˆ‘æ˜¯æ‚¨çš„ç¾è‚¡æœŸæƒåˆ†æå¸ˆã€‚è¯·è¾“å…¥1-3ä¸ªç¾è‚¡ä»£ç (ä¾‹å¦‚:AAPL æˆ– NVDA, TSLA)
    retriever_resource:
      enabled: false
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions:
    - AAPL
    - NVDA, TSLA
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: start
        targetType: llm
      id: edge-1001-1002
      selected: false
      source: '1001'
      sourceHandle: source
      target: '1002'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: if-else
      id: edge-1002-1003
      selected: false
      source: '1002'
      sourceHandle: source
      target: '1003'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: edge-1003-2002
      selected: false
      source: '1003'
      sourceHandle: source
      target: '2002'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: answer
      id: edge-2002-2003
      selected: false
      source: '2002'
      sourceHandle: source
      target: '2003'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: edge-1003-3001
      selected: false
      source: '1003'
      sourceHandle: source
      target: '3001'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: if-else
      id: edge-3001-3002
      selected: false
      source: '3001'
      sourceHandle: source
      target: '3002'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: answer
      id: edge-3002-3003
      selected: false
      source: '3002'
      sourceHandle: source
      target: '3003'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: edge-3002-4001
      selected: false
      source: '3002'
      sourceHandle: source
      target: '4001'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: 1003-case-ticker-2002-target
      selected: false
      source: '1003'
      sourceHandle: case-ticker
      target: '2002'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: answer
      id: 3002-case-missing-3003-target
      selected: false
      source: '3002'
      sourceHandle: case-missing
      target: '3003'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: 1003-case-data-3001-target
      selected: false
      source: '1003'
      sourceHandle: case-data
      target: '3001'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: 3002-case-ready-4001-target
      selected: false
      source: '3002'
      sourceHandle: case-ready
      target: '4001'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: code
      id: 3002-case-ready-1004-target
      selected: false
      source: '3002'
      sourceHandle: case-ready
      target: '1004'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: code
      id: 4001--1007-target
      selected: false
      source: '4001'
      sourceHandle: source
      target: '1007'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: code
        targetType: code
      id: 1004-source-1007-target
      selected: false
      source: '1004'
      sourceHandle: source
      target: '1007'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: code
        targetType: llm
      id: 1007-source-5001-target
      selected: false
      source: '1007'
      sourceHandle: source
      target: '5001'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: llm
      id: 1005-source-7001-target
      selected: false
      source: '1005'
      sourceHandle: source
      target: '7001'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: answer
      id: 7001-source-7002-target
      selected: false
      source: '7001'
      sourceHandle: source
      target: '7002'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: code
      id: 5001-source-1006-target
      selected: false
      source: '5001'
      sourceHandle: source
      target: '1006'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: code
        targetType: llm
      id: 1006-source-6001-target
      selected: false
      source: '1006'
      sourceHandle: source
      target: '6001'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: llm
      id: 6001-source-1005-target
      selected: false
      source: '6001'
      sourceHandle: source
      target: '1005'
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        desc: ''
        selected: false
        title: user input
        type: start
        variables:
        - label: query
          max_length: 15000
          options: []
          required: true
          type: text-input
          variable: query
      height: 88
      id: '1001'
      position:
        x: 30
        y: 300
      positionAbsolute:
        x: 30
        y: 300
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: æ ¹æ®ç”¨æˆ·è¾“å…¥ï¼Œåˆ¤æ–­æ˜¯æ–°ä»»åŠ¡ï¼ˆTickerï¼‰è¿˜æ˜¯æ•°æ®å›ä¼ ï¼ˆDataï¼‰ã€‚
        model:
          completion_params:
            temperature: 0.3
          mode: chat
          name: Qwen3-8B
          provider: langgenius/openai_api_compatible/openai_api_compatible
        prompt_template:
        - id: sys-router
          role: system
          text: "ä½ æ˜¯ä¸€ä¸ªè·¯ç”±åŠ©æ‰‹ã€‚ä½ çš„å”¯ä¸€ä»»åŠ¡æ˜¯åˆ¤æ–­ç”¨æˆ·è¾“å…¥å±äºä»¥ä¸‹å“ªä¸€ç±»,å¹¶ä»…è¾“å‡º \"SYMBOL\", \"DATA\", æˆ– \"INVALID\"\
            ã€‚\n\n1. \"TICKER\": å¦‚æœæ¶ˆæ¯ä¸­åŒ…å«1-3ä¸ªç¬¦åˆç¾è‚¡ä»£ç æ ¼å¼çš„å­—ç¬¦ä¸²(ä¾‹å¦‚:AAPL, MSFT, \"amzn us\"\
            , \"tsla\"),å¹¶ä¸”ä¸åŒ…å« \"!gexr\" æˆ– \"SPOT PRICE\" ç­‰æ•°æ®ç‰¹å¾ã€‚\n   - æ­£åˆ™(å‚è€ƒ):(^|[^A-Z])([A-Za-z]{1,5})(?:\\\
            s*,\\s*([A-Za-z]{1,5})){0,2}([^A-Z]|$)\n\n2. \"DATA\": å¦‚æœæ¶ˆæ¯ä¸­åŒ…å«æ•°æ®ç‰¹å¾è¯,å¦‚\
            \ \"!gexr\", \"!skew\", \"SPOT PRICE\", \"Call Wall\", \"EM1$\" ç­‰ã€‚\n\n\
            3. \"INVALID\": å…¶ä»–æ‰€æœ‰æƒ…å†µã€‚\n\nã€ä½ çš„åˆ¤æ–­ã€‘(SYMBOL, DATA, or INVALID)\n"
        - id: user-router
          role: user
          text: '{{#1001.query#}}'
        selected: false
        structured_output_enabled: false
        title: Router
        type: llm
        vision:
          enabled: false
      height: 132
      id: '1002'
      position:
        x: 330
        y: 300
      positionAbsolute:
        x: 330
        y: 300
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        cases:
        - case_id: case-ticker
          conditions:
          - comparison_operator: is
            id: cond-ticker
            value: SYMBOL
            variable_selector:
            - '1002'
            - text
          id: case-ticker
          logical_operator: and
        - case_id: case-data
          conditions:
          - comparison_operator: contains
            id: cond-data
            sub_variable_condition:
              case_id: 6f06a580-b00a-493c-bab4-57cc20c3086a
              conditions: []
              logical_operator: and
            value: ''
            varType: array[file]
            variable_selector:
            - sys
            - files
          id: case-data
          logical_operator: and
        - case_id: case-invalid
          conditions:
          - comparison_operator: is
            id: cond-invalid
            value: INVALID
            variable_selector:
            - '1002'
            - text
          id: case-invalid
          logical_operator: and
        desc: ''
        selected: false
        title: åˆ¤å®šåˆ†æ”¯
        type: if-else
      height: 220
      id: '1003'
      position:
        x: 631.4737315063629
        y: 162.94296990825057
      positionAbsolute:
        x: 631.4737315063629
        y: 162.94296990825057
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: 'Agent 2: Generates the command list.'
        model:
          completion_params:
            temperature: 0.3
          mode: chat
          name: deepseek-v3.2-exp-thinking
          provider: langgenius/openai_api_compatible/openai_api_compatible
        prompt_template:
        - id: sys-cmdlist
          role: system
          text: "ä½ æ˜¯ä¸€ä¸ªç¾è‚¡æœŸæƒåˆ†æåŠ©æ‰‹ã€‚ä½ çš„å”¯ä¸€ä»»åŠ¡æ˜¯æ ¹æ®ç”¨æˆ·æä¾›çš„ä»£ç ,ä¸¥æ ¼æŒ‰ç…§ã€æ•°æ®æŠ“å–å‘½ä»¤æ¸…å•ã€‘çš„æ ¼å¼,ä¸ºæ¯ä¸ªæ ‡çš„(å’ŒæŒ‡æ•°)ç”Ÿæˆä¸€ä¸ªæ¸…æ™°çš„ã€å¯ä¾›ç”¨æˆ·å¤åˆ¶ç²˜è´´å»æ‰§è¡Œçš„å‘½ä»¤åˆ—è¡¨ã€‚\n\
            \nã€é¢„å¤„ç†ã€‘\n1. æå–ä»£ç :ä¾‹å¦‚ \"amzn us, QQQ\" -> [\"AMZN\", \"QQQ\"]\n2. å¤§å†™å»é‡ã€‚\n\
            \nã€æ•°æ®æŠ“å–å‘½ä»¤æ¸…å•ã€‘\n### å¿…è·‘å‘½ä»¤ï¼ˆæŒ‰é¡ºåºæ‰§è¡Œï¼‰\n**1. å¢™ä¸ç°‡è¯†åˆ«**\n!gexr {SYMBOL} {{#env.DEFAULT_STRIKES#}}\
            \ {{#env.DEFAULT_DTE_WEEKLY_SHORT#}} w \n!gexr {SYMBOL} {{#env.DEFAULT_STRIKES#}}\
            \ {{#env.DEFAULT_DTE_WEEKLY_MID#}} w\n **2. å‡€Î³ä¸é›¶Î³**\n!gexn {SYMBOL} {{#env.DEFAULT_NET_WINDOW#}}\
            \ 98 !trigger {SYMBOL} {{#env.DEFAULT_NET_WINDOW#}}\n **3. DEXæ–¹å‘ä¸€è‡´æ€§**\
            \ ``` \n!dexn {SYMBOL} {{#env.DEFAULT_STRIKES#}} {{#env.DEFAULT_DTE_WEEKLY_MID#}}\
            \ w\n **4. Vanna** \n!vanna {SYMBOL} ntm {{#env.DEFAULT_NET_WINDOW#}}\
            \ m\n\n**5. æ³¢åŠ¨ç‡**  \n!skew {SYMBOL} ivmid atm {{#env.DEFAULT_DTE_WEEKLY_SHORT#}}\
            \ \n!skew {SYMBOL} ivmid atm {{#env.DEFAULT_DTE_WEEKLY_MID#}} \n!skew\
            \ {SYMBOL} ivmid ntm {{#env.DEFAULT_DTE_WEEKLY_MID#}} w \n!term {SYMBOL}\
            \ {{#env.DEFAULT_NET_WINDOW#}}\n\n### æ‰©å±•å‘½ä»¤ï¼ˆæ¡ä»¶è§¦å‘ï¼‰\n  **è‹¥å‘¨åº¦ç°‡ç¨€ç–æˆ–æœˆåº¦ä¸»å¯¼**ï¼š \n\
            !gexr {SYMBOL} {{#env.DEFAULT_DTE_MONTHLY_SHORT#}} m \n**è‹¥éœ€æ›´è¿œåˆ°æœŸå½±å“**ï¼š \n\
            \ !gexn {SYMBOL} {{#env.EXTENDED_NET_WINDOW#}} 98 \n!dexn {SYMBOL} {{#env.DEFAULT_STRIKES#}}\
            \ {{#env.DEFAULT_DTE_MONTHLY_SHORT#}} w  \n**è‹¥7D ATM-IVå™ªå£°å¤§**ï¼ˆä¸14Då·®å¼‚>{{#env.IV_NOISE_THRESHOLD#}}%ï¼‰ï¼š\n\
            \ !skew {SYMBOL} ivmid atm 21 \n **éªŒè¯Vannaç¨³å®šæ€§**ï¼š\n !vanna {SYMBOL} ntm\
            \ {{#env.DEFAULT_DTE_MONTHLY_SHORT#}} m \n **è§£é‡Šå¯é€‰**ï¼š\n!vexn {SYMBOL} {{#env.DEFAULT_DTE_MONTHLY_SHORT#}}\
            \ 190\n### æŒ‡æ•°èƒŒæ™¯ï¼ˆå¿…éœ€ï¼‰ \n**{{#env.DEFAULT_INDEX_PRIMARY#}}ï¼ˆä¸»è¦æŒ‡æ•°ï¼‰**ï¼š !gexn\
            \ {{#env.DEFAULT_INDEX_PRIMARY#}} {{#env.DEFAULT_DTE_MONTHLY_SHORT#}}\
            \ 98 \n!trigger {{#env.DEFAULT_INDEX_PRIMARY#}} {{#env.DEFAULT_NET_WINDOW#}}\
            \ \n!skew {{#env.DEFAULT_INDEX_PRIMARY#}} ivmid atm {{#env.DEFAULT_DTE_WEEKLY_SHORT#}}\
            \ \n!skew {{#env.DEFAULT_INDEX_PRIMARY#}} ivmid atm {{#env.DEFAULT_DTE_WEEKLY_MID#}}\
            \ \n**{{#env.DEFAULT_INDEX_SECONDARY#}}ï¼ˆå¯é€‰ï¼Œç§‘æŠ€è‚¡ï¼‰**ï¼š\n !gexn {{#env.DEFAULT_INDEX_SECONDARY#}}\
            \ {{#env.DEFAULT_DTE_MONTHLY_SHORT#}} 98 \n!skew {{#env.DEFAULT_INDEX_SECONDARY#}}\
            \ ivmid atm {{#env.DEFAULT_DTE_WEEKLY_SHORT#}} \n!skew {{#env.DEFAULT_INDEX_SECONDARY#}}\
            \ ivmid atm {{#env.DEFAULT_DTE_WEEKLY_MID#}}\n\n### iv_path\n** iv_path:\
            \ æ¯”è¾ƒä»Šæ—¥ 7D ATM-IV ä¸æ˜¨æ—¥/å‰ä¸‰æ—¥,å­˜æ¡£æ•°æ®è·å–\n\n### å›ä¼ è¦æ±‚ \nâœ“ **æ¯å¼ å›¾/è¾“å‡ºè¯·æ³¨æ˜**ï¼š \n    \
            \ - å‘½ä»¤å…¨æ–‡ \n     - æ”¶ç›˜ä»·ä¸å½“æ—¥å˜åŠ¨ï¼ˆå¯é€‰ï¼‰ \nâœ“ **è‹¥ä»»ä¸€å¿…è·‘å‘½ä»¤è¾“å‡ºä¸ºç©ºæˆ–å¼‚å¸¸**ï¼š \n      - è¯·ç›´æ¥è¯´æ˜ï¼Œæˆ‘ä¼šç»™æ›¿ä»£å£å¾„\
            \ \nâœ“ **æ•°æ®å®Œæ•´æ€§æ£€æŸ¥**ï¼š \n      - ç¡®ä¿åŒ…å«SPOT PRICE \n      - ç¡®ä¿åŒ…å«Call/Put Wallæ ‡æ³¨\
            \ \n      - ç¡®ä¿åŒ…å«VOL_TRIGGERæˆ–Gamma Flipæ•°å€¼ \n\n--- \n\nè¯·ç«‹å³ä¸º **{SYMBOL}**\
            \ ç”Ÿæˆå‘½ä»¤æ¸…å•ã€‚\n\n"
        - id: user-cmdlist
          role: user
          text: è¯·ç«‹å³å¼€å§‹ä¸º{{#1001.query#}}ç”Ÿæˆå‘½ä»¤æ¸…å•ã€‚
        selected: false
        title: Agent 2 å‘½ä»¤æ¸…å•
        type: llm
        vision:
          enabled: false
      height: 116
      id: '2002'
      position:
        x: 997.7916492926931
        y: 188.21014794909684
      positionAbsolute:
        x: 997.7916492926931
        y: 188.21014794909684
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        answer: '{{#2002.text#}}'
        desc: ''
        selected: false
        title: å›å¤å‘½ä»¤æ¸…å•
        type: answer
      height: 103
      id: '2003'
      position:
        x: 1409.7707104668832
        y: -7.965831120450034
      positionAbsolute:
        x: 1409.7707104668832
        y: -7.965831120450034
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: è§£æåŸå§‹æ•°æ®ã€è®¡ç®—æŒ‡æ ‡ã€æ£€æŸ¥å®Œæ•´æ€§
        model:
          completion_params: {}
          mode: chat
          name: Qwen3-VL-235B-A22B-Thinking
          provider: langgenius/openai_api_compatible/openai_api_compatible
        prompt_config:
          jinja2_variables: []
        prompt_template:
        - id: sys-validate
          role: system
          text: "ä½ æ˜¯ä¸€ä¸ªæœŸæƒç»“æ„å’Œæ³¢åŠ¨ç‡ç‰¹å¾å›¾åƒè§£æå™¨ã€æ•°æ®æ ¡éªŒå’Œè®¡ç®— Agentã€‚\nä½ çš„ä»»åŠ¡æ˜¯å°†ç”¨æˆ·å›ä¼ çš„å¯è§†åŒ–æ•°æ® chart,è¿›è¡Œ chart\
            \ å›¾åƒè§£æ,å‡†ç¡®æå–ç»“æ„åŒ–é‡åŒ–æ•°æ®\nç›®æ ‡æ˜¯è¾“å‡ºæ ‡å‡† JSON schema å¹¶ä¸¥æ ¼æŒ‰ç…§ã€æ•°æ®å£å¾„ä¸æŒ‡æ ‡å®šä¹‰ã€‘è®¡ç®—æ‰€æœ‰æ ¸å¿ƒå­—æ®µ\n\nã€ä»»åŠ¡ã€‘\n\
            1. è§£æã€ç”¨æˆ·åŸå§‹æ•°æ®ã€‘ã€‚\n2. æ‰§è¡Œã€æ•°æ®å£å¾„ä¸æŒ‡æ ‡å®šä¹‰ã€‘ä¸­çš„æ‰€æœ‰è®¡ç®—ã€‚\n3. æ ¸å¯¹ã€æ•°æ®æ ¡éªŒå…³å£ã€‘ä¸­çš„å¿…éœ€å­—æ®µã€‚\n4. ä¸¥æ ¼ä»…è¾“å‡º\
            \ JSON schema\n\nã€ç³»ç»Ÿç¯å¢ƒå˜é‡ - è®¡ç®—å‚æ•°ã€‘ \n- EM1$è®¡ç®—å› å­ï¼šsqrt(1/252) = {{#env.EM1_SQRT_FACTOR#}}\
            \ \n- ç ´å¢™é˜ˆå€¼ä¸‹é™ï¼š{{#env.BREAK_WALL_THRESHOLD_LOW#}} Ã— EM1$ \n- ç ´å¢™é˜ˆå€¼ä¸Šé™ï¼š{{#env.BREAK_WALL_THRESHOLD_HIGH#}}\
            \ Ã— EM1$ \n- æœˆåº¦å åŠ é˜ˆå€¼ç³»æ•°ï¼š{{#env.MONTHLY_OVERRIDE_THRESHOLD#}} \n- æœˆåº¦ç°‡å¼ºåº¦è§¦å‘æ¯”ï¼š{{#env.MONTHLY_CLUSTER_STRENGTH_RATIO#}}\
            \ \n- ç°‡å¼ºåº¦è¶‹åŠ¿é˜ˆå€¼ï¼š{{#env.CLUSTER_STRENGTH_THRESHOLD_TREND#}} \n- ç°‡å¼ºåº¦æå¼ºé˜ˆå€¼ï¼š{{#env.CLUSTER_STRENGTH_THRESHOLD_STRONG#}}\
            \ \n- å¢™è¯†åˆ«å³°å€¼å€æ•°ï¼š{{#env.WALL_PEAK_MULTIPLIER#}} \n- å¢™è¯†åˆ«ç°‡å®½åº¦ï¼š{{#env.WALL_CLUSTER_WIDTH#}}\
            \ \n- DEXå¼ºä¿¡å·é˜ˆå€¼ï¼š{{#env.DEX_SAME_DIR_THRESHOLD_STRONG#}}% \n- DEXä¸­ç­‰ä¿¡å·é˜ˆå€¼ï¼š{{#env.DEX_SAME_DIR_THRESHOLD_MEDIUM#}}%\
            \ \n- IVè·¯å¾„é˜ˆå€¼ï¼š{{#env.IV_PATH_THRESHOLD_VOL#}} vol æˆ– {{#env.IV_PATH_THRESHOLD_PCT#}}%\
            \ \n- IVå™ªå£°é˜ˆå€¼ï¼š{{#env.IV_NOISE_THRESHOLD#}}% \n- é»˜è®¤strikesï¼š{{#env.DEFAULT_STRIKES#}}\
            \ \n- é»˜è®¤NETçª—å£ï¼š{{#env.DEFAULT_NET_WINDOW#}}å¤©\n\nã€æ•°æ®å£å¾„ä¸æŒ‡æ ‡å®šä¹‰ - æ ¸å¿ƒè®¡ç®—22å­—æ®µã€‘\
            \ \n**1. åˆ°æœŸä¸é‡‡æ ·** \n- å‘¨åº¦ä¼˜å…ˆï¼šDTE {{#env.DEFAULT_DTE_WEEKLY_SHORT#}}ä¸{{#env.DEFAULT_DTE_WEEKLY_MID#}}\
            \ \n- æ— å‘¨åº¦å–æœˆåº¦ï¼šDTE {{#env.DEFAULT_DTE_MONTHLY_SHORT#}}ä¸{{#env.DEFAULT_DTE_MONTHLY_MID#}}\
            \ \n- strikes = {{#env.DEFAULT_STRIKES#}} \n- NETç±»çª—å£é»˜è®¤{{#env.DEFAULT_NET_WINDOW#}}å¤©ï¼Œå¿…è¦æ—¶{{#env.EXTENDED_NET_WINDOW#}}å¤©\n\
            \n**2. EM1$ (é¢„æœŸå•æ—¥æ³¢å¹…ç¾å…ƒ)** \nå…¬å¼ï¼šEM1$ = Spot Ã— min(ATM_IV_7D, ATM_IV_14D)\
            \ Ã— {{#env.EM1_SQRT_FACTOR#}} \n- ä¼˜å…ˆä½¿ç”¨7D ATM-IV \n- è‹¥7Dä¸14Då·®å¼‚>{{#env.IV_NOISE_THRESHOLD#}}%ï¼Œåˆ™ç”¨14D\n\
            \ - ä¸¤è€…çš†ç¼ºæ—¶è¡¥21D \n- è¾“å‡ºå­—æ®µï¼šem1_dollar (æ•°å€¼)\n\n**3. å¢™ä¸ç°‡è¯†åˆ«è§„åˆ™** \nä» !gexr SYMBOL\
            \ {{ {{#env.DEFAULT_STRIKES#}} 7w ä¸ 14w è¯†åˆ«Call/Put/Majorå¢™ã€‚ \n- è§„åˆ™ï¼šå±€éƒ¨å³°\
            \ â‰¥ ç›¸é‚»Î³ä¸­ä½æ•° Ã— {{#env.WALL_PEAK_MULTIPLIER#}} å€ \n- ä¸”ç°‡å®½ â‰¥ {{#env.WALL_CLUSTER_WIDTH#}}\
            \ ç›¸é‚»è¡Œæƒä»· - Major_Wall ä¸º Call/Put å¢™ä¸­ GEX ç»å¯¹å€¼æ›´å¤§è€… \n- è¾“å‡ºå­—æ®µï¼š * call_wall (è¡Œæƒä»·æ•°å€¼)\
            \ * put_wall (è¡Œæƒä»·æ•°å€¼) * major_wall (è¡Œæƒä»·æ•°å€¼) * major_wall_type (\"call\"\
            \ æˆ– \"put\")\n\n**4. æ­£Î³è´ŸÎ³åˆ¤å®šï¼ˆGamma Regimeï¼‰\n- æœ€å…³é”®**\nä½¿ç”¨ !trigger SYMBOL\
            \ {{#env.DEFAULT_NET_WINDOW#}} è¾“å‡ºçš„ VOL_TRIGGER å³ Gamma ç¿»è½¬ä»·ä½ã€‚\n       \
            \ - è‹¥ SPOT > VOL_TRIGGERï¼š\n          * spot_vs_trigger = \"above\"\n \
            \         * è§£è¯»ï¼šæ­£Î³å€¾å‘ï¼Œåšå¸‚å•†å‹åˆ¶æ³¢åŠ¨ï¼ŒåŸºç¡€åœºæ™¯ä¸ºåŒºé—´\n        - è‹¥ SPOT < VOL_TRIGGERï¼š\n\
            \          * spot_vs_trigger = \"below\"\n          * è§£è¯»ï¼šè´ŸÎ³å€¾å‘ï¼Œåšå¸‚å•†æ”¾å¤§æ³¢åŠ¨ï¼ŒåŸºç¡€åœºæ™¯ä¸ºè¶‹åŠ¿\n\
            \        - è‹¥ SPOT é è¿‘ VOL_TRIGGER (Â±0.3Ã—EM1$)ï¼š\n          * spot_vs_trigger\
            \ = \"near\"\n          * è§£è¯»ï¼šä¸´ç•ŒçŠ¶æ€ï¼Œå¯èƒ½ regime åè½¬\n        - è¾“å‡ºå­—æ®µï¼š\n    \
            \      * vol_trigger (æ•°å€¼)\n          * spot_vs_trigger (\"above\" | \"\
            below\" | \"near\")\n\n **5. æœˆåº¦å åŠ æœºåˆ¶**\nè‹¥ !gexr æœˆåº¦ç°‡å¼ºåº¦ â‰¥ å‘¨åº¦ Ã— {{#env.MONTHLY_CLUSTER_STRENGTH_RATIO#}}ï¼š\n\
            - ç ´å¢™é˜ˆå€¼é™è‡³ {{#env.MONTHLY_OVERRIDE_THRESHOLD#}} Ã— EM1$\n- ä¸”éœ€æ¬¡æ—¥ç¡®è®¤\n- è¾“å‡ºå­—æ®µï¼šmonthly_cluster_override\
            \ (true | false)\n\n**6. Vannaä¸‰çº§å›é€€** \nä¼˜å…ˆï¼š!vanna SYMBOL ntm {{#env.DEFAULT_NET_WINDOW#}}\
            \ m\n - è¯»å–ç°ä»·é™„è¿‘ç¬¦å·ä¸æ–œç‡ \n- å¾—åˆ° vanna_dir (\"up\" | \"down\" | \"flat\") \n\
            - ç½®ä¿¡åº¦ vanna_confidence (\"high\" | \"medium\" | \"low\") \n- è‹¥ç¼ºï¼Œè¡¥ï¼š!vanna\
            \ SYMBOL ntm {{#env.DEFAULT_DTE_MONTHLY_SHORT#}} m â†’ confidence = \"medium\"\
            \ \n- è‹¥ä»ç¼ºï¼ŒæŒ‰skewä¸deltaåæ–œä¸´æ—¶æ¨æ–­ â†’ confidence = \"low\" - è¾“å‡ºå­—æ®µï¼š * vanna_dir\
            \ * vanna_confidence\n\n**7. ATM_IVæ•°æ®æºä¼˜å…ˆçº§** \n!skew SYMBOL ivmid atm 7\
            \ ä¸ 14 \n- ä¼˜å…ˆä½¿ç”¨7D - è‹¥7Dä¸14Då·®å¼‚ > {{#env.IV_NOISE_THRESHOLD#}}%ï¼Œåˆ™ç”¨14D \n\
            - è‹¥ä¸¤è€…çš†ç¼ºï¼Œè¡¥21D \n- è¾“å‡ºå­—æ®µï¼š * atm_iv_7d (æ•°å€¼æˆ–null) * atm_iv_14d (æ•°å€¼æˆ–null) *\
            \ iv_source (\"7d\" | \"14d\" | \"21d_fallback\")\n\n**8. iv_path æ³¢åŠ¨ç‡è·¯å¾„**\
            \ \næ¯”è¾ƒä»Šæ—¥7D_ATM_IVä¸æ˜¨æ—¥æˆ–å‰ä¸‰æ—¥ï¼š \n- æ˜¾è‘—é˜ˆå€¼ï¼šÂ±{{#env.IV_PATH_THRESHOLD_VOL#}} vol\
            \ æˆ– Â±{{#env.IV_PATH_THRESHOLD_PCT#}}% ç›¸å¯¹å˜åŒ– \n- è¾“å‡º iv_pathï¼š \n * \"å‡\"\
            \ - IVä¸Šå‡è¶‹åŠ¿ \n * \"é™\" - IVä¸‹é™è¶‹åŠ¿ \n * \"å¹³\" - IVç¨³å®š \n * \"æ•°æ®ä¸è¶³\" - æ— å†å²æ•°æ®\
            \ \n- è¾“å‡º iv_path_confidence (\"high\" | \"medium\" | \"low\") \n- æ— å†å²æ•°æ®æ—¶ä»\
            \ !term SYMBOL æ¨æ–­ï¼š \n  * Backwardation â†’ \"å‡\"ï¼Œconfidence = \"medium\"\
            \ \n  * Contango â†’ \"é™\"ï¼Œconfidence = \"medium\"\n\n**9. gap_distance\
            \ å¢™è·ç²¾ç¡®å®šä¹‰** \nä» !gexr è·å– ABS_GEX åˆ†å¸ƒï¼š\n - å½“å‰ä»· Spot åˆ°ä¸‹ä¸€ ABS_GEX å³°ç°‡ä¸­å¿ƒæˆ–æœ‰æ•ˆè¾¹ç•Œçš„ç¾å…ƒè·ç¦»\
            \ \n - åˆ¤æ–­æ–¹å‘ï¼š \n  * è‹¥ spot_vs_trigger = \"above\"ï¼šå‘ä¸Šçœ‹ Call_Wall é˜»åŠ› \n \
            \ * è‹¥ spot_vs_trigger = \"below\"ï¼šå‘ä¸‹çœ‹ Put_Wall æ”¯æ’‘ \n- è¾“å‡ºå­—æ®µï¼š \n * gap_distance_dollar\
            \ (ç¾å…ƒæ•°å€¼) \n * gap_distance_em1_multiple (gap_distance_dollar / EM1$)\n\
            \n**10. cluster_strength_ratio ç°‡å¼ºåº¦æ¯”** \nä» !gexr å‘¨åº¦æ•°æ®ï¼š \n  - è®¡ç®—ï¼šä¸»å¢™ Major_Wall\
            \ çš„ GEX ç»å¯¹å€¼ Ã· æ¬¡å¢™ï¼ˆä¸‹ä¸€ä¸ªæœ€å¼ºå³°ï¼‰çš„ GEX ç»å¯¹å€¼ \n  - è‹¥ä»…å•å³°æ— å¯¹ç…§ï¼Œè¡¥è·‘ !gexr SYMBOL {{#env.DEFAULT_STRIKES#}}\
            \ {{#env.DEFAULT_DTE_MONTHLY_SHORT#}} m \n - æˆ–å»¶ä¼¸ DTE ä»¥å¯»å‚ç…§å³° \n - è¾“å‡ºå­—æ®µï¼š\
            \ \n   * cluster_strength_ratio (æ•°å€¼) \n   * data_source (\"weekly\" |\
            \ \"monthly\" | \"extended\") \n- è§£è¯»ï¼š \n  * â‰¥ {{#env.CLUSTER_STRENGTH_THRESHOLD_STRONG#}}ï¼šä¸»å¢™æå¼ºï¼Œç ´å¢™éš¾åº¦é«˜\
            \ \n  * â‰¥ {{#env.CLUSTER_STRENGTH_THRESHOLD_TREND#}}ï¼šä¸­ç­‰å¼ºåº¦ï¼Œæ˜“è¶‹åŠ¿çªç ´ \n  *\
            \ < {{#env.CLUSTER_STRENGTH_THRESHOLD_TREND#}}ï¼šè¾ƒæ˜“çªç ´\n\n**11. dex_same_dir\
            \ æ–¹å‘ä¸€è‡´æ€§** \nä» !dexn SYMBOL {{#env.DEFAULT_STRIKES#}} 14wï¼š \n - gap åŒºé—´å†…åŒå‘\
            \ DEX å‡€å’Œåœ¨ 60 æ—¥å†å²ä¸­çš„åˆ†ä½ç™¾åˆ†æ¯” \n - è¾“å‡ºå­—æ®µï¼šdex_same_dir_pct (ç™¾åˆ†æ¯”æ•°å€¼ï¼Œå¦‚ 65 è¡¨ç¤º 65%)\
            \ \n - è§£è¯»ï¼š \n  * â‰¥ {{#env.DEX_SAME_DIR_THRESHOLD_STRONG#}}%ï¼šå¼ºæ–¹å‘ä¿¡å· \n \
            \ * â‰¥ {{#env.DEX_SAME_DIR_THRESHOLD_MEDIUM#}}%ï¼šä¸­ç­‰æ–¹å‘ä¿¡å· \n  * < {{#env.DEX_SAME_DIR_THRESHOLD_WEAK#}}%ï¼šå¼±æ–¹å‘ä¿¡å·\n\
            \n**12. NET_GEX ä¸ç¬¦å·** \nä» !gexn SYMBOL {{#env.DEFAULT_NET_WINDOW#}} 98ï¼š\
            \ - è¯»å– NET-GEX æ•°å€¼ \n- åˆ¤æ–­ç¬¦å·ï¼š \n  * NET-GEX < 0 â†’ net_gex_sign = \"negative_gamma\"\
            \ (è´ŸÎ³ï¼Œè¶‹åŠ¿å€¾å‘) \n  * NET-GEX > 0 â†’ net_gex_sign = \"positive_gamma\" (æ­£Î³ï¼ŒåŒºé—´å€¾å‘)\
            \ \n  * NET-GEX â‰ˆ 0 â†’ net_gex_sign = \"neutral\" (ä¸­æ€§) \n- è¾“å‡ºå­—æ®µï¼š * net_gex\
            \ (æ•°å€¼) * net_gex_sign\n\n**13. æŒ‡æ•°èƒŒæ™¯å¿…éœ€** \né»˜è®¤ {{#env.DEFAULT_INDEX_PRIMARY#}}ï¼Œå¿…è¦æ—¶\
            \ {{#env.DEFAULT_INDEX_SECONDARY#}}ã€‚ \nä» !gexn SPX {{#env.DEFAULT_DTE_MONTHLY_SHORT#}}\
            \ 98 å’Œ !trigger SPX {{#env.DEFAULT_NET_WINDOW#}}ï¼š\n  - NET_GEX_IDXï¼šæŒ‡æ•°çš„\
            \ NET-GEX \nä» !skew SPX ivmid atm 7 å’Œ 14ï¼š \n - è®¡ç®— EM1$_IDX = Spot_IDX\
            \ Ã— min(ATM_IV_7D, ATM_IV_14D) Ã— {{#env.EM1_SQRT_FACTOR#}} \n\nç§‘æŠ€æƒé‡é«˜å¯å¹¶è¡Œè¾“å‡º\
            \ QQQ æ•°æ®ã€‚ \nè¾“å‡ºå­—æ®µï¼š \n- indices.spx.net_gex_idx \n- indices.spx.em1_dollar_idx\
            \ \n- indices.spx.spot_idx \n- indices.qqq.net_gex_idx (å¯é€‰) \n- indices.qqq.em1_dollar_idx\
            \ (å¯é€‰) \n- indices.qqq.spot_idx (å¯é€‰)\n\nã€æ•°æ®æ ¡éªŒå…³å£ã€‘ \n**æ ‡çš„å¿…éœ€å­—æ®µ**ï¼ˆ22ä¸ªæ ¸å¿ƒå­—æ®µï¼‰ï¼š\
            \ \n1. spot_price 2. em1_dollar 3. call_wall 4. put_wall 5. major_wall\
            \ 6. major_wall_type 7. gap_distance_dollar 8. gap_distance_em1_multiple\
            \ 9. cluster_strength_ratio 10. dex_same_dir_pct 11. vanna_dir 12. vanna_confidence\
            \ 13. iv_path 14. iv_path_confidence 15. net_gex 16. net_gex_sign 17.\
            \ vol_trigger 18. spot_vs_trigger 19. monthly_cluster_override 20. atm_iv_7d\
            \ 21. atm_iv_14d 22. iv_source **æŒ‡æ•°èƒŒæ™¯å¿…éœ€å­—æ®µ**ï¼š - net_gex_idx (SPX æˆ– QQQ)\
            \ - em1_dollar_idx (SPX æˆ– QQQ) - spot_idx (SPX æˆ– QQQ)\n\nã€æ•°æ®å®Œæ•´æ€§åˆ¤æ–­ã€‘ \n\
            status å­—æ®µå–å€¼é€»è¾‘ï¼š \n - è‹¥ 22 ä¸ªæ ¸å¿ƒå­—æ®µå…¨éƒ¨é null ä¸” missing_count = 0 â†’ status =\
            \ \"data_ready\" \n - è‹¥å­˜åœ¨ä»»ä½•å…³é”®å­—æ®µä¸º null æˆ– missing_count > 0 â†’ status = \"\
            missing_data\" \nã€è¡¥é½æŒ‡å¼•ç”Ÿæˆè§„åˆ™ã€‘ \n**ä»…å½“ status = \"missing_data\" æ—¶ï¼Œå¿…é¡»ç”Ÿæˆ \"\
            è¡¥é½æŒ‡å¼•\" æ•°ç»„** \nå¯¹äºæ¯ä¸ªç¼ºå¤±å­—æ®µï¼ŒæŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§æä¾›è¡¥é½æ–¹æ¡ˆï¼š \n**ä¼˜å…ˆçº§ 1ï¼ˆcriticalï¼‰ï¼šå½±å“ Gamma Regime\
            \ åˆ¤æ–­çš„å­—æ®µ**   - vol_trigger \n- spot_vs_trigger \n- net_gex - net_gex_sign\
            \ \nç¤ºä¾‹æ ¼å¼ï¼š \n{ \n    \"missing_field\": \"vol_trigger\", \n    \"description\"\
            : \"Gamma ç¿»è½¬ä»·ä½VOL_TRIGGERæ˜¯åˆ¤æ–­æ­£Î³è´ŸÎ³çš„å…³é”®\", \n   \"command\": \"!trigger AAPL\
            \ {{#env.DEFAULT_NET_WINDOW#}}\", \n \"alternative\": \"!gexn AAPL {{#env.DEFAULT_NET_WINDOW#}}\
            \ 98 ä»è¾“å‡ºæå–Gamma Flipä»·ä½\", \n \"extraction_note\": \"æå–è¾“å‡ºä¸­çš„VOL TRIGGERæˆ–Gamma\
            \ Flipæ•°å€¼\", \n  \"priority\": 1, \n  \"impact\": \"æ— æ­¤å­—æ®µæ— æ³•åˆ¤æ–­Gamma Regimeï¼Œå½±å“å‰§æœ¬åˆ†ç±»\"\
            \ \n} \n**ä¼˜å…ˆçº§ 2ï¼ˆhighï¼‰ï¼šå½±å“æ ¸å¿ƒè®¡ç®—çš„å­—æ®µ** \n  - em1_dollar (å½±å“æ‰€æœ‰è·ç¦»è®¡ç®—) \n  - atm_iv_7d\
            \ / atm_iv_14d (å½±å“ EM1$ è®¡ç®—) \n  - call_wall / put_wall (å½±å“å¢™è·è®¡ç®—) \n\nç¤ºä¾‹æ ¼å¼ï¼š\
            \ \n { \n   \"missing_field\": \n   \"atm_iv_14d\", \n   \"description\"\
            : \"14æ—¥ATMéšå«æ³¢åŠ¨ç‡\", \n   \"command\": \"!skew AAPL ivmid atm 14\",\n  \
            \ \"alternative\": \"è‹¥7Dæ•°æ®å™ªå£°å¤§ï¼Œ14Då¯æä¾›æ›´ç¨³å®šçš„IVåŸºå‡†\", \n  \"extraction_note\"\
            : \"æå–ATM IV 14DTEæ•°å€¼å¦‚0.30\",\n  \"priority\": 2, \n  \"impact\": \"å½±å“EM1$è®¡ç®—ç²¾åº¦ï¼Œè¿›è€Œå½±å“æ‰€æœ‰è·ç¦»ç±»æŒ‡æ ‡\"\
            \ \n } \n**ä¼˜å…ˆçº§ 3ï¼ˆmediumï¼‰ï¼šå½±å“æ–¹å‘åˆ¤æ–­çš„å­—æ®µ** \n  - dex_same_dir_pct \n  - vanna_dir\
            \ \n  - vanna_confidence \n  - iv_path ç¤ºä¾‹æ ¼å¼ï¼š \n{ \n  \"missing_field\"\
            : \"dex_same_dir_pct\", \n  \"description\": \"DEXæ–¹å‘ä¸€è‡´æ€§ç™¾åˆ†æ¯”\", \n  \"command\"\
            : \"!dexn AAPL {{#env.DEFAULT_STRIKES#}} 14 w\", \n  \"alternative\":\
            \ \"å¯ä»å†å²DEXåˆ†å¸ƒæ‰‹åŠ¨è®¡ç®—åŒå‘å æ¯”\",  \"extraction_note\": \"æŸ¥çœ‹è¾“å‡ºä¸­gapåŒºé—´å†…DEXå‡€å’Œçš„å†å²åˆ†ä½\"\
            , \n  \"priority\": 3, \n  \"impact\": \"å½±å“æ–¹å‘ä¿¡å·å¼ºåº¦è¯„ä¼°ï¼Œä½†ä¸é˜»æ–­åŸºç¡€åˆ¤æ–­\"\n } \n\
            **ä¼˜å…ˆçº§ 4-5ï¼ˆlowï¼‰ï¼šè¡¥å……æ€§å­—æ®µ** \n - cluster_strength_ratio \n - monthly_cluster_override\
            \ \n - iv_path_confidence \n**è¡¥é½æŒ‡å¼•æ•°ç»„æ’åº**ï¼šæŒ‰ priority ä»å°åˆ°å¤§æ’åˆ—ï¼ˆ1æœ€ä¼˜å…ˆï¼‰ \n **è¡¥é½åç»­è¯´æ˜**ï¼š\
            \ \n \"è¡¥é½åç»­\" å­—æ®µåº”è¯´æ˜ï¼š\n  - \"è¡¥é½ä¸Šè¿° {missing_count} ä¸ªå…³é”®å­—æ®µåå°†è‡ªåŠ¨é‡æ–°è®¡ç®— gap_distanceã€cluster_strength\
            \ ç­‰æ´¾ç”ŸæŒ‡æ ‡\" \n - \"ä¼˜å…ˆè¡¥é½ priority=1 çš„å­—æ®µï¼Œè¿™äº›ç›´æ¥å½±å“ Gamma Regime åˆ¤æ–­\"\n\nã€å…³é”®æ³¨æ„äº‹é¡¹ã€‘\n\
            1. **å¼‚å¸¸å¤„ç†**ï¼š\n   - è‹¥å›¾è¡¨æ¨¡ç³Šä¸æ¸…ï¼šè¿”å› \"chart_quality\": \"low\", \"confidence\"\
            : \"medium\"\n   - è‹¥ç¼ºå¤±æ ¸å¿ƒæŒ‡æ ‡ï¼ˆå¦‚æ— RSIï¼‰ï¼šåœ¨indicators_rawä¸­æ ‡æ³¨ \"available\": false\n\
            \   - è‹¥æ— æ³•è¯†åˆ«å¹³å°ï¼šè¿”å› \"platform\": \"unknown\"\n2. **çŠ¶æ€ä¸€è‡´æ€§**ï¼š\n   - targets.status\
            \ å¿…é¡»ä¸é¡¶å±‚ status ä¿æŒä¸€è‡´\n   - missing_fields æ•°ç»„é•¿åº¦å¿…é¡»ä¸ validation_summary.missing_count\
            \ ä¸€è‡´\n3. **è¡¥é½æŒ‡å¼•å®Œæ•´æ€§**ï¼š\n   - å½“ status = \"missing_data\" æ—¶ï¼Œå¿…é¡»æä¾› \"è¡¥é½æŒ‡å¼•\"\
            \ æ•°ç»„\n   - æ•°ç»„ä¸­æ¯ä¸ªå¯¹è±¡å¿…é¡»åŒ…å«æ‰€æœ‰ required å­—æ®µ\n   - priority å€¼å¿…é¡»åœ¨ 1-5 èŒƒå›´å†…"
        - edition_type: basic
          id: user-validate
          role: user
          text: '{{#1001.query#}}

            ã€ä¸Šä¼ æ–‡ä»¶ã€‘

            {{#sys.files#}}'
        reasoning_format: tagged
        selected: false
        structured_output:
          schema:
            properties:
              indices:
                properties:
                  qqq:
                    properties:
                      em1_dollar_idx:
                        description: QQQçš„EM1$ï¼Œè‹¥ä¸éœ€è¦ä½¿ç”¨ -999
                        type: number
                      net_gex_idx:
                        description: QQQå‡€Gammaï¼Œè‹¥ä¸éœ€è¦ä½¿ç”¨ -999
                        type: number
                      spot_idx:
                        description: QQQç°ä»·ï¼Œè‹¥ä¸éœ€è¦ä½¿ç”¨ -999
                        type: number
                    required:
                    - net_gex_idx
                    - em1_dollar_idx
                    - spot_idx
                    type: object
                  spx:
                    properties:
                      em1_dollar_idx:
                        description: SPXçš„EM1$ï¼Œè‹¥ç¼ºå¤±ä½¿ç”¨ -999
                        type: number
                      net_gex_idx:
                        description: SPXå‡€Gammaï¼Œè‹¥ç¼ºå¤±ä½¿ç”¨ -999
                        type: number
                      spot_idx:
                        description: SPXç°ä»·ï¼Œè‹¥ç¼ºå¤±ä½¿ç”¨ -999
                        type: number
                    required:
                    - net_gex_idx
                    - em1_dollar_idx
                    - spot_idx
                    type: object
                required:
                - spx
                - qqq
                type: object
              missing_fields:
                description: ç¼ºå¤±å­—æ®µåˆ—è¡¨ï¼Œè‹¥æ— ç¼ºå¤±åˆ™ä¸ºç©ºæ•°ç»„
                items:
                  properties:
                    category:
                      type: string
                    field:
                      type: string
                    severity:
                      enum:
                      - critical
                      - high
                      - medium
                      - low
                      type: string
                    target:
                      type: string
                  required:
                  - field
                  - target
                  - severity
                  - category
                  type: object
                type: array
              next_step:
                enum:
                - proceed_to_analysis
                - request_missing_data
                type: string
              status:
                description: æ•°æ®çŠ¶æ€
                enum:
                - data_ready
                - missing_data
                type: string
              targets:
                properties:
                  atm_iv:
                    properties:
                      iv_14d:
                        description: 14æ—¥ATMéšå«æ³¢åŠ¨ç‡ï¼Œè‹¥ç¼ºå¤±ä½¿ç”¨ -999
                        type: number
                      iv_7d:
                        description: 7æ—¥ATMéšå«æ³¢åŠ¨ç‡ï¼Œè‹¥ç¼ºå¤±ä½¿ç”¨ -999
                        type: number
                      iv_source:
                        description: IVæ•°æ®æº
                        enum:
                        - 7d
                        - 14d
                        - 21d_fallback
                        - N/A
                        type: string
                    required:
                    - iv_7d
                    - iv_14d
                    - iv_source
                    type: object
                  directional_metrics:
                    properties:
                      dex_same_dir_pct:
                        description: DEXæ–¹å‘ä¸€è‡´æ€§ç™¾åˆ†æ¯”ï¼Œè‹¥ç¼ºå¤±ä½¿ç”¨ -999
                        type: number
                      iv_path:
                        description: éšå«æ³¢åŠ¨ç‡è·¯å¾„
                        enum:
                        - å‡
                        - é™
                        - å¹³
                        - æ•°æ®ä¸è¶³
                        type: string
                      iv_path_confidence:
                        description: IVè·¯å¾„ç½®ä¿¡åº¦
                        enum:
                        - high
                        - medium
                        - low
                        type: string
                      vanna_confidence:
                        description: Vannaç½®ä¿¡åº¦ï¼Œè‹¥ç¼ºå¤±ä½¿ç”¨ N/A
                        enum:
                        - high
                        - medium
                        - low
                        - N/A
                        type: string
                      vanna_dir:
                        description: Vannaæ–¹å‘ï¼Œè‹¥ç¼ºå¤±ä½¿ç”¨ N/A
                        enum:
                        - up
                        - down
                        - flat
                        - N/A
                        type: string
                    required:
                    - dex_same_dir_pct
                    - vanna_dir
                    - vanna_confidence
                    - iv_path
                    - iv_path_confidence
                    type: object
                  em1_dollar:
                    description: é¢„æœŸå•æ—¥æ³¢å¹…ï¼Œè‹¥ç¼ºå¤±ä½¿ç”¨ -999
                    type: number
                  gamma_metrics:
                    properties:
                      cluster_strength_ratio:
                        description: ç°‡å¼ºåº¦æ¯”ï¼Œè‹¥ç¼ºå¤±ä½¿ç”¨ -999
                        type: number
                      gap_distance_dollar:
                        description: è·å¢™è·ç¦»ç¾å…ƒå€¼ï¼Œè‹¥ç¼ºå¤±ä½¿ç”¨ -999
                        type: number
                      gap_distance_em1_multiple:
                        description: è·å¢™è·ç¦»EM1å€æ•°ï¼Œè‹¥ç¼ºå¤±ä½¿ç”¨ -999
                        type: number
                      monthly_cluster_override:
                        description: æ˜¯å¦æœˆåº¦ç°‡å ä¼˜
                        type: boolean
                      net_gex:
                        description: å‡€Gammaæ•å£ï¼Œè‹¥ç¼ºå¤±ä½¿ç”¨ -999
                        type: number
                      net_gex_sign:
                        description: å‡€Gammaç¬¦å·ï¼Œè‹¥ç¼ºå¤±ä½¿ç”¨ N/A
                        enum:
                        - positive_gamma
                        - negative_gamma
                        - neutral
                        - N/A
                        type: string
                      spot_vs_trigger:
                        description: ç°ä»·ç›¸å¯¹è§¦å‘çº¿ä½ç½®ï¼Œè‹¥ç¼ºå¤±ä½¿ç”¨ N/A
                        enum:
                        - above
                        - below
                        - near
                        - N/A
                        type: string
                      vol_trigger:
                        description: æ³¢åŠ¨ç‡è§¦å‘ä»·ä½ï¼Œè‹¥ç¼ºå¤±ä½¿ç”¨ -999
                        type: number
                    required:
                    - gap_distance_dollar
                    - gap_distance_em1_multiple
                    - cluster_strength_ratio
                    - net_gex
                    - net_gex_sign
                    - vol_trigger
                    - spot_vs_trigger
                    - monthly_cluster_override
                    type: object
                  spot_price:
                    description: ç°ä»·ï¼Œè‹¥ç¼ºå¤±ä½¿ç”¨ -999
                    type: number
                  status:
                    enum:
                    - ready
                    - missing_data
                    type: string
                  symbol:
                    type: string
                  walls:
                    properties:
                      call_wall:
                        description: çœ‹æ¶¨æœŸæƒå¢™ä»·ä½ï¼Œè‹¥ç¼ºå¤±ä½¿ç”¨ -999
                        type: number
                      major_wall:
                        description: ä¸»è¦å¢™ä»·ä½ï¼Œè‹¥ç¼ºå¤±ä½¿ç”¨ -999
                        type: number
                      major_wall_type:
                        description: ä¸»è¦å¢™ç±»å‹ï¼Œè‹¥ç¼ºå¤±ä½¿ç”¨ N/A
                        enum:
                        - call
                        - put
                        - N/A
                        type: string
                      put_wall:
                        description: çœ‹è·ŒæœŸæƒå¢™ä»·ä½ï¼Œè‹¥ç¼ºå¤±ä½¿ç”¨ -999
                        type: number
                    required:
                    - call_wall
                    - put_wall
                    - major_wall
                    - major_wall_type
                    type: object
                required:
                - symbol
                - status
                - spot_price
                - em1_dollar
                - walls
                - gamma_metrics
                - directional_metrics
                - atm_iv
                type: object
              timestamp:
                description: æ—¶é—´æˆ³ï¼Œæ ¼å¼ YYYY-MM-DDTHH:mm:ss
                type: string
              validation_summary:
                properties:
                  completion_rate:
                    type: integer
                  fields_provided:
                    type: integer
                  missing_count:
                    type: integer
                  targets_ready:
                    type: integer
                  total_fields_required:
                    type: integer
                  total_targets:
                    type: integer
                required:
                - total_targets
                - targets_ready
                - total_fields_required
                - fields_provided
                - missing_count
                - completion_rate
                type: object
              è¡¥é½åç»­:
                description: è¡¥é½åçš„åç»­æ­¥éª¤ï¼Œå½“status=data_readyæ—¶å¡« N/A
                type: string
              è¡¥é½æŒ‡å¼•:
                description: è¡¥é½æŒ‡å¼•åˆ—è¡¨ï¼Œå½“status=data_readyæ—¶ä¸ºç©ºæ•°ç»„
                items:
                  properties:
                    alternative:
                      description: å¤‡é€‰æ–¹æ¡ˆï¼Œè‹¥æ— åˆ™å¡« N/A
                      type: string
                    command:
                      description: å»ºè®®æ‰§è¡Œçš„å‘½ä»¤
                      type: string
                    description:
                      description: å­—æ®µè¯´æ˜
                      type: string
                    extraction_note:
                      description: æ•°æ®æå–è¯´æ˜
                      type: string
                    impact:
                      description: ç¼ºå¤±å½±å“è¯´æ˜
                      type: string
                    missing_field:
                      description: ç¼ºå¤±å­—æ®µå
                      type: string
                    priority:
                      description: ä¼˜å…ˆçº§1-5
                      maximum: 5
                      minimum: 1
                      type: integer
                  required:
                  - missing_field
                  - description
                  - command
                  - alternative
                  - extraction_note
                  - priority
                  - impact
                  type: object
                type: array
            required:
            - status
            - timestamp
            - validation_summary
            - targets
            - indices
            - missing_fields
            - next_step
            - è¡¥é½æŒ‡å¼•
            - è¡¥é½åç»­
            type: object
        structured_output_enabled: true
        title: Agent 3 æ•°æ®æ ¡éªŒ
        type: llm
        vision:
          configs:
            detail: high
            variable_selector:
            - sys
            - files
          enabled: true
      height: 116
      id: '3001'
      position:
        x: 1034.3730386199136
        y: 448.2474211113356
      positionAbsolute:
        x: 1034.3730386199136
        y: 448.2474211113356
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        cases:
        - case_id: case-ready
          conditions:
          - comparison_operator: contains
            id: cond-ready
            value: data_ready
            varType: string
            variable_selector:
            - '3001'
            - structured_output
            - status
          id: case-ready
          logical_operator: and
        - case_id: case-missing
          conditions:
          - comparison_operator: contains
            id: cond-missing
            value: missing_data
            variable_selector:
            - '3001'
            - text
          id: case-missing
          logical_operator: and
        desc: ''
        selected: false
        title: æ ¡éªŒåˆ†æ”¯
        type: if-else
      height: 172
      id: '3002'
      position:
        x: 1331.8076428705288
        y: 182.75916073235004
      positionAbsolute:
        x: 1331.8076428705288
        y: 182.75916073235004
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        answer: '{{#3001.text#}}'
        desc: ''
        selected: false
        title: å›å¤ç¼ºå¤±æ•°æ®
        type: answer
      height: 103
      id: '3003'
      position:
        x: 1688.2034969828262
        y: 482.1496130490057
      positionAbsolute:
        x: 1688.2034969828262
        y: 482.1496130490057
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: 'Agent 4: Analyze technicals.'
        model:
          completion_params:
            temperature: 0.5
          mode: chat
          name: Qwen3-VL-235B-A22B-Thinking
          provider: langgenius/openai_api_compatible/openai_api_compatible
        prompt_template:
        - id: sys-ta
          role: system
          text: "ä½ æ˜¯ä¸€ä¸ªæŠ€æœ¯é¢åˆ†æ Agentã€‚\nä½ çš„ä»»åŠ¡æ˜¯åŸºäºã€æ•°æ®JSONã€‘ä¸­çš„ \"TA_Data\",è®¡ç®—æŠ€æœ¯é¢å¾—åˆ†å¹¶ç»™å‡ºç®€çŸ­è¯»æ•°ã€‚\n\
            \nã€æ ¸å¿ƒèƒ½åŠ›ã€‘ \n1. **å›¾è¡¨è¯†åˆ«**ï¼šè‡ªåŠ¨è¯†åˆ« TradingViewã€ yahoo financeç­‰å¹³å°çš„æŠ€æœ¯æŒ‡æ ‡å›¾è¡¨ \n2.\
            \ **æŒ‡æ ‡æå–**ï¼šç²¾ç¡®è¯»å–ä»¥ä¸‹æŒ‡æ ‡çš„æ•°å€¼ä¸å½¢æ€ \n  - EMA20/50ï¼šä»·æ ¼ç›¸å¯¹ä½ç½®ã€ä¸¤å‡çº¿æ–œç‡ï¼ˆä¸Šè¡Œ/èµ°å¹³/ä¸‹è¡Œï¼‰ã€é‡‘å‰æ­»å‰ \n\
            \  - RSI(14)ï¼šå½“å‰å€¼ã€è¶…ä¹°è¶…å–ã€èƒŒç¦»å½¢æ€ï¼ˆé¡¶èƒŒç¦»/åº•èƒŒç¦»ï¼‰ \n  - BBå®½åº¦(20,2)ï¼šå½“å‰å®½åº¦ã€å†å²åˆ†ä½ã€å¸¦å£å¼€åˆæ–¹å‘\
            \ \n  - MACDï¼šæŸ±çŠ¶å›¾è¶‹åŠ¿ã€é›¶è½´ä½ç½®ã€å¿«æ…¢çº¿äº¤å‰ \n  - æˆäº¤é‡ï¼šç›¸å¯¹20æ—¥å‡é‡çš„æ¯”å€¼ã€æ”¾é‡ç¼©é‡ \n  - AVWAPï¼šä»·æ ¼è·ç¦»AVWAPçš„ç™¾åˆ†æ¯”ï¼ˆè‹¥å›¾è¡¨åŒ…å«ï¼‰\
            \ \n3. **å½¢æ€è¯†åˆ«**ï¼šè¶‹åŠ¿çº¿çªç ´ã€æ”¯æ’‘é˜»åŠ›ã€Kçº¿å½¢æ€ï¼ˆé”¤å­çº¿/åæ²¡ç­‰ï¼‰\n\nã€æ•°æ®JSONã€‘{{#3001.text#}}\n\
            ã€ç”¨æˆ·ä¸Šä¼ ã€‘{{#sys.files#}}\n\nã€å¤„ç†æµç¨‹ã€‘ \n## ç¬¬ä¸€æ­¥ï¼šå›¾è¡¨è§£æ \n<thinking> \n1. è¯†åˆ«å›¾è¡¨ç±»å‹ä¸æ—¶é—´å‘¨æœŸï¼ˆæ—¥çº¿/4H/1Hï¼‰\
            \ \n2. å®šä½å„æŠ€æœ¯æŒ‡æ ‡çš„æ˜¾ç¤ºåŒºåŸŸ \n3. è¯»å–æœ€æ–°Kçº¿å¯¹åº”çš„æŒ‡æ ‡æ•°å€¼ \n4. è¯†åˆ«å…³é”®æŠ€æœ¯å½¢æ€ï¼ˆå¦‚çªç ´/èƒŒç¦»ï¼‰ \n</thinking>\n\
            è¾“å‡ºæ ¼å¼ï¼š \n```json\n{\n  \"chart_metadata\": {\n    \"platform\": \"TradingView/Thinkorswim/å…¶ä»–\"\
            ,\n    \"timeframe\": \"Daily/4H/1H\",\n    \"latest_timestamp\": \"2025-01-15\
            \ 16:00 ET\",\n    \"symbol\": \"AAPL\"\n  },\n  \"indicators_raw\": {\n\
            \    \"price\": {\n      \"close\": 170.5,\n      \"ema20\": 168.3,\n\
            \      \"ema50\": 165.8,\n      \"price_vs_ema20_pct\": 1.31,\n      \"\
            price_vs_ema50_pct\": 2.83,\n      \"ema20_slope\": \"ä¸Šè¡Œ\",\n      \"\
            ema50_slope\": \"ä¸Šè¡Œ\",\n      \"golden_cross\": true\n    },\n    \"rsi\"\
            : {\n      \"value\": 58.3,\n      \"zone\": \"ä¸­æ€§åŒºé—´\",\n      \"divergence\"\
            : \"æ— \"\n    },\n    \"bb\": {\n      \"width\": 4.2,\n      \"width_percentile\"\
            : 35,\n      \"position\": \"ä¸­è½¨ä¸Šæ–¹\",\n      \"band_direction\": \"å¹³è¡Œ\"\
            \n    },\n    \"volume\": {\n      \"current\": 85000000,\n      \"avg_20d\"\
            : 72000000,\n      \"ratio\": 1.18,\n      \"status\": \"æ¸©å’Œæ”¾é‡\"\n    },\n\
            \    \"macd\": {\n      \"histogram\": \"æ­£å€¼æ”¶æ•›\",\n      \"signal_line_cross\"\
            : \"é‡‘å‰åç¬¬3æ—¥\",\n      \"zero_line\": \"ä¸Šæ–¹\"\n    },\n    \"avwap\": {\n\
            \      \"available\": false,\n      \"note\": \"å›¾è¡¨æœªåŒ…å«AVWAP\"\n    }\n\
            \  },\n  \"key_patterns\": [\n    \"ä»·æ ¼åœ¨EMA20ä¸Šæ–¹è¿è¡Œï¼Œå‡çº¿å¤šå¤´æ’åˆ—\",\n    \"RSIå¤„äº50-60åŒºé—´ï¼Œæœªè¶…ä¹°\"\
            ,\n    \"BBå®½åº¦å¤„äºå†å²35åˆ†ä½ï¼Œæ³¢åŠ¨ç‡ä¸­ç­‰\"\n  ]\n}\n```\n## ç¬¬äºŒæ­¥ï¼šæŠ€æœ¯é¢è¯„åˆ†ï¼ˆæœ€å¤š+2åˆ†ï¼‰ \n<thinking>\
            \ \n - EMA20/50å‘æ•£å‘ä¸Šâ†’è¶‹åŠ¿+1ï¼›èµ°å¹³/ç²˜åˆâ†’åŒºé—´+1 \n- RSI>60ä¸”æ— é¡¶èƒŒç¦»â†’è¶‹åŠ¿+1ï¼›40-60â†’åŒºé—´+1ï¼›èƒŒç¦»â†’å½“å‰æ–¹å‘-1\
            \ \n- BBå®½åº¦ä½åˆ†ä½+åŒå‘å¼€å£â†’è¶‹åŠ¿+1ï¼ˆæ‹©ä¸€è®¡åˆ†ï¼‰ \n- æœ€å¤šç´¯è®¡+2åˆ† \n</thinking> \nè¯„åˆ†é€»è¾‘ï¼š\n```json\n\
            {\n  \"scoring_breakdown\": {\n    \"ema_score\": {\n      \"value\":\
            \ 1,\n      \"rationale\": \"EMA20æ–œç‡ä¸Šè¡Œä¸”price_vs_ema20=1.31%ï¼Œé‡‘å‰åæŒç»­ï¼Œç»™è¶‹åŠ¿+1\"\
            \n    },\n    \"rsi_score\": {\n      \"value\": 1,\n      \"rationale\"\
            : \"RSI=58.3å¤„äº40-60åŒºé—´ä¸”æ— èƒŒç¦»ï¼Œç»™åŒºé—´+1\"\n    },\n    \"bb_score\": {\n     \
            \ \"value\": 0,\n      \"rationale\": \"BBå®½åº¦35åˆ†ä½å±ä¸­ç­‰ï¼Œå¸¦å£å¹³è¡Œï¼Œä¸ç»™åˆ†\"\n    },\n\
            \    \"volume_score\": {\n      \"value\": 0,\n      \"rationale\": \"\
            æˆäº¤é‡ä»…æ¸©å’Œæ”¾é‡1.18å€ï¼Œæœªæ˜¾è‘—æ”¾å¤§ï¼Œä¸å•ç‹¬åŠ åˆ†\"\n    },\n    \"total_cap\": 2,\n    \"final_score\"\
            : 2,\n    \"note\": \"EMA+1 + RSI+1 = 2åˆ†ï¼Œè¾¾åˆ°ä¸Šé™\"\n  }\n}\n```\n## ç¬¬ä¸‰æ­¥ï¼šç»¼åˆè¾“å‡º\n\
            ```json\n{\n  \"ta_score\": 2,\n  \"ta_commentary\": \"EMA20/50å¤šå¤´æ’åˆ—ä¸Šè¡Œ(+1)ï¼ŒRSI(14)å¤„äº55-60åŒºé—´ä¸­æ€§åå¼º(+1)ï¼ŒBBå®½åº¦ä¸­ç­‰æœªç»™åˆ†ï¼ŒæŠ€æœ¯é¢æ€»è¯„2åˆ†\"\
            ,\n  \"detailed_analysis\": {\n    \"trend_alignment\": \"å‡çº¿å¤šå¤´æ’åˆ—æ”¯æŒä¸Šè¡Œï¼Œä½†RSIæœªè¶…ä¹°ä¿ç•™å›è°ƒç©ºé—´\"\
            ,\n    \"momentum_check\": \"MACDé‡‘å‰åç¬¬3æ—¥ï¼ŒæŸ±çŠ¶å›¾æ­£å€¼æ”¶æ•›ï¼ŒåŠ¨èƒ½æ¸©å’Œ\",\n    \"volatility_state\"\
            : \"BBå®½åº¦35åˆ†ä½ï¼Œæ³¢åŠ¨ç‡å¤„äºä¸­ç­‰æ°´å¹³ï¼Œéæç«¯å‹ç¼©æˆ–æ‰©å¼ \",\n    \"volume_confirmation\": \"æˆäº¤é‡æ¸©å’Œæ”¾é‡1.18å€ï¼Œç¡®è®¤åº¦ä¸­ç­‰\"\
            \n  },\n  \"risk_alerts\": [\n    \"RSIæ¥è¿‘60ä¸´ç•Œï¼Œè‹¥çªç ´éœ€è­¦æƒ•çŸ­æœŸè¶…ä¹°\",\n    \"BBå¸¦å£å¹³è¡Œï¼Œè‹¥æ”¶çª„å¯èƒ½é¢„ç¤ºç›˜æ•´\"\
            \n  ],\n  \"chart_metadata\": {\n    \"platform\": \"TradingView\",\n\
            \    \"timeframe\": \"Daily\",\n    \"latest_timestamp\": \"2025-01-15\
            \ 16:00 ET\"\n  }\n}\n```\nã€å…³é”®æ³¨æ„äº‹é¡¹ã€‘\n 1. **æ•°å€¼ç²¾åº¦**ï¼šä»·æ ¼ã€ç™¾åˆ†æ¯”ä¿ç•™2ä½å°æ•°ï¼›RSIä¿ç•™1ä½å°æ•°\
            \ \n2. **å½¢æ€è¯†åˆ«**ï¼šæ˜ç¡®åŒºåˆ†\"é‡‘å‰\"ä¸\"æ­»å‰\"ï¼›\"é¡¶èƒŒç¦»\"ä¸\"åº•èƒŒç¦»\"ï¼›\"çªç ´\"ä¸\"å‡çªç ´\" \n3.\
            \ **æ—¶é—´åŒæ­¥**ï¼šç¡®ä¿è¯»å–çš„æ˜¯å›¾è¡¨æœ€æ–°Kçº¿ï¼ˆé€šå¸¸ä¸ºæœ€å³ä¾§ï¼‰çš„æŒ‡æ ‡å€¼ \n4. **å¼‚å¸¸å¤„ç†**ï¼š - è‹¥å›¾è¡¨æ¨¡ç³Šä¸æ¸…ï¼šè¿”å› `\"chart_quality\"\
            : \"low\", \"confidence\": \"medium\"` - è‹¥ç¼ºå¤±æ ¸å¿ƒæŒ‡æ ‡ï¼ˆå¦‚æ— RSIï¼‰ï¼šåœ¨indicators_rawä¸­æ ‡æ³¨\
            \ `\"available\": false` - è‹¥æ— æ³•è¯†åˆ«å¹³å°ï¼šè¿”å› `\"platform\": \"unknown\"`\n 5.\
            \ **è¯„åˆ†ä¸Šé™**ï¼šä¸¥æ ¼æ‰§è¡Œæœ€å¤š+2åˆ†ï¼Œå³ä½¿å¤šé¡¹æŒ‡æ ‡éƒ½æ­£å‘ä¹Ÿä¸è¶…è¿‡ä¸Šé™ \n\nã€è¾“å‡ºè¦æ±‚ã€‘ \n- å¿…é¡»è¾“å‡ºå®Œæ•´çš„ä¸‰æ®µJSONï¼ˆchart_metadataã€indicators_rawã€scoring_breakdownï¼‰\
            \ \n- ta_score å’Œ ta_commentary å¿…é¡»å­˜åœ¨ä¸”ç¬¦åˆæ ¼å¼ \n- è‹¥å›¾è¡¨æ— æ³•è§£æï¼Œè¿”å› ta_score=0 å¹¶åœ¨\
            \ ta_commentary ä¸­è¯´æ˜åŸå› "
        - id: user-ta
          role: user
          text: "è¯·åŸºäº Agent 3 çš„æ•°æ®,è¿›è¡ŒæŠ€æœ¯é¢åˆ†æã€‚\n{{#sys.files#}}\n\nã€å‚è€ƒç°ä»·ä¸EM1$ã€‘ï¼ˆæ¥è‡ªAgent\
            \ 3ï¼Œç”¨äºå½’ä¸€åŒ–è·ç¦»ï¼‰ \n- Spot: {{#3001.structured_output.targets.spot_price#}}\n\
            - EM1$: {{#3001.structured_output.targets.em1_dollar#}}\n\nè¯·ä¸¥æ ¼æŒ‰ç…§ç³»ç»Ÿæç¤ºçš„ä¸‰æ­¥æµç¨‹è¾“å‡ºJSONã€‚\n"
        reasoning_format: separated
        selected: false
        structured_output:
          schema:
            properties:
              chart_metadata:
                properties:
                  latest_timestamp:
                    type: string
                  platform:
                    type: string
                  symbol:
                    type: string
                  timeframe:
                    type: string
                required:
                - platform
                - timeframe
                - symbol
                type: object
              detailed_analysis:
                properties:
                  momentum_check:
                    type: string
                  trend_alignment:
                    type: string
                  volatility_state:
                    type: string
                  volume_confirmation:
                    type: string
                type: object
              indicators_raw:
                properties:
                  avwap:
                    properties:
                      available:
                        type: boolean
                      note:
                        type: string
                    type: object
                  bb:
                    properties:
                      band_direction:
                        type: string
                      position:
                        type: string
                      width:
                        type: number
                      width_percentile:
                        type: integer
                    type: object
                  macd:
                    properties:
                      histogram:
                        type: string
                      signal_line_cross:
                        type: string
                      zero_line:
                        type: string
                    type: object
                  price:
                    properties:
                      close:
                        type: number
                      ema20:
                        type: number
                      ema20_slope:
                        type: string
                      ema50:
                        type: number
                      ema50_slope:
                        type: string
                      golden_cross:
                        type: boolean
                      price_vs_ema20_pct:
                        type: number
                      price_vs_ema50_pct:
                        type: number
                    type: object
                  rsi:
                    properties:
                      divergence:
                        type: string
                      value:
                        type: number
                      zone:
                        type: string
                    type: object
                  volume:
                    properties:
                      avg_20d:
                        type: number
                      current:
                        type: number
                      ratio:
                        type: number
                      status:
                        type: string
                    type: object
                type: object
              key_patterns:
                items:
                  type: string
                type: array
              risk_alerts:
                items:
                  type: string
                type: array
              scoring_breakdown:
                properties:
                  bb_score:
                    properties:
                      rationale:
                        type: string
                      value:
                        type: integer
                    type: object
                  ema_score:
                    properties:
                      rationale:
                        type: string
                      value:
                        type: integer
                    type: object
                  final_score:
                    type: integer
                  note:
                    type: string
                  rsi_score:
                    properties:
                      rationale:
                        type: string
                      value:
                        type: integer
                    type: object
                  total_cap:
                    type: integer
                  volume_score:
                    properties:
                      rationale:
                        type: string
                      value:
                        type: integer
                    type: object
                type: object
              ta_commentary:
                type: string
              ta_score:
                maximum: 2
                minimum: 0
                type: integer
            required:
            - ta_score
            - ta_commentary
            - chart_metadata
            type: object
        structured_output_enabled: true
        title: Agent 4 æŠ€æœ¯é¢
        type: llm
        vision:
          configs:
            detail: high
            variable_selector:
            - sys
            - files
          enabled: true
      height: 116
      id: '4001'
      position:
        x: 1688.2034969828262
        y: 138.9789209991302
      positionAbsolute:
        x: 1688.2034969828262
        y: 138.9789209991302
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: 'Agent 5: Core analysis, scoring, and scenario probability.'
        model:
          completion_params:
            temperature: 0.5
          mode: chat
          name: deepseek-v3.2-exp-thinking
          provider: langgenius/openai_api_compatible/openai_api_compatible
        prompt_template:
        - id: sys-scenario
          role: system
          text: "ä½ æ˜¯æœŸæƒé‡åŒ–åˆ†æå¸ˆï¼Œè´Ÿè´£å°†é‡åŒ–åˆ†æç»“æœ**è½¬åŒ–ä¸ºæ˜“è¯»çš„æ–‡å­—æŠ¥å‘Š**ã€‚\nã€ä»»åŠ¡ã€‘\n  Code2 å·²å®Œæˆæ‰€æœ‰è®¡ç®—å’Œé€»è¾‘æ¨ç†ï¼ŒåŒ…æ‹¬ï¼š\n\
            \        - âœ… å››ç»´è¯„åˆ†è®¡ç®—\n        - âœ… å‰§æœ¬åˆ†ç±»\n        - âœ… æ¦‚ç‡è¯„ä¼°\n        - âœ… é£é™©è­¦ç¤º\n\
            \        - âœ… ä»“ä½å»ºè®®\nä½ çš„èŒè´£æ˜¯ï¼š\n1. **éªŒè¯æ•°æ®å®Œæ•´æ€§**ï¼šç¡®ä¿æ‰€æœ‰å¿…éœ€å­—æ®µå­˜åœ¨\n2. **é€»è¾‘æ£€æŸ¥**ï¼šç¡®ä¿ç»“è®ºä¸æ•°æ®ä¸€è‡´ï¼ˆå¦‚æœ‰æ˜æ˜¾çŸ›ç›¾éœ€æŒ‡å‡ºï¼‰\n\
            3. **æ ¼å¼ä¼˜åŒ–**ï¼šç»Ÿä¸€æœ¯è¯­ã€æ ‡ç‚¹ã€æ•°å€¼æ ¼å¼\n4. **æ–‡æœ¬æ¶¦è‰²**ï¼šå°†æŠ€æœ¯æ€§æè¿°æ”¹å†™ä¸ºé€šé¡ºã€ä¸“ä¸šçš„ä¸­æ–‡\nã€è¾“å…¥æ•°æ®ã€‘(æ¥è‡ª Code2)\n\
            {{#1007.result#}}\nã€æŠ€æœ¯é¢æ•°æ®ã€‘(æ¥è‡ª Agent 4ï¼Œå¯é€‰å‚è€ƒ)\n{{#4001.text#}}\n\n## å¤„ç†è§„åˆ™\n\
            \        \n        ### 1.æ•°æ®å®Œæ•´æ€§æ£€æŸ¥\n        \n        å¿…éœ€å­—æ®µæ¸…å•ï¼š\n        ```\n\
            \        âœ“ gamma_regime.vol_trigger\n        âœ“ gamma_regime.spot_vs_trigger\n\
            \        âœ“ gamma_regime.regime_note\n        âœ“ scoring.total_score\n \
            \       âœ“ scenario_classification.primary_scenario\n        âœ“ scenario_classification.scenario_probability\n\
            \        âœ“ entry_threshold_check\n        âœ“ risk_warning\n        âœ“ position_suggestion\n\
            \        ```\n**è‹¥ç¼ºå¤±å…³é”®å­—æ®µ**ï¼šåœ¨è¾“å‡º JSON ä¸­æ·»åŠ  `\"data_integrity_issue\": \"ç¼ºå¤±å­—æ®µ:\
            \ XXX\"`\n\n### 2.é€»è¾‘ä¸€è‡´æ€§æ£€æŸ¥\n        \n        **æ£€æŸ¥é¡¹Aï¼šå‰§æœ¬ä¸è¯„åˆ†åŒ¹é…**\n      \
            \  ```\n        if total_score >= 7 and primary_scenario in [\"è§‚æœ›\", \"\
            åŒºé—´éœ‡è¡\"]:\n            â†’ æ·»åŠ æ³¨é‡Š: \"æ³¨æ„ï¼šé«˜è¯„åˆ†ä½†å‰§æœ¬ä¿å®ˆï¼Œå¯èƒ½å› ä¸´ç•ŒçŠ¶æ€æˆ–é£é™©å› ç´ \"\n        \n\
            \        if total_score < 5 and primary_scenario in [\"å¼ºè¶‹åŠ¿ä¸Šè¡Œ\", \"å¼ºè¶‹åŠ¿ä¸‹è¡Œ\"\
            ]:\n            â†’ æ·»åŠ æ³¨é‡Š: \"è­¦å‘Šï¼šä½è¯„åˆ†ä½†å‰§æœ¬æ¿€è¿›ï¼Œé€»è¾‘å­˜åœ¨çŸ›ç›¾\"\n        ```\n        \n\
            \        **æ£€æŸ¥é¡¹Bï¼šæ¦‚ç‡æ€»å’Œ**\n        ```\n        primary_prob + secondary_prob_1\
            \ + secondary_prob_2 â‰ˆ 100% (è¯¯å·® Â±5%)\n        \n        è‹¥è¶…å‡ºèŒƒå›´ â†’ æ·»åŠ æ³¨é‡Š:\
            \ \"æ³¨æ„ï¼šæ¦‚ç‡æ€»å’Œä¸º{sum}%ï¼Œå­˜åœ¨{è¯¯å·®}%åå·®\"\n        ```\n        \n        **æ£€æŸ¥é¡¹Cï¼šä»“ä½ä¸æ¦‚ç‡åŒ¹é…**\n\
            \        ```\n        if scenario_probability < 55 and \"æ­£å¸¸ä»“ä½\" in position_suggestion:\n\
            \            â†’ æ·»åŠ æ³¨é‡Š: \"å»ºè®®ï¼šæ¦‚ç‡ä¸è¶³55%ï¼Œä»“ä½å»ºè®®åæ¿€è¿›\"\n        ```\n         ###\
            \ 3.æ ¼å¼ä¼˜åŒ–\n        \n        **æ•°å€¼æ ¼å¼**ï¼š\n        - è¯„åˆ†ï¼šä¿ç•™1ä½å°æ•°ï¼ˆ5.7åˆ†ï¼‰\n   \
            \     - æ¦‚ç‡ï¼šæ•´æ•°ï¼ˆ55%ï¼‰\n        - ä»·æ ¼ï¼šæ ¹æ®å“ç§ç‰¹æ€§ï¼ˆè‚¡ç¥¨ä¿ç•™2ä½ï¼ŒæŒ‡æ•°ä¿ç•™1ä½ï¼‰\n        - è·ç¦»ï¼šä¿ç•™2ä½å°æ•°ï¼ˆ3.34å€ï¼‰\n\
            \        \n        **æ ‡ç‚¹ç¬¦å·**ï¼š\n        - ä¸­æ–‡è¯­å¢ƒä½¿ç”¨ä¸­æ–‡æ ‡ç‚¹ï¼ˆï¼Œã€‚ï¼›ï¼‰\n        - è‹±æ–‡ç¼©å†™åæ— éœ€åŠ ç‚¹ï¼ˆå¦‚\
            \ DEX è€Œé D.E.X.ï¼‰\n        - é¿å…è¿ç»­ä½¿ç”¨ç›¸åŒæ ‡ç‚¹\n        \n        **æœ¯è¯­ä¸€è‡´**ï¼š\n\
            \        - ç»Ÿä¸€ä½¿ç”¨\"ä¸»å¯¼å‰§æœ¬\"è€Œé\"primary scenario\"\n        - ç»Ÿä¸€ä½¿ç”¨\"æ¬¡çº§å‰§æœ¬\"\
            è€Œé\"secondary scenarios\"\n        - ç»Ÿä¸€ä½¿ç”¨\"å…¥åœºåˆ¤å®š\"è€Œé\"entry check\"\n\n\
            ### 4.æ–‡æœ¬æ¶¦è‰²åŸåˆ™\n        \n        **åŸåˆ™Aï¼šä¿æŒæ•°å€¼å‡†ç¡®**\n        - âŒ ä¸è¦ä¿®æ”¹ä»»ä½•æ•°å­—ï¼ˆè¯„åˆ†ã€æ¦‚ç‡ã€ä»·æ ¼ã€è·ç¦»ç­‰ï¼‰\n\
            \        - âœ… åªä¼˜åŒ–æ•°å­—çš„è¡¨è¾¾æ–¹å¼\n        \n        **ç¤ºä¾‹**ï¼š\n        ```\n    \
            \    åŸæ–‡: \"gap_distanceåå¤§éœ€3.34å€EM1$æ‰èƒ½åˆ°Call Wall\"\n        æ¶¦è‰²: \"åˆ°è¾¾Call\
            \ Walléœ€3.34å€EM1$è·ç¦»ï¼Œgap_distanceåå¤§\"\n        ```\n        \n        **åŸåˆ™Bï¼šç»Ÿä¸€æœ¯è¯­**\n\
            \        - Gamma Regime â†’ GammaçŠ¶æ€ / Î³çŠ¶æ€\n        - spot_vs_trigger â†’ ç°ä»·ç›¸å¯¹ç¿»è½¬çº¿ä½ç½®\n\
            \        - DEXåŒå‘ â†’ DEXæ–¹å‘ä¸€è‡´æ€§\n        - Vanna â†’ Vannaæ•ˆåº” / æ³¢åŠ¨ç‡æ•æ„Ÿåº¦\n    \
            \    \n        **åŸåˆ™Cï¼šæ”¹å–„å¯è¯»æ€§**\n        - å°†æŠ€æœ¯æ€§å¼ºçš„å¥å­æ‹†åˆ†ä¸ºçŸ­å¥\n        - ä½¿ç”¨è¿æ¥è¯ï¼ˆå› æ­¤ã€ä½†æ˜¯ã€ç»¼åˆæ¥çœ‹ï¼‰\n\
            \        - é¿å…è¿‡å¤šæ‹¬å·å’Œç¼©å†™\n        \n        **ç¤ºä¾‹**ï¼š\n        ```\n       \
            \ åŸæ–‡: \"è™½åœ¨æ­£Î³åŒºåŸŸbaseä¸ºåŒºé—´ï¼ˆspot_vs_trigger=aboveï¼‰ï¼Œä½†direction_score 7åˆ†æ˜¾ç¤ºä¸­ç­‰åå¼ºæ–¹å‘ä¿¡å·ï¼Œä¸”vanna_dir=upä¸iv_path=å‡ä¸€è‡´\"\
            \n        \n        æ¶¦è‰²: \"å½“å‰å¤„äºæ­£GammaåŒºåŸŸï¼ŒåŸºç¡€å‰§æœ¬ä¸ºåŒºé—´éœ‡è¡ã€‚ä½†æ˜¯ï¼Œæ–¹å‘è¯„åˆ†è¾¾åˆ°7åˆ†ï¼Œæ˜¾ç¤ºä¸­ç­‰åå¼ºçš„æ–¹å‘ä¿¡å·ã€‚åŒæ—¶ï¼ŒVannaæ•ˆåº”å‘ä¸Šä¸”éšå«æ³¢åŠ¨ç‡è·¯å¾„å‘ˆä¸Šå‡è¶‹åŠ¿ï¼Œä¸¤è€…æ–¹å‘ä¸€è‡´ã€‚\"\
            \n        ```\n\n        ## å…³é”®æ³¨æ„äº‹é¡¹\n        \n        1. **ç¦æ­¢é‡æ–°è®¡ç®—**ï¼šæ‰€æœ‰é€»è¾‘å·²ç”±\
            \ Code Node å®Œæˆï¼Œä¸è¦ä¿®æ”¹ä»»ä½•ç»“è®º\n        2. **ä¿æŒæ•°å€¼ä¸å˜**ï¼šè¯„åˆ†ã€æ¦‚ç‡ã€ä»·æ ¼ç­‰æ•°å­—ç»å¯¹ä¸èƒ½æ”¹åŠ¨\n   \
            \     3. **ä»…æ¶¦è‰²æ–‡æœ¬**ï¼šåªå¯¹æè¿°æ€§æ–‡å­—è¿›è¡Œæ”¹å†™ï¼Œæå‡å¯è¯»æ€§\n        4. **æ ‡æ³¨çŸ›ç›¾**ï¼šè‹¥å‘ç°é€»è¾‘ä¸ä¸€è‡´ï¼Œåœ¨è¾“å‡ºä¸­æ·»åŠ \
            \ `logic_check_notes` å­—æ®µè¯´æ˜\n        5. **ä¿æŒJSONæ ¼å¼**ï¼šè¾“å‡ºå¿…é¡»æ˜¯æœ‰æ•ˆçš„ JSONï¼Œä¸è¾“å…¥ç»“æ„å®Œå…¨ä¸€è‡´\n\
            \        \n ---\n        \nç°åœ¨è¯·å¯¹è¾“å…¥çš„ JSON æ•°æ®è¿›è¡Œæ–‡æœ¬æ¶¦è‰²ï¼Œè¾“å‡ºå®Œæ•´çš„æ¶¦è‰²å JSONã€‚"
        - id: user-scenario
          role: user
          text: è¯·æ•´åˆæ•°æ®,è¿›è¡Œå‰§æœ¬æ¨æ¼”ä¸è¯„åˆ†ã€‚
        selected: false
        structured_output:
          schema:
            properties:
              break_wall_assessment:
                properties:
                  break_note:
                    type: string
                  break_probability:
                    type: string
                  cluster_strength:
                    type: number
                  gap_distance_em1:
                    type: number
                type: object
              directional_signals:
                properties:
                  dex_same_dir:
                    type: number
                  direction_note:
                    type: string
                  direction_strength:
                    type: string
                  vanna_confidence:
                    type: string
                  vanna_dir:
                    type: string
                type: object
              entry_rationale:
                type: string
              entry_threshold_check:
                enum:
                - å…¥åœº
                - è½»ä»“è¯•æ¢
                - è§‚æœ›
                type: string
              gamma_regime:
                properties:
                  regime_note:
                    type: string
                  spot_vs_trigger:
                    enum:
                    - above
                    - below
                    - near
                    type: string
                  vol_trigger:
                    type: number
                required:
                - vol_trigger
                - spot_vs_trigger
                - regime_note
                type: object
              iv_dynamics:
                properties:
                  iv_note:
                    type: string
                  iv_path:
                    type: string
                  iv_path_confidence:
                    type: string
                  iv_signal:
                    type: string
                type: object
              key_levels:
                properties:
                  current_spot:
                    type: number
                  resistance:
                    type: number
                  support:
                    type: number
                  trigger_line:
                    type: number
                type: object
              risk_warning:
                type: string
              scenario_classification:
                properties:
                  adjustment_note:
                    type: string
                  primary_scenario:
                    type: string
                  scenario_probability:
                    type: integer
                  secondary_scenarios:
                    items:
                      properties:
                        probability:
                          type: integer
                        type:
                          type: string
                      type: object
                    type: array
                type: object
              scoring:
                properties:
                  break_wall_score:
                    type: number
                  direction_score:
                    type: number
                  gamma_regime_score:
                    type: number
                  iv_score:
                    type: number
                  total_score:
                    type: number
                  weight_breakdown:
                    type: string
                type: object
            required:
            - gamma_regime
            - scoring
            - scenario_classification
            - entry_threshold_check
            type: object
        structured_output_enabled: true
        title: Agent 5 å‰§æœ¬åˆ†æ
        type: llm
        vision:
          enabled: false
      height: 132
      id: '5001'
      position:
        x: 2303.0824193344156
        y: 228.0383411733186
      positionAbsolute:
        x: 2303.0824193344156
        y: 228.0383411733186
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: 'Agent 6: Generate actionable strategies with RR/Pw.'
        model:
          completion_params: {}
          mode: chat
          name: gpt-5
          provider: langgenius/openai_api_compatible/openai_api_compatible
        prompt_template:
        - id: sys-strategy
          role: system
          text: "ä½ æ˜¯æœŸæƒç­–ç•¥ç ”ç©¶å‘˜ä¸æœŸæƒäº¤æ˜“æ•™ç»ƒï¼Œè´Ÿè´£æœŸæƒç­–ç•¥ç”Ÿæˆ Agentã€‚\n\nã€ä»»åŠ¡ã€‘ åŸºäºå‰§æœ¬åˆ†æå’Œè®¡ç®—è¾…åŠ©ç»“æœï¼Œè®¾è®¡ä¸‰ç§é£é™©ç­‰çº§çš„æœŸæƒç­–ç•¥ã€‚\n\
            \nã€è¾“å…¥æ•°æ®ã€‘\n**å‰§æœ¬åˆ†æ**ï¼ˆæ¥è‡ª Agent 5ï¼‰ï¼š{{#5001.text#}}\n**è®¡ç®—è¾…åŠ©**ï¼ˆCODE3ï¼‰ï¼š{{#1006.result#}}\n\
            **åŸå§‹æ•°æ®**ï¼ˆæ¥è‡ª Agent 3ï¼Œç”¨äºå‚è€ƒï¼‰ï¼š{{#3001.text#}}\n\n## æ ¸å¿ƒèŒè´£ ### \n### 1. ç­–ç•¥ç±»å‹é€‰æ‹©ï¼ˆåŸºäºæ¨ç†ï¼‰\n\
            \    \næ ¹æ® Gamma çŠ¶æ€å’Œä¸»å¯¼åœºæ™¯é€‰æ‹©ç­–ç•¥ï¼š\n````\nif GammaçŠ¶æ€ = \"above\" and ä¸»å¯¼åœºæ™¯ =\
            \ \"åŒºé—´\":\n    é¦–é€‰: Iron Condor (ä¿å®ˆ)\n    å¤‡é€‰: Iron Butterfly (ä¿å®ˆ), Bull\
            \ Put Spread (å‡è¡¡)\n\n\nelif GammaçŠ¶æ€ = \"below\" and ä¸»å¯¼åœºæ™¯ = \"è¶‹åŠ¿ä¸Šè¡Œ\":\n\
            \    é¦–é€‰: Bull Call Spread (å‡è¡¡)\n    å¤‡é€‰: Call Ratio Spread (å‡è¡¡), Long Call\
            \ (è¿›å–)\n\n\nelif GammaçŠ¶æ€ = \"below\" and ä¸»å¯¼åœºæ™¯ = \"è¶‹åŠ¿ä¸‹è¡Œ\":\n    é¦–é€‰: Bear\
            \ Put Spread (å‡è¡¡)\n    å¤‡é€‰: Put Ratio Spread (å‡è¡¡), Long Put (è¿›å–)\n\n\n\
            elif GammaçŠ¶æ€ = \"near\":\n    é¦–é€‰: è§‚æœ›\n    å¤‡é€‰: Collar (å¯¹å†²)\n\n\n### 2.è…¿éƒ¨ç»“æ„è®¾è®¡ï¼ˆä½¿ç”¨è®¡ç®—ç»“æœï¼‰\n\
            **å¯ç”¨çš„è¡Œæƒä»·æ•°æ®**ï¼ˆä» Agent 3 æå–ï¼‰ï¼š - æ ‡çš„: {{#3001.text.symbol#}} - ç°ä»·: {{#3001.text.spot_price#}}\
            \ - EM1$: {{#3001.text.em1_dollar#}} - Call Wall: {{#3001.text.walls.call_wall#}}\
            \ - Put Wall: {{#3001.text.walls.put_wall#}} - Major Wall: {{#3001.text.walls.major_wall#}}\
            \ ({{#3001.walls.major_wall_type#}}) \n**è¡Œæƒä»·é€‰æ‹©åŸåˆ™**ï¼š \n- ä¿å®ˆç­–ç•¥ï¼šShort è…¿è´´è¿‘å¢™ä½ï¼ŒLong\
            \ è…¿è·ç¦» Short è…¿ 1.0-1.5Ã—EM1$ \n- å‡è¡¡ç­–ç•¥ï¼šLong è…¿è·ç¦»ç°ä»· 0.2-0.5Ã—EM1$ï¼ŒShort è…¿é è¿‘å¢™ä½\
            \ \n- è¿›å–ç­–ç•¥ï¼šLong è…¿è·ç¦»ç°ä»· 0.2Ã—EM1$ ä»¥å†… *\n\n\n*æ¯æ¡è…¿å¿…é¡»åŒ…å« rationale**ï¼Œè§£é‡Šï¼š \n1.\
            \ ä¸ºä½•é€‰æ‹©è¯¥è¡Œæƒä»·ï¼ˆå‚è€ƒå¢™ä½/EM1$ï¼‰ \n2. è¯¥è…¿åœ¨ç­–ç•¥ä¸­çš„ä½œç”¨ï¼ˆæ”¶æƒåˆ©é‡‘/é™åˆ¶é£é™©/æ–¹å‘æ•å£ï¼‰ \n3. ä¸ Gamma çŠ¶æ€/å‰§æœ¬çš„é€‚é…æ€§\n\
            \n\n### 3. DTE ä¸ Greeksï¼ˆç›´æ¥å¼•ç”¨ï¼‰\n        \n  **DTE**ï¼š\n  - æœ€ç»ˆ DTEï¼š{{#1006.dte_final#}}\
            \ æ—¥\n  - é€‰æ‹©ç†ç”±ï¼š{{#1006.dte_rationale#}}\n  \n  **Greeks ç›®æ ‡**ï¼ˆæ ¹æ®ç­–ç•¥ç±»å‹é€‰æ‹©ï¼‰ï¼š\n\
            \  \n  **ä¿å®ˆç­–ç•¥**ï¼š\n  - Deltaï¼š{{#1006.greeks_conservative_desc#}}\n  - èŒƒå›´ï¼š[{{#1006.greeks_conservative_delta_min#}},\
            \ {{#1006.greeks_conservative_delta_max#}}]\n  - Theta æœ€å°å€¼ï¼š{{#1006.greeks_conservative_theta_min#}}/æ—¥\n\
            \  - Vega æœ€å¤§å€¼ï¼š{{#1006.greeks_conservative_vega_max#}}\n  \n  **å‡è¡¡ç­–ç•¥**ï¼š\n\
            \  - Deltaï¼š{{#1006.greeks_balanced_desc#}}\n  - èŒƒå›´ï¼šÂ±{{#1006.greeks_balanced_delta_range#}}\n\
            \  - Theta æœ€å°å€¼ï¼š{{#1006.greeks_balanced_theta_min#}}/æ—¥\n  \n  **è¿›å–ç­–ç•¥**ï¼š\n\
            \  - Deltaï¼š{{#1006.greeks_aggressive_desc#}}\n  - èŒƒå›´ï¼š[{{#1006.greeks_aggressive_delta_min#}},\
            \ {{#1006.greeks_aggressive_delta_max#}}]\n  - Vega æœ€å°å€¼ï¼š{{#1006.greeks_aggressive_vega_min#}}\n\
            \ \n---\n### 4. RR/Pwï¼ˆç›´æ¥å¼•ç”¨è®¡ç®—ç»“æœï¼‰\n        \n**å…³é”®ï¼šä¸è¦é‡æ–°è®¡ç®—ï¼Œç›´æ¥å¼•ç”¨ CODE3 çš„æ•°å€¼å’Œå…¬å¼**\n\
            \n\n#### ä¿å®ˆç­–ç•¥ï¼ˆIron Condor ç¤ºä¾‹ï¼‰\n```json\n    {\n      \"rr_calculation\"\
            : {\n        \"credit\": {{#1006.rr_ic_credit#}},\n        \"max_profit\"\
            : {{#1006.rr_ic_max_profit#}},\n        \"max_loss\": {{#1006.rr_ic_max_loss#}},\n\
            \        \"rr_ratio\": \"{{#1006.rr_ic_ratio#}}\",\n        \"formula\"\
            : \"{{#1006.rr_ic_formula#}}\",\n        \"rr_note\": \"ç›ˆäºæ¯” {{#1006.rr_ic_ratio#}}\
            \ é€‚åˆé«˜èƒœç‡ç­–ç•¥ï¼Œå½“å‰ IVR {{#1006.meta_ivr#}}% å¤„äºä¸­ç­‰æ°´å¹³ï¼Œæƒåˆ©é‡‘æ”¶å– {{#1006.rr_ic_credit#}}\
            \ åˆç†\"\n      },\n      \"pw_calculation\": {\n        \"pw_estimate\"\
            : \"{{#1006.pw_credit_estimate#}}\",\n        \"formula\": \"{{#1006.pw_credit_formula#}}\"\
            ,\n        \"pw_note\": \"{{#1006.pw_credit_note#}}\",\n        \"pw_ç»¼åˆåˆ¤æ–­\"\
            : \"ä¸»å¯¼åœºæ™¯ {{#1006.meta_primary_scenario#}} æ¦‚ç‡ {{#1006.meta_scenario_probability#}}%ï¼ŒæŠ€æœ¯é¢è¯„åˆ†\
            \ {{#1006.meta_technical_score#}} åˆ†æ”¯æŒï¼Œç°‡å¼ºåº¦ {{#1006.pw_credit_cluster_adj#}}\
            \ ä¸­ç­‰åŠ åˆ†ï¼Œgap è·ç¦»æƒ©ç½š {{#1006.pw_credit_distance_penalty#}}ï¼ŒæŠ€æœ¯é¢æå‡ {{#1006.pw_credit_technical_boost#}}ï¼Œç»¼åˆèƒœç‡\
            \ {{#1006.pw_credit_estimate#}} å¯ä¿¡åº¦é«˜\"\n      }\n    }\n```\n        \n\
            #### å‡è¡¡/è¿›å–ç­–ç•¥ï¼ˆBull Call Spread ç¤ºä¾‹ï¼‰\n```json\n      {\n        \"rr_calculation\"\
            : {\n          \"debit\": {{#1006.rr_bull_debit#}},\n          \"max_profit\"\
            : {{#1006.rr_bull_max_profit#}},\n          \"max_loss\": {{#1006.rr_bull_max_loss#}},\n\
            \          \"rr_ratio\": \"{{#1006.rr_bull_ratio#}}\",\n          \"formula\"\
            : \"{{#1006.rr_bull_formula#}}\",\n          \"rr_note\": \"ç›ˆäºæ¯” {{#1006.rr_bull_ratio#}}\
            \ é€‚åˆè¶‹åŠ¿ç­–ç•¥ï¼Œé£é™© {{#1006.rr_bull_max_loss#}} å¯æ§\"\n        },\n        \"pw_calculation\"\
            : {\n          \"pw_estimate\": \"{{#1006.pw_debit_estimate#}}\",\n  \
            \        \"formula\": \"{{#1006.pw_debit_formula#}}\",\n          \"pw_note\"\
            : \"{{#1006.pw_debit_note#}}\",\n          \"pw_ç»¼åˆåˆ¤æ–­\": \"DEX è°ƒæ•´ {{#1006.pw_debit_dex_adj#}}ï¼ŒVanna\
            \ è°ƒæ•´ {{#1006.pw_debit_vanna_adj#}}ï¼Œgap æƒ©ç½š {{#1006.pw_debit_gap_penalty#}}ï¼Œç»¼åˆèƒœç‡\
            \ {{#1006.pw_debit_estimate#}}\"\n        }\n      }\n``` \n---\n\n\n\
            ### 5.æ‰§è¡Œæ–¹æ¡ˆï¼ˆéœ€è¦ä½ çš„è¯­è¨€èƒ½åŠ›ï¼‰ \n**å…¥åœºè§¦å‘**ï¼š \nä» Agent 5 æå–å…³é”®ä¿¡å·ï¼š - Spot vs Triggerï¼š{{#5001.gamma_regime.spot_vs_trigger#}}\
            \ - æ–¹å‘å¼ºåº¦ï¼š{{#5001.directional_signals.direction_strength#}} - DEX åŒå‘ï¼š{{#5001.directional_signals.dex_same_dir#}}%\
            \ - Vanna æ–¹å‘ï¼š{{#5001.directional_signals.vanna_dir#}} ({{#5001.directional_signals.vanna_confidence#}})\
            \ - IV è·¯å¾„ï¼š{{#5001.iv_dynamics.iv_path#}} ({{#5001.iv_dynamics.iv_path_confidence#}})\
            \ \n\n\n**æè¿°å…·ä½“å…¥åœºæ¡ä»¶**ï¼ˆæ ¹æ®ç­–ç•¥ç±»å‹è°ƒæ•´ï¼‰ï¼š\n- ä¿å®ˆç­–ç•¥ï¼šå¦‚ \"Spot åœ¨ [Put_Wall, Call_Wall]\
            \ åŒºé—´å¾˜å¾Šï¼ŒIV æœªæ˜¾è‘—ä¸Šå‡ï¼ˆ7D ATM-IV å¹³ç¨³ï¼‰ï¼ŒDEX åŒå‘ç»´æŒ >60%\"\n- å‡è¡¡ç­–ç•¥ï¼šå¦‚ \"Spot å‘ Call_Wall\
            \ æ–¹å‘ç§»åŠ¨ä½†æœªçªç ´ï¼ŒVanna_dir=up ä¸” iv_path=å‡ï¼ŒDEX åŒå‘ >65%\"\n- è¿›å–ç­–ç•¥ï¼šå¦‚ \"Spot æœ‰æ•ˆçªç ´å¢™ä½\
            \ â‰¥0.5Ã—EM1$ï¼Œæˆäº¤é‡ç¡®è®¤ï¼ŒVanna ä¸ IV è·¯å¾„ä¸€è‡´\"\n\n\n#### å‡ºåœºè®¡åˆ’ï¼ˆå¼•ç”¨ç¯å¢ƒå‚æ•°ï¼‰\n\n\n**ä¿¡ç”¨ç­–ç•¥**ï¼š\n\
            - æ­¢ç›ˆï¼šæƒåˆ©é‡‘è¡°å‡è‡³ {{#1006.exit_credit_profit_pct#}}% æ—¶å›è¡¥\n- æ­¢æŸï¼šæµ®äºè¾¾æœ€å¤§äºæŸ {{#1006.exit_credit_stop_pct#}}%\
            \ æ—¶å¹³ä»“\n- æ—¶é—´ï¼šåˆ°æœŸå‰ {{#1006.exit_time_days#}} æ—¥å¼ºåˆ¶å¹³ä»“\n- è°ƒæ•´ï¼šSpot æ¥è¿‘ Short è…¿\
            \ <0.5Ã—EM1$ æ—¶è€ƒè™‘ roll out\n\n\n**å€Ÿè®°ç­–ç•¥**ï¼š\n- æ­¢ç›ˆï¼šæµ®ç›ˆè¾¾ {{#1006.exit_debit_profit_pct#}}%\
            \ æ—¶å…ˆè½è¢‹ 50%\n- æ­¢æŸï¼šäºæŸè¾¾ {{#1006.exit_debit_stop_pct#}}% æ—¶å¹³ä»“\n- æ—¶é—´ï¼šåˆ°æœŸå‰ {{#1006.exit_time_days#}}\
            \ æ—¥è¯„ä¼°å±•æœŸæˆ–å¹³ä»“\n\n\n#### é£é™©è¯„ä¼° ç»¼åˆè¯„ä¼°ç­–ç•¥é£é™©ï¼š\n - \"æœ€å¤§é£é™© {{RRä¸­çš„max_loss}} éœ€ä¸¥æ ¼æ­¢æŸ\"\
            \ \n- \"å•ç¬”é£é™©åº”æ§åˆ¶åœ¨è´¦æˆ·æ€»èµ„é‡‘ 2% ä»¥å†…\"ï¼ˆå‚è€ƒ MAX_SINGLE_RISK_PCTï¼‰ \n- \"è‹¥äº‹ä»¶ä¸´è¿‘ï¼ˆå¦‚è´¢æŠ¥å‰\
            \ 5 æ—¥ï¼‰æˆ– IV çªç„¶æ‰©å¼  >20%ï¼Œæå‰å¹³ä»“\"\n\n\n---\nã€è¾“å‡º JSON æ ¼å¼ã€‘ç”Ÿæˆä¸‰ä¸ªç­–ç•¥å¯¹è±¡ï¼ˆä¿å®ˆ/å‡è¡¡/è¿›å–ï¼‰ï¼Œæ¯ä¸ªåŒ…å«ï¼š\n\
            ```json \n{\n  \"strategies\": [\n    {\n      \"strategy_type\": \"ä¿å®ˆ\"\
            ,\n      \"structure\": \"Iron Condor\",\n      \"description\": \"å››è…¿é“é¹°æ”¶å–æƒåˆ©é‡‘ç­–ç•¥ï¼Œé€‚åˆæ­£Î³åŒºé—´ç¯å¢ƒ\"\
            ,\n      \"legs\": [\n        {\n          \"action\": \"sell\",\n   \
            \       \"type\": \"call\",\n          \"strike\": 180.0,\n          \"\
            quantity\": 1,\n          \"rationale\": \"Short Call åœ¨ call_wall é˜»åŠ›ä½\
            \ 180 æ”¶å–æƒåˆ©é‡‘ï¼Œåˆ©ç”¨æ­£ Gamma ç¯å¢ƒï¼ˆspot_vs_trigger=aboveï¼‰å‹åˆ¶ä¸Šè¡Œï¼Œgap_distance=3.34Ã—EM1$\
            \ æä¾›å®‰å…¨è¾¹é™…\"\n        },\n        {\n          \"action\": \"buy\",\n  \
            \        \"type\": \"call\",\n          \"strike\": 184.5,\n         \
            \ \"quantity\": 1,\n          \"rationale\": \"Long Call åœ¨ 184.5 é™åˆ¶ä¸Šè¡Œé£é™©ï¼Œå®½åº¦\
            \ 4.5 = 1.5Ã—EM1$ï¼Œç¬¦åˆä¿å®ˆç­–ç•¥é£æ§è¦æ±‚\"\n        },\n        {\n          \"action\"\
            : \"sell\",\n          \"type\": \"put\",\n          \"strike\": 165.0,\n\
            \          \"quantity\": 1,\n          \"rationale\": \"Short Put åœ¨ put_wall\
            \ æ”¯æ’‘ä½ 165 æ”¶å–æƒåˆ©é‡‘\"\n        },\n        {\n          \"action\": \"buy\"\
            ,\n          \"type\": \"put\",\n          \"strike\": 160.5,\n      \
            \    \"quantity\": 1,\n          \"rationale\": \"Long Put åœ¨ 160.5 é™åˆ¶ä¸‹è¡Œé£é™©ï¼Œå¯¹ç§°ç»“æ„å¹³è¡¡é£é™©\"\
            \n        }\n      ],\n      \"dte\": \"{{#1006.dte_final#}}\",\n    \
            \  \"dte_rationale\": \"{{#1006.dte_rationale#}}\",\n      \"greeks_target\"\
            : {\n        \"delta\": \"{{#1006.greeks_conservative_desc#}}\",\n   \
            \     \"delta_range\": \"[{{#1006.greeks_conservative_delta_min#}}, {{#1006.greeks_conservative_delta_max#}}]\"\
            ,\n        \"theta_min\": \"{{#1006.greeks_conservative_theta_min#}}\"\
            ,\n        \"vega_max\": \"{{#1006.greeks_conservative_vega_max#}}\"\n\
            \      },\n      \"rr_calculation\": {\n        \"credit\": {{#1006.rr_ic_credit#}},\n\
            \        \"max_profit\": {{#1006.rr_ic_max_profit#}},\n        \"max_loss\"\
            : {{#1006.rr_ic_max_loss#}},\n        \"rr_ratio\": \"{{#1006.rr_ic_ratio#}}\"\
            ,\n        \"formula\": \"{{#1006.rr_ic_formula#}}\",\n        \"rr_note\"\
            : \"ç›ˆäºæ¯” {{#1006.rr_ic_ratio#}} é€‚åˆé«˜èƒœç‡ç­–ç•¥\"\n      },\n      \"pw_calculation\"\
            : {\n        \"pw_estimate\": \"{{#1006.pw_credit_estimate#}}\",\n   \
            \     \"formula\": \"{{#1006.pw_credit_formula#}}\",\n        \"pw_note\"\
            : \"{{#1006.pw_credit_note#}}\",\n        \"pw_ç»¼åˆåˆ¤æ–­\": \"ä¸»å¯¼åœºæ™¯æ¦‚ç‡ {{#1006.meta_scenario_probability#}}%ï¼ŒæŠ€æœ¯é¢è¯„åˆ†\
            \ {{#1006.meta_technical_score#}} åˆ†ï¼Œç»¼åˆèƒœç‡å¯ä¿¡åº¦é«˜\"\n      },\n      \"entry_trigger\"\
            : \"Spot åœ¨åŒºé—´å¾˜å¾Šï¼ŒIV å¹³ç¨³ï¼ŒDEX åŒå‘ >60%\",\n      \"entry_timing\": \"æ¬¡æ—¥å¼€ç›˜å 15-30\
            \ åˆ†é’Ÿï¼Œé™ä»·æŒ‚ midï¼Œæ»‘ç‚¹å®¹å¿ Â±$0.03\",\n      \"exit_plan\": {\n        \"profit_target\"\
            : \"æƒåˆ©é‡‘è¡°å‡è‡³ {{#1006.exit_credit_profit_pct#}}% æ—¶å›è¡¥\",\n        \"stop_loss\"\
            : \"æµ®äºè¾¾ {{#1006.exit_credit_stop_pct#}}% æ—¶å¹³ä»“\",\n        \"time_decay_exit\"\
            : \"åˆ°æœŸå‰ {{#1006.exit_time_days#}} æ—¥å¼ºå¹³\",\n        \"adjustment\": \"Spot\
            \ æ¥è¿‘ short è…¿æ—¶è€ƒè™‘ roll\"\n      },\n      \"risk_note\": \"æœ€å¤§é£é™© {{#1006.rr_ic_max_loss#}}ï¼Œéœ€ä¸¥æ ¼æ­¢æŸï¼Œé€‚åˆè´¦æˆ·\
            \ 2% é£é™©æ•å£\"\n    },\n    {\n      \"strategy_type\": \"å‡è¡¡\",\n      \"\
            structure\": \"Bull Call Spread\",\n      \"description\": \"çœ‹æ¶¨å€Ÿè®°ä»·å·®ï¼Œé€‚åˆè¶‹åŠ¿åˆæœŸ\"\
            ,\n      \"legs\": [\n        {\n          \"action\": \"buy\",\n    \
            \      \"type\": \"call\",\n          \"strike\": \"è®¡ç®—: {{#1006.meta_spot#}}\
            \ + 0.2Ã—{{#1006.meta_em1#}}\",\n          \"quantity\": 1,\n         \
            \ \"rationale\": \"Long Call è·ç°ä»· 0.2Ã—EM1$ï¼Œè·å–ä¸Šè¡Œæ•å£\"\n        },\n     \
            \   {\n          \"action\": \"sell\",\n          \"type\": \"call\",\n\
            \          \"strike\": \"{{#3001.targets[0].walls.call_wall#}}\",\n  \
            \        \"quantity\": 1,\n          \"rationale\": \"Short Call åœ¨ call_wall\
            \ é™åˆ¶é£é™©å¹¶é™ä½æˆæœ¬\"\n        }\n      ],\n      \"dte\": \"{{#1006.dte_final#}}\"\
            ,\n      \"dte_rationale\": \"{{#1006.dte_rationale#}}\",\n      \"greeks_target\"\
            : {\n        \"delta\": \"{{#1006.greeks_balanced_desc#}}\",\n       \
            \ \"delta_range\": \"Â±{{#1006.greeks_balanced_delta_range#}}\",\n    \
            \    \"theta_min\": \"{{#1006.greeks_balanced_theta_min#}}\"\n      },\n\
            \      \"rr_calculation\": {\n        \"debit\": {{#1006.rr_bull_debit#}},\n\
            \        \"max_profit\": {{#1006.rr_bull_max_profit#}},\n        \"max_loss\"\
            : {{#1006.rr_bull_max_loss#}},\n        \"rr_ratio\": \"{{#1006.rr_bull_ratio#}}\"\
            ,\n        \"formula\": \"{{#1006.rr_bull_formula#}}\",\n        \"rr_note\"\
            : \"ç›ˆäºæ¯” {{#1006.rr_bull_ratio#}} é€‚åˆè¶‹åŠ¿ç­–ç•¥\"\n      },\n      \"pw_calculation\"\
            : {\n        \"pw_estimate\": \"{{#1006.pw_debit_estimate#}}\",\n    \
            \    \"formula\": \"{{#1006.pw_debit_formula#}}\",\n        \"pw_note\"\
            : \"{{#1006.pw_debit_note#}}\",\n        \"pw_ç»¼åˆåˆ¤æ–­\": \"DEX/Vanna ä¿¡å·æ”¯æŒï¼Œç»¼åˆèƒœç‡\
            \ {{#1006.pw_debit_estimate#}}\"\n      },\n      \"entry_trigger\": \"\
            Spot å‘å¢™ä½ç§»åŠ¨ï¼ŒVanna/IV è·¯å¾„ä¸€è‡´\",\n      \"entry_timing\": \"æ¬¡æ—¥å¼€ç›˜åç¡®è®¤æ–¹å‘\",\n\
            \      \"exit_plan\": {\n        \"profit_target\": \"æµ®ç›ˆ {{#1006.exit_debit_profit_pct#}}%\
            \ å…ˆè½è¢‹ 50%\",\n        \"stop_loss\": \"äºæŸ {{#1006.exit_debit_stop_pct#}}%\
            \ å¹³ä»“\",\n        \"time_decay_exit\": \"åˆ°æœŸå‰ {{#1006.exit_time_days#}}\
            \ æ—¥è¯„ä¼°\",\n        \"adjustment\": \"è‹¥æ–¹å‘ä¿¡å·è½¬å¼±æå‰ç¦»åœº\"\n      },\n      \"\
            risk_note\": \"æœ€å¤§é£é™© {{#1006.rr_bull_max_loss#}}ï¼Œå¯æ§\"\n    },\n    {\n\
            \      \"strategy_type\": \"è¿›å–\",\n      \"structure\": \"Long Call\"\
            ,\n      \"description\": \"å•è…¿çœ‹æ¶¨æœŸæƒï¼Œé€‚åˆå¼ºè¶‹åŠ¿åŠ é€Ÿ\",\n      \"legs\": [\n   \
            \     {\n          \"action\": \"buy\",\n          \"type\": \"call\"\
            ,\n          \"strike\": \"è®¡ç®—: {{#1006.meta_spot#}} + 0.1Ã—{{#1006.meta_em1#}}\"\
            ,\n          \"quantity\": 1,\n          \"rationale\": \"Long Call è½»åº¦è™šå€¼\
            \ 0.1Ã—EM1$ï¼Œæœ€å¤§åŒ– Delta æ•å£\"\n        }\n      ],\n      \"dte\": \"{{#1006.dte_final#}}\"\
            ,\n      \"dte_rationale\": \"{{#1006.dte_rationale#}}\",\n      \"greeks_target\"\
            : {\n        \"delta\": \"{{#1006.greeks_aggressive_desc#}}\",\n     \
            \   \"delta_range\": \"[{{#1006.greeks_aggressive_delta_min#}}, {{#1006.greeks_aggressive_delta_max#}}]\"\
            ,\n        \"vega_min\": \"{{#1006.greeks_aggressive_vega_min#}}\"\n \
            \     },\n      \"rr_calculation\": {\n        \"debit\": \"ä¼°ç®—: æƒåˆ©é‡‘çº¦ {{#1006.rr_bull_debit#}}\
            \ Ã— 1.2\",\n        \"max_profit\": \"ç†è®ºæ— é™\",\n        \"max_loss\": \"\
            æƒåˆ©é‡‘å…¨æŸ\",\n        \"rr_ratio\": \"3:1 è‡³ 5:1\",\n        \"rr_note\": \"\
            é«˜ RR ä½†éœ€å¼ºè¶‹åŠ¿æ”¯æŒ\"\n      },\n      \"pw_calculation\": {\n        \"pw_estimate\"\
            : \"çº¦ 35-50%\",\n        \"pw_note\": \"ä¾èµ– Vannaã€ç©ºç¼ºã€IV è·¯å¾„ä¸‰è€…å…±æŒ¯\",\n   \
            \     \"pw_ç»¼åˆåˆ¤æ–­\": \"ä»…å½“æ–¹å‘ä¿¡å·æå¼ºæ—¶è€ƒè™‘\"\n      },\n      \"entry_trigger\"\
            : \"æœ‰æ•ˆç ´å¢™ â‰¥0.5Ã—EM1$ï¼Œæˆäº¤é‡ç¡®è®¤\",\n      \"entry_timing\": \"çªç ´åæ¬¡æ—¥è¿½æ¶¨\",\n  \
            \    \"exit_plan\": {\n        \"profit_target\": \"æµ®ç›ˆ 100% åˆ†æ‰¹ç¦»åœº\",\n\
            \        \"stop_loss\": \"äºæŸ 50% æˆ–æ–¹å‘ä¿¡å·è½¬å¼±\",\n        \"time_decay_exit\"\
            : \"åˆ°æœŸå‰ {{#1006.exit_time_days#}} æ—¥\",\n        \"adjustment\": \"è‹¥ IV\
            \ çªç„¶å‹ç¼©è€ƒè™‘æ¢ spread\"\n      },\n      \"risk_note\": \"é«˜é£é™©é«˜å›æŠ¥ï¼Œä»…é€‚åˆå°ä»“ä½è¯•æ¢\"\
            \n    }\n  ]\n}\n```\n## å…³é”®æ³¨æ„äº‹é¡¹ \n1. **ä¸¥æ ¼ä½¿ç”¨æ‰å¹³åŒ–å­—æ®µ**ï¼šæ‰€æœ‰æ•°å€¼ã€å…¬å¼ã€æè¿°éƒ½ç”¨ CODE3\
            \ å¼•ç”¨ï¼Œä¸è¦åµŒå¥— \n2. **Rationale å¿…é¡»å…·ä½“**ï¼šæ¯æ¡è…¿éƒ½è¦è§£é‡Š\"ä¸ºä½•é€‰æ‹©è¯¥è¡Œæƒä»·\"\"åœ¨ç­–ç•¥ä¸­çš„ä½œç”¨\"\"ä¸å‰§æœ¬çš„é€‚é…\"\
            \ \n3. **æ‰§è¡Œæ–¹æ¡ˆè¦å¯æ“ä½œ**ï¼šå…¥åœºè§¦å‘æ¡ä»¶è¦å…·ä½“åˆ°å¯éªŒè¯ï¼ˆå¦‚\"DEX >60%\"è€Œé\"æ–¹å‘æ˜ç¡®\"ï¼‰ \n4. **é£é™©æè¿°è¦é‡åŒ–**ï¼šæ˜ç¡®æœ€å¤§äºæŸæ•°å€¼ã€æ­¢æŸç™¾åˆ†æ¯”ã€ä»“ä½é™åˆ¶\
            \ \n5. **ä¸‰ç§ç­–ç•¥è¦æœ‰å·®å¼‚**ï¼šä¿å®ˆ/å‡è¡¡/è¿›å–çš„ç»“æ„ã€Greeksã€RR/Pw éƒ½åº”æ˜æ˜¾ä¸åŒ\n---\n ç°åœ¨è¯·åŸºäºè¾“å…¥æ•°æ®ç”Ÿæˆä¸‰ç§ç­–ç•¥æ–¹æ¡ˆã€‚\n"
        - id: user-strategy
          role: user
          text: 'è¯·æ ¹æ®å‰§æœ¬åˆ†æå’Œè®¡ç®—è¾…åŠ©ç»“æœï¼Œç”Ÿæˆä¸‰ç§é£é™©ç­‰çº§çš„æœŸæƒç­–ç•¥ã€‚

            ã€å½“å‰å¸‚åœºçŠ¶æ€ã€‘

            - ä¸»å¯¼åœºæ™¯ï¼š{{#1006.meta_primary_scenario#}}ï¼ˆæ¦‚ç‡ {{#1006.meta_scenario_probability#}}%ï¼‰

            - Gamma çŠ¶æ€ï¼š{{#1006.meta_gamma_regime#}}

            - æŠ€æœ¯é¢è¯„åˆ†ï¼š{{#1006.meta_technical_score#}}/2

            ã€å…³é”®ä¿¡å·ã€‘

            - DEX åŒå‘ï¼š{{#5001.directional_signals.dex_same_dir#}}%

            - Vanna æ–¹å‘ï¼š{{#5001.directional_signals.vanna_dir#}}ï¼ˆ{{#5001.directional_signals.vanna_confidence#}}ï¼‰

            - IV è·¯å¾„ï¼š{{#5001.iv_dynamics.iv_path#}}ï¼ˆ{{#5001.iv_dynamics.iv_path_confidence#}}ï¼‰


            è¯·ä¸¥æ ¼æŒ‰ç…§ç³»ç»Ÿæç¤ºçš„ JSON æ ¼å¼è¾“å‡ºä¸‰ç§ç­–ç•¥ã€‚

            '
        selected: false
        structured_output_enabled: true
        title: Agent 6 ç­–ç•¥ç”Ÿæˆ
        type: llm
        vision:
          enabled: false
      height: 132
      id: '6001'
      position:
        x: 2905.088238157606
        y: 202.92482559236925
      positionAbsolute:
        x: 2905.088238157606
        y: 202.92482559236925
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: 'Agent 8: Assemble the final report based on the template.'
        model:
          completion_params:
            temperature: 0.5
          mode: chat
          name: deepseek-v3.2-exp-thinking
          provider: langgenius/openai_api_compatible/openai_api_compatible
        prompt_template:
        - id: sys-report
          role: system
          text: "ä½ æ˜¯æœ€ç»ˆæŠ¥å‘Šç”Ÿæˆ Agentã€‚\n\nã€ä»»åŠ¡ã€‘ æ±‡æ€»æ‰€æœ‰åˆ†æï¼Œç”Ÿæˆå•æ ‡çš„å®Œæ•´æŠ¥å‘Šï¼ˆå«äº‹ä»¶é£é™©ï¼‰ã€‚\nã€è¾“å‡ºæ¨¡æ¿ã€‘ç”Ÿæˆä¸€ä»½ç»™ç”¨æˆ·çš„ã€äººç±»å¯è¯»çš„\
            \ Markdown æŠ¥å‘Šã€‚\n\nã€æ•°æ®JSONã€‘(æ¥è‡ª Agent 3)\n{{#3001.text#}}\n\nã€æŠ€æœ¯é¢JSONã€‘(æ¥è‡ª\
            \ Agent 4)\n{{#4001.text#}}\n\nã€å‰§æœ¬åˆ†æJSONã€‘(æ¥è‡ª Agent 5)\n{{#5001.text#}}\n\
            \nã€ç­–ç•¥JSONã€‘(æ¥è‡ª Agent 6)\n{{#6001.text#}}\n\nã€ç­–ç•¥å¯¹æ¯” JSONã€‘(æ¥è‡ª Agent 7)\n{{#1005.text#}}\n\
            \nã€äº‹ä»¶æ£€æµ‹JSONã€‘\n{{#1004.result#}}\n\nã€è¾“å‡ºæ¨¡æ¿ã€‘\n# ç¾è‚¡æœŸæƒåˆ†ææŠ¥å‘Š\n**åˆ†ææ—¥æœŸ**ï¼š{timestamp}\n\
            \ **æŒ‡æ•°èƒŒæ™¯**ï¼š{{#env.DEFAULT_INDEX_PRIMARY#}} NET_GEX={net_gex_idx}, EM1$={em1_dollar_idx}\
            \ \n**é£é™©ç­‰çº§**ï¼š{event_risk.level} {æ ¹æ®levelæ˜¾ç¤º\U0001F7E2/\U0001F7E1/\U0001F534\
            }\n\n## 0. äº‹ä»¶é£é™©è¯„ä¼°ï¼ˆä¼˜å…ˆæŸ¥çœ‹ï¼‰ \n**æ£€æµ‹æ—¥æœŸ**ï¼š{ä»1004.resultæå–detection_date} \n**é£é™©ç­‰çº§**ï¼š{risk_level}\n\
            \n{è‹¥eventsæ•°ç»„ä¸ºç©º} \nâœ… æœªæ£€æµ‹åˆ°è¿‘æœŸé‡å¤§äº‹ä»¶ï¼Œå¯æ­£å¸¸æ‰§è¡Œç­–ç•¥\n {è‹¥eventsæ•°ç»„ä¸ä¸ºç©ºï¼Œé€ä¸€åˆ—å‡º} \n| äº‹ä»¶ç±»å‹\
            \ | æ—¥æœŸ | è·ç¦» | å½±å“ | è¯´æ˜ | \n|---------|------|------|------|------| \n|\
            \ {type} | {date} | {days_away}æ—¥ | {impact} | {noteæˆ–ç©º} | ### ç­–ç•¥è°ƒæ•´å»ºè®® \n\
            - **ç¦æ­¢è·¨æœŸ**: {no_cross_earnings ? \"\U0001F6AB æ˜¯\" : \"âœ… å¦\"} {è‹¥æ˜¯ï¼šè´¢æŠ¥æˆ–é‡å¤§äº‹ä»¶ä¸´è¿‘ï¼Œå»ºè®®DTEâ‰¤{max_dte_suggestion}æ—¥æˆ–ç­‰å¾…äº‹ä»¶å}\
            \ \n- **ç¼©çŸ­DTE**: {adjust_dte ? \"âš ï¸ æ˜¯\" : \"âœ… å¦\"}  {è‹¥æ˜¯ï¼šOPEXä¸´è¿‘ï¼Œå»ºè®®DTEâ‰¤{max_dte_suggestion}æ—¥}\
            \ \n- **å‡ä»“æ“ä½œ**: {reduce_position_size ? \"âš ï¸ æ˜¯\" : \"âœ… å¦\"} {è‹¥æ˜¯ï¼šFOMCä¸´è¿‘ï¼Œå»ºè®®åŠä»“æˆ–è§‚æœ›}\
            \ \n- **è¯¦ç»†è¯´æ˜**: {recommendations.note}\n\n## 1. ç»¼åˆè¯„åˆ†ä¸ç»“è®º\n\nä»5001.text.scoringæå–:\n\
            \n### æ€»åˆ†: {total_score}/10\n\n**è¯„åˆ†æ„æˆ** ({weight_breakdown}):\n- Gamma\
            \ Regime: {gamma_regime_score}/10 (æƒé‡40%)\n- ç ´å¢™å¯èƒ½æ€§: {break_wall_score}/10\
            \ (æƒé‡30%)\n- æ–¹å‘ä¸€è‡´æ€§: {direction_score}/10 (æƒé‡20%)\n- IVåŠ¨æ€: {iv_score}/10\
            \ (æƒé‡10%)\n\n### æ ¸å¿ƒåˆ¤æ–­\n\nä»5001.text.gamma_regimeå’Œscenario_classificationæå–:\n\
            \n**Gamma RegimeçŠ¶æ€**:\n- VOL TRIGGER = {vol_trigger}\n- ç°ä»·ä½ç½®: {spot_vs_trigger}\
            \ ({base_scenario})\n- è§£è¯»: {regime_note}\n\n**å¸‚åœºç»“è®º**:\n- ä¸»å¯¼åœºæ™¯: {primary_scenario}\
            \ (æ¦‚ç‡{scenario_probability}%)\n- è°ƒæ•´è¯´æ˜: {adjustment_note}\n\n**å…¥åœºåˆ¤æ–­**:\
            \ {entry_threshold_check}\n**ç†ç”±**: {entry_rationale}\n\n---\n\n## 2. å‰§æœ¬åˆ†ç±»ä¸æ¦‚ç‡\
            \ \n\nä»5001.textè¯¦ç»†æå–:\n\n### 2.1 ç ´å¢™è¯„ä¼°\n- å¢™è·: {break_wall_assessment.gap_distance_em1}å€EM1$\n\
            - ç°‡å¼ºåº¦: {cluster_strength}\n- ç ´å¢™æ¦‚ç‡: {break_probability}\n- {break_note}\n\
            \n### 2.2 æ–¹å‘ä¿¡å·\n- DEXåŒå‘: {directional_signals.dex_same_dir}%\n- Vanna:\
            \ {vanna_dir} (ç½®ä¿¡åº¦{vanna_confidence})\n- æ–¹å‘å¼ºåº¦: {direction_strength}\n\n\
            ### 2.3 åœºæ™¯æ¦‚ç‡åˆ†å¸ƒ\nä»scenario_classification.secondary_scenariosæå–:\n- {primary_scenario}:\
            \ {scenario_probability}%\né€ä¸€åˆ—å‡ºæ¬¡è¦åœºæ™¯çš„typeå’Œprobability\n\n---\n\n## 3. ç­–ç•¥å»ºè®®\n\
            \nä»1005.textæå–,å¹¶æŒ‰ranké¡ºåºå±•ç¤ºï¼š\n### æ’åºæ€»è§ˆ | æ’å | ç­–ç•¥ç±»å‹ | æœŸæœ›å€¼(EV) | é£é™©è°ƒæ•´æ”¶ç›Š |\
            \ åœºæ™¯åŒ¹é… | æµåŠ¨æ€§ | è¯„ä»· | |------|---------|-----------|------------|---------|--------|------|\
            \ \n| {rank} | {strategy_type} | {ev} | {risk_adjusted_return} | {scenario_match}\
            \ | {liquidity_pass?\"âœ…\":\"âŒ\"} | {note} | **æœ€ç»ˆæ¨è**: {final_recommendation}\n\
            \n### 3.1 é¦–é€‰ç­–ç•¥è¯¦è¿° \nä»6001.textä¸­æ‰¾åˆ°rank=1å¯¹åº”çš„strategy_typeï¼Œå±•å¼€è¯¦è¿°ï¼š **ç»“æ„**: {structure}\
            \ *\n*è…¿éƒ¨**: ä»legsæ•°ç»„ç®€åŒ–è¾“å‡ºï¼š\n   - {action} {quantity}x {type}@{strike} \n\
            ä¾æ¬¡åˆ—å‡ºæ‰€æœ‰è…¿ \n**æœŸé™**: {dte}æ—¥ \n**ç›ˆäºæ¯”**: {rr_calculation.rr_ratio} \n**èƒœç‡**:\
            \ {pw_calculation.pw_estimate} \n**å¸Œè…Šå€¼**: Delta {greeks_target.delta}\
            \ | Theta {greeks_target.theta} | Vega {greeks_target.vega} \n**å…¥åœº**:\
            \ {entry_trigger} \n**æ­¢ç›ˆ**: {exit_plan.profit_target} \n**æ­¢æŸ**: {exit_plan.stop_loss}\
            \ \n---\n### 3.2 å¤‡é€‰ç­–ç•¥æ¦‚è¦ \nå¯¹rank=2å’Œrank=3çš„ç­–ç•¥ï¼Œ\nä»…è¾“å‡ºå…³é”®ä¿¡æ¯ï¼š \n#### ç­–ç•¥{N}: {strategy_type}\
            \ \n- ç»“æ„: {structure} \n- RR: {rr_ratio} | Pw: {pw_estimate} \n- æ¨èç†ç”±:\
            \ {ä»Agent 7çš„noteæå–}\n ---\n## 4. æ‰§è¡Œå»ºè®® ### \nå…¥åœºåˆ¤å®š ä»5001.textå’Œ1005.textç»¼åˆåˆ¤æ–­ï¼š\
            \ \n{è‹¥entry_threshold_check=\"å…¥åœº\" ä¸” é¦–é€‰ç­–ç•¥liquidity_pass=true ä¸” event_risk.levelâ‰ \"\
            high\"} \nâœ… **å»ºè®®å…¥åœº** \n  - ä¸»å¯¼å‰§æœ¬æ¦‚ç‡: {scenario_probability}% \n  - æ€»è¯„åˆ†:\
            \ {total_score}/10 \n  - é¦–é€‰ç­–ç•¥æœŸæœ›å€¼: {rank1_ev} \n  - äº‹ä»¶é£é™©: å¯æ§ \n\n{è‹¥entry_threshold_check=\"\
            è½»ä»“è¯•æ¢\" æˆ– é¦–é€‰ç­–ç•¥scenario_match=\"ä¸­\"} \nâš ï¸ **å»ºè®®è½»ä»“è¯•æ¢** \n  - å‰§æœ¬æ¦‚ç‡: {scenario_probability}%ï¼ˆæœªè¾¾60%ï¼‰\
            \ \n  - å»ºè®®ä»“ä½: æ­£å¸¸çš„50%æˆ–æ›´çª„ç»“æ„ \n  - ç†ç”±: {entry_rationaleç®€åŒ–ç‰ˆ} \n{è‹¥entry_threshold_check=\"\
            è§‚æœ›\" æˆ– event_risk.level=\"high\" æˆ– é¦–é€‰ç­–ç•¥liquidity_pass=false} \n\U0001F6AB\
            \ **å»ºè®®è§‚æœ›** \n  - ç†ç”±: {é€é¡¹åˆ—å‡º} \n  - æ•°æ®å®Œæ•´åº¦: {validation_summary.completion_rate}%\n\
            \  - äº‹ä»¶é£é™©: {event_risk.level} \n  - ä¿¡å·å†²çª: {ä»risk_warningæå–} - æµåŠ¨æ€§: {é¦–é€‰ç­–ç•¥liquidity_pass?\"\
            é€šè¿‡\":\"ä¸è¶³\"}\n\n### æ‰§è¡ŒSOP \nâœ“ å…¥åœºæ£€æŸ¥ \n  - æ—¶æœº: æ¬¡æ—¥å¼€ç›˜å15-30åˆ†é’Ÿ \n  - ç¡®è®¤: Spotåœ¨é¢„æœŸåŒºé—´,IVæœªå¼‚å¸¸æ³¢åŠ¨\
            \ \n  - ä»“ä½: å•ç¬”â‰¤2%,æ€»æ•å£â‰¤10% \n\n âœ“ æ­¢æŸè§¦å‘ ç«‹å³å¹³ä»“æ¡ä»¶: \n   - Spotç©¿è¶ŠVOL_TRIGGER\
            \ (Gamma regimeåè½¬) \n   - è¾¾åˆ°ç­–ç•¥æ­¢æŸç‚¹ \n   - gap_distance<0.5EM1$ (æ¥è¿‘å¢™ä½) \n\
            \   - vanna_diråè½¬ - dex_same_dir<40% \n\n âœ“ æ—¥å¸¸ç›‘æ§ \n ç›˜å‰: \n  - æ£€æŸ¥VOL_TRIGGERæ›´æ–°\
            \ \n  - ç¡®è®¤spot_vs_triggerçŠ¶æ€ \n ç›˜ä¸­å…³æ³¨: \n  - gap_distanceå®æ—¶å˜åŒ– \n  - DEXåŒå‘æ€§æ˜¯å¦ç»´æŒ\
            \ \n  - IVæ˜¯å¦æ‰©å¼ >50% \n---\n\n## 5. æ•°æ®æ ¡éªŒå­—æ®µ (è¯¦ç»†) \nä»3001.text.targetsæå–æ‰€æœ‰å­—æ®µï¼š\n\
            ### æ ¸å¿ƒå­—æ®µ\n``` \nSymbol: {symbol} \nSpot: {spot_price} \nEM1$: {em1_dollar}\
            \ \n\nVOL_TRIGGER: {gamma_metrics.vol_trigger} spot_vs_trigger: {gamma_metrics.spot_vs_trigger}\
            \ NET_GEX: {gamma_metrics.net_gex} \nnet_gex_sign: {gamma_metrics.net_gex_sign}\
            \ \n\nCall_Wall: {walls.call_wall} \nPut_Wall: {walls.put_wall} \nMajor_Wall:\
            \ {walls.major_wall} ({walls.major_wall_type}) \n\ngap_distance: {gamma_metrics.gap_distance_dollar}\
            \ ({gamma_metrics.gap_distance_em1_multiple}x EM1$) cluster_strength:\
            \ {gamma_metrics.cluster_strength_ratio} monthly_override: {gamma_metrics.monthly_cluster_override}\
            \ \n\ndex_same_dir: {directional_metrics.dex_same_dir_pct}% vanna_dir:\
            \ {directional_metrics.vanna_dir} (confidence: {directional_metrics.vanna_confidence})\
            \ i\nv_path: {directional_metrics.iv_path} (confidence: {directional_metrics.iv_path_confidence})\
            \ \n\nATM_IV_7D: {atm_iv.iv_7d} \nATM_IV_14D: {atm_iv.iv_14d} \niv_source:\
            \ {atm_iv.iv_source} \n```\n ### æŒ‡æ•°èƒŒæ™¯ \n``` \nSPX NET_GEX: {indices.spx.net_gex_idx}\
            \ \nSPX EM1$: {indices.spx.em1_dollar_idx} \n``` \n### æ•°æ®è´¨é‡ \n- å®Œæ•´åº¦: {validation_summary.completion_rate}%\
            \ \n- ç¼ºå¤±å­—æ®µ: {validation_summary.missing_count}ä¸ª\n- æ—¶é—´æˆ³: {timestamp} \n\
            ---\n## 6. ç›‘æ§è¦ç‚¹ \næ ¹æ®é¦–é€‰ç­–ç•¥ç±»å‹è°ƒæ•´é‡ç‚¹ï¼š \n{è‹¥é¦–é€‰ä¸ºä¿å®ˆç­–ç•¥(ä¿¡ç”¨ä»·å·®/é“é¹°)} \n - **å¢™ä½ç¨³å®šæ€§**:\
            \ ç¡®è®¤Call/Put Wallæœªè¢«åˆºç©¿ \n - **é›¶Î³æ¼‚ç§»**: VOL_TRIGGERæ—¥å†…æ³¢åŠ¨â‰¤0.3Ã—EM1$ \n - **æ—¶é—´è¡°å‡**:\
            \ Thetaæ”¶ç›Šç´¯ç§¯ï¼Œåˆ°æœŸå‰3æ—¥å¼ºå¹³ \n - **IVå‹ç¼©**: ç›‘æ§iv_pathç»´æŒ\"é™\"æˆ–\"å¹³\"\n\n {è‹¥é¦–é€‰ä¸ºå‡è¡¡ç­–ç•¥(å€Ÿè®°ç«–å¼/æ—¥å†)}\
            \ \n - **æ–¹å‘ç¡®è®¤**: DEXåŒå‘ç´¯ç§¯æŒç»­>60%åˆ†ä½ \n - **Vannaæ”¯æŒ**: vanna_dirä¸ä»·æ ¼æ–¹å‘ä¸€è‡´ \n\
            \ - **IVè·¯å¾„**: iv_pathä¸é¢„æœŸä¸€è‡´(è¶‹åŠ¿çœ‹\"å‡\",å›è°ƒçœ‹\"é™\") \n - **gapç¼©å°**: gap_distanceå‘ç›®æ ‡å¢™é è¿‘\
            \ \n\n{è‹¥é¦–é€‰ä¸ºè¿›å–ç­–ç•¥(å•è…¿/çª„è·debit)} \n - **åŠ é€Ÿä¿¡å·**: æœ‰æ•ˆç ´å¢™ä¸”ç¦»å¢™â‰¥0.5Ã—EM1$ \n - **ç©ºç¼ºæ”¯æŒ**:\
            \ cluster_strength_ratioâ‰¤1.3,æ˜“çªç ´ \n - **æŒ‡æ•°ä¸€è‡´**: SPX/QQQå‡€Î³ä¸æ ‡çš„æ–¹å‘åŒæ­¥ \n -\
            \ **Vanna+IVå…±æŒ¯**: ä¸¤è€…æ–¹å‘ä¸€è‡´ä¸”ç½®ä¿¡åº¦é«˜ \n\n--- \n**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: {å½“å‰æ—¶é—´} \n**ä¸‹æ¬¡æ›´æ–°å»ºè®®**:\
            \ ç›˜å‰æˆ–å…³é”®æ•°æ®å˜åŒ–æ—¶"
        - id: user-report
          role: user
          text: è¯·æ±‡æ€»æ‰€æœ‰åˆ†æ,ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Šã€‚
        selected: false
        title: Agent 8 æœ€ç»ˆæŠ¥å‘Š
        type: llm
        vision:
          enabled: false
      height: 132
      id: '7001'
      position:
        x: 3511.9213275416714
        y: 202.92482559236925
      positionAbsolute:
        x: 3511.9213275416714
        y: 202.92482559236925
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        answer: '{{#7001.text#}}'
        desc: ''
        selected: false
        title: ğŸ“ˆ å›å¤æœ€ç»ˆåˆ†ææŠ¥å‘Š
        type: answer
      height: 103
      id: '7002'
      position:
        x: 3886.5466088851626
        y: 245.3277478801421
      positionAbsolute:
        x: 3886.5466088851626
        y: 245.3277478801421
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "import json\nfrom datetime import datetime, timedelta\nimport re\n\n\
          # å…¨å±€ç¼“å­˜å­—å…¸ï¼ˆåœ¨å·¥ä½œæµç”Ÿå‘½å‘¨æœŸå†…ä¿æŒï¼‰\n_earnings_cache = {}\n\ndef get_earnings_from_alpha_vantage(symbol,\
          \ api_key, enable_api, cache_days, url):\n    \"\"\"ä»Alpha Vantageè·å–è´¢æŠ¥æ—¥æœŸï¼ˆå¸¦ç¼“å­˜ï¼‰\"\
          \"\"\n\n    # æ£€æŸ¥å¼€å…³\n    enable_api_bool = str(enable_api).lower() in ['true',\
          \ '1', 'yes']\n    if not enable_api_bool:\n        return None  # APIå·²ç¦ç”¨ï¼Œè·³è¿‡\n\
          \n    # æ£€æŸ¥ç¼“å­˜\n    current_time = datetime.now()\n    cache_key = f\"earnings_{symbol}\"\
          \n\n    if cache_key in _earnings_cache:\n        cached_data, cached_time\
          \ = _earnings_cache[cache_key]\n        # æ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸ\n        if (current_time\
          \ - cached_time).days < int(cache_days):\n            return cached_data\
          \  # è¿”å›ç¼“å­˜æ•°æ®\n\n    # è°ƒç”¨API\n    try:\n        import urllib.request\n  \
          \      import urllib.error\n        \n        url = f\"{url}function=EARNINGS_CALENDAR&horizon=12month&apikey={api_key}&symbol={symbol}\"\
          \n        \n        req = urllib.request.Request(url)\n        with urllib.request.urlopen(req,\
          \ timeout=5) as response:\n            data = response.read().decode('utf-8')\n\
          \        \n        lines = data.strip().split('\\n')\n        if len(lines)\
          \ > 1:\n            first_earnings = lines[1].split(',')\n            if\
          \ len(first_earnings) >= 3:\n                earnings_date = first_earnings[2]\n\
          \                # å­˜å…¥ç¼“å­˜\n                _earnings_cache[cache_key] = (earnings_date,\
          \ current_time)\n                return earnings_date\n        \n      \
          \  # APIè¿”å›ç©ºï¼Œç¼“å­˜ç©ºç»“æœé¿å…é‡å¤è°ƒç”¨\n        _earnings_cache[cache_key] = (None, current_time)\n\
          \        return None\n        \n    except urllib.error.HTTPError as e:\n\
          \        if e.code == 429:\n            return \"API_LIMIT_REACHED\"\n \
          \       return None\n    except Exception as e:\n        return None\n\n\
          def detect_events(symbol, current_date_str, api_key, enable_api, cache_days,\
          \ url):\n    \"\"\"äº‹ä»¶æ£€æµ‹ä¸»å‡½æ•°\"\"\"\n    try:\n        current_date = datetime.strptime(current_date_str,\
          \ \"%Y-%m-%d\")\n    except:\n        current_date = datetime.now()\n  \
          \  \n    events = []\n    recommendations = {\n        \"no_cross_earnings\"\
          : False,\n        \"adjust_dte\": False,\n        \"reduce_position_size\"\
          : False,\n        \"max_dte_suggestion\": None,\n        \"note\": \"\"\
          ,\n        \"api_status\": \"disabled\" if str(enable_api).lower() not in\
          \ ['true', '1', 'yes'] else \"enabled\"\n    }\n    \n    # === 1. OPEXæ£€æµ‹\
          \ ===\n    year = current_date.year\n    month = current_date.month\n  \
          \  first_day = datetime(year, month, 1)\n    days_until_friday = (4 - first_day.weekday())\
          \ % 7\n    first_friday = first_day + timedelta(days=days_until_friday)\n\
          \    third_friday = first_friday + timedelta(weeks=2)\n    days_to_opex\
          \ = (third_friday - current_date).days\n    \n    if -5 <= days_to_opex\
          \ <= 14:\n        is_quarterly = month in [3, 6, 9, 12]\n        events.append({\n\
          \            \"type\": \"Quarterly_OPEX\" if is_quarterly else \"Monthly_OPEX\"\
          ,\n            \"date\": third_friday.strftime(\"%Y-%m-%d\"),\n        \
          \    \"days_away\": days_to_opex,\n            \"impact\": \"high\" if is_quarterly\
          \ else \"medium\"\n        })\n        if 0 <= days_to_opex <= 7:\n    \
          \        recommendations[\"adjust_dte\"] = True\n            recommendations[\"\
          max_dte_suggestion\"] = max(days_to_opex - 2, 3)\n            recommendations[\"\
          note\"] += f\"è·ç¦»{'å­£åº¦' if is_quarterly else 'æœˆåº¦'}OPEX {days_to_opex}æ—¥ï¼Œå»ºè®®DTEâ‰¤{recommendations['max_dte_suggestion']}æ—¥;\
          \ \"\n    \n    # === 2. FOMCæ£€æµ‹ ===\n    fomc_dates_2025 = [\n        \"\
          2025-01-28\", \"2025-01-29\", \"2025-03-18\", \"2025-03-19\",\n        \"\
          2025-05-06\", \"2025-05-07\", \"2025-06-17\", \"2025-06-18\",\n        \"\
          2025-07-29\", \"2025-07-30\", \"2025-09-16\", \"2025-09-17\",\n        \"\
          2025-10-28\", \"2025-10-29\", \"2025-12-09\", \"2025-12-10\",\n    ]\n \
          \   for fomc_date_str in fomc_dates_2025:\n        fomc_date = datetime.strptime(fomc_date_str,\
          \ \"%Y-%m-%d\")\n        days_to_fomc = (fomc_date - current_date).days\n\
          \        if 0 <= days_to_fomc <= 30:\n            events.append({\n    \
          \            \"type\": \"FOMC\",\n                \"date\": fomc_date_str,\n\
          \                \"days_away\": days_to_fomc,\n                \"impact\"\
          : \"high\" if days_to_fomc <= 7 else \"medium\"\n            })\n      \
          \      if days_to_fomc <= 7:\n                recommendations[\"reduce_position_size\"\
          ] = True\n                recommendations[\"note\"] += f\"è·ç¦»FOMCä¼šè®®{days_to_fomc}æ—¥ï¼Œå»ºè®®å‡åŠä»“ä½æˆ–è§‚æœ›;\
          \ \"\n            break\n    \n    # === 3. è´¢æŠ¥å­£æ£€æµ‹ ===\n    earnings_seasons\
          \ = {\n        \"Q4\": (1, 15, 2, 28), \"Q1\": (4, 15, 5, 31),\n       \
          \ \"Q2\": (7, 15, 8, 31), \"Q3\": (10, 15, 11, 30),\n    }\n    for quarter,\
          \ (sm, sd, em, ed) in earnings_seasons.items():\n        try:\n        \
          \    season_start = datetime(year, sm, sd)\n            season_end = datetime(year,\
          \ em, ed)\n            if season_start <= current_date <= season_end:\n\
          \                events.append({\n                    \"type\": \"Earnings_Season\"\
          ,\n                    \"date\": f\"{quarter} Earnings Season\",\n     \
          \               \"days_away\": 0,\n                    \"impact\": \"medium\"\
          ,\n                    \"note\": f\"å½“å‰å¤„äº{quarter}è´¢æŠ¥å­£\"\n               \
          \ })\n                recommendations[\"no_cross_earnings\"] = True\n  \
          \              recommendations[\"max_dte_suggestion\"] = 7\n           \
          \     recommendations[\"note\"] += f\"å½“å‰å¤„äº{quarter}è´¢æŠ¥å­£ï¼Œä¸å»ºè®®è·¨æœŸï¼Œä¼˜å…ˆ5-7æ—¥DTE;\
          \ \"\n                break\n        except:\n            continue\n   \
          \ \n    # === 4. Alpha Vantage APIè·å–ä¸ªè‚¡è´¢æŠ¥ï¼ˆå¸¦å¼€å…³å’Œç¼“å­˜ï¼‰===\n    symbol_upper =\
          \ symbol.upper()\n    \n    if str(enable_api).lower() in ['true', '1',\
          \ 'yes']:\n        # APIå·²å¯ç”¨\n        earnings_date_api = get_earnings_from_alpha_vantage(\n\
          \            symbol_upper, api_key, enable_api, cache_days, url\n      \
          \  )\n        \n        if earnings_date_api and earnings_date_api != \"\
          API_LIMIT_REACHED\":\n            try:\n                earnings_date =\
          \ datetime.strptime(earnings_date_api, \"%Y-%m-%d\")\n                days_to_earnings\
          \ = (earnings_date - current_date).days\n                if -5 <= days_to_earnings\
          \ <= 14:\n                    events.append({\n                        \"\
          type\": \"Earnings\",\n                        \"date\": earnings_date_api,\n\
          \                        \"days_away\": days_to_earnings,\n            \
          \            \"impact\": \"high\",\n                        \"symbol\":\
          \ symbol_upper,\n                        \"source\": \"Alpha Vantage API\"\
          ,\n                        \"cached\": cache_key in _earnings_cache and\
          \ (current_time - _earnings_cache[cache_key][1]).days < int(cache_days)\n\
          \                    })\n                    if -2 <= days_to_earnings <=\
          \ 5:\n                        recommendations[\"no_cross_earnings\"] = True\n\
          \                        recommendations[\"max_dte_suggestion\"] = 5\n \
          \                       recommendations[\"note\"] += f\"{symbol_upper}è´¢æŠ¥{earnings_date_api}ï¼Œ{'å·²è¿‡'\
          \ if days_to_earnings < 0 else 'å³å°†'}({abs(days_to_earnings)}æ—¥)ï¼Œä¸¥ç¦è·¨æœŸï¼Œå»ºè®®ç­‰å¾…æˆ–â‰¤5æ—¥DTE;\
          \ \"\n            except:\n                pass\n        elif earnings_date_api\
          \ == \"API_LIMIT_REACHED\":\n            events.append({\n             \
          \   \"type\": \"API_Warning\",\n                \"date\": \"N/A\",\n   \
          \             \"days_away\": 0,\n                \"impact\": \"low\",\n\
          \                \"note\": \"Alpha Vantage APIé…é¢ç”¨å°½\"\n            })\n \
          \           recommendations[\"api_status\"] = \"quota_exceeded\"\n    else:\n\
          \        # APIå·²ç¦ç”¨ï¼Œæ·»åŠ æç¤º\n        if not any(e.get(\"type\") == \"Earnings_Season\"\
          \ for e in events):\n            # åªåœ¨ä¸åœ¨è´¢æŠ¥å­£æ—¶æ‰æç¤º\n            recommendations[\"\
          note\"] += \"ï¼ˆè´¢æŠ¥APIå·²ç¦ç”¨ï¼Œä»…æ£€æµ‹è´¢æŠ¥å­£ï¼‰; \"\n    \n    # === 5. ç»¼åˆåˆ¤æ–­ ===\n    if\
          \ not recommendations[\"note\"]:\n        recommendations[\"note\"] = \"\
          æœªæ£€æµ‹åˆ°è¿‘æœŸé‡å¤§äº‹ä»¶ï¼Œå¯æ­£å¸¸æ‰§è¡Œç­–ç•¥\"\n    if recommendations[\"max_dte_suggestion\"] is\
          \ None:\n        recommendations[\"max_dte_suggestion\"] = 14\n    \n  \
          \  result = {\n        \"symbol\": symbol_upper,\n        \"detection_date\"\
          : current_date.strftime(\"%Y-%m-%d\"),\n        \"events\": events,\n  \
          \      \"event_count\": len([e for e in events if e[\"type\"] not in [\"\
          API_Warning\", \"Earnings_Season\"]]),\n        \"recommendations\": recommendations,\n\
          \        \"risk_level\": \"high\" if (recommendations[\"no_cross_earnings\"\
          ] or recommendations[\"reduce_position_size\"]) else (\"medium\" if recommendations[\"\
          adjust_dte\"] else \"low\"),\n        \"cache_info\": {\n            \"\
          earnings_cached_count\": len(_earnings_cache),\n            \"api_enabled\"\
          : recommendations[\"api_status\"]\n        }\n    }\n    return json.dumps(result,\
          \ indent=2, ensure_ascii=False)\n\ndef main():\n    user_input = \"\"\"\
          {{#1001.query#}}\"\"\"\n    api_key = \"\"\"{{#env.ALPHA_VANTAGE_API_KEY#}}\"\
          \"\"\n    url = \"\"\"{{#env.ALPHA_VANTAGE_API_URL#}}\"\"\"\n    enable_api\
          \ = \"\"\"{{#env.ENABLE_EARNINGS_API#}}\"\"\"\n    cache_days = \"\"\"{{#env.EARNINGS_CACHE_DAYS#}}\"\
          \"\"\n    \n    match = re.search(r'\\b([A-Z]{1,5})\\b', user_input.upper())\n\
          \    symbol = match.group(1) if match else \"UNKNOWN\"\n    current_date\
          \ = datetime.now().strftime(\"%Y-%m-%d\")\n    \n    result = detect_events(symbol,\
          \ current_date, api_key, enable_api, cache_days, url)\n    return {\"result\"\
          : result}"
        code_language: python3
        desc: è´¢æŠ¥ã€FOMCã€OPEX äº‹ä»¶æ£€æµ‹
        outputs:
          result:
            children: null
            type: string
        selected: false
        title: CODE1 äº‹ä»¶æ£€æµ‹
        type: code
        variables: []
      height: 80
      id: '1004'
      position:
        x: 1688.2034969828262
        y: 320.06781246653895
      positionAbsolute:
        x: 1688.2034969828262
        y: 320.06781246653895
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "\nimport json\nfrom typing import Dict, Any, List, Tuple\n\n\ndef main(agent3_output:\
          \ str, agent4_output: str = \"\", **env_vars) -> dict:\n    \"\"\"\n   \
          \ Dify Code Node å…¥å£å‡½æ•°\n    \n    Args:\n        agent3_output: Agent 3 çš„æ•°æ®æ ¡éªŒç»“æœ\
          \ JSON å­—ç¬¦ä¸²\n        agent4_output: Agent 4 çš„æŠ€æœ¯é¢åˆ†æ JSON å­—ç¬¦ä¸² (å¯é€‰)\n      \
          \  **env_vars: ç¯å¢ƒå˜é‡å­—å…¸\n        \n    Returns:\n        {\"result\": è¯„åˆ†ç»“æœ\
          \ JSON å­—ç¬¦ä¸²}\n    \"\"\"\n    try:\n        # è§£æè¾“å…¥\n        agent3_data =\
          \ json.loads(agent3_output)\n        \n        # åˆå§‹åŒ–è¯„åˆ†å¼•æ“\n        scoring\
          \ = OptionsScoring(env_vars)\n        \n        # æ‰§è¡Œè¯„åˆ†è®¡ç®—\n        result\
          \ = scoring.process(agent3_data)\n        \n        # è¿”å› JSON å­—ç¬¦ä¸²\n    \
          \    return {\n            \"result\": json.dumps(result, ensure_ascii=False,\
          \ indent=2)\n        }\n        \n    except Exception as e:\n        #\
          \ é”™è¯¯å¤„ç†\n        error_result = {\n            \"error\": True,\n       \
          \     \"error_message\": str(e),\n            \"error_type\": type(e).__name__\n\
          \        }\n        return {\n            \"result\": json.dumps(error_result,\
          \ ensure_ascii=False, indent=2)\n        }\n\n\nclass OptionsScoring:\n\
          \    \"\"\"æœŸæƒé‡åŒ–è¯„åˆ†è®¡ç®—å¼•æ“\"\"\"\n    \n    def __init__(self, env_vars: Dict[str,\
          \ Any]):\n        \"\"\"\n        åˆå§‹åŒ–ç¯å¢ƒå˜é‡é˜ˆå€¼\n        \n        Args:\n \
          \           env_vars: ç¯å¢ƒå˜é‡å­—å…¸ï¼ŒåŒ…å«æ‰€æœ‰é˜ˆå€¼å‚æ•°\n        \"\"\"\n        self.env\
          \ = self._parse_env_vars(env_vars)\n        \n    def _parse_env_vars(self,\
          \ env_vars: Dict[str, Any]) -> Dict[str, float]:\n        \"\"\"è§£æå¹¶éªŒè¯ç¯å¢ƒå˜é‡\"\
          \"\"\n        parsed = {}\n        \n        # å¿…éœ€çš„ç¯å¢ƒå˜é‡åŠå…¶é»˜è®¤å€¼\n        defaults\
          \ = {\n            'SCORE_WEIGHT_GAMMA_REGIME': \"\"\"{{#env.SCORE_WEIGHT_GAMMA_REGIME#}}\"\
          \"\",\n            'SCORE_WEIGHT_BREAK_WALL': \"\"\"{{#env.SCORE_WEIGHT_BREAK_WALL#}}\"\
          \"\",\n            'SCORE_WEIGHT_DIRECTION': \"\"\"{{#env.SCORE_WEIGHT_DIRECTION#}}\"\
          \"\",\n            'SCORE_WEIGHT_IV': \"\"\"{{#env.SCORE_WEIGHT_IV#}}\"\"\
          \",\n            'BREAK_WALL_THRESHOLD_LOW': \"\"\"{{#env.BREAK_WALL_THRESHOLD_LOW#}}\"\
          \"\",\n            'BREAK_WALL_THRESHOLD_HIGH': \"\"\"{{#env.BREAK_WALL_THRESHOLD_HIGH#}}\"\
          \"\",\n            'MONTHLY_OVERRIDE_THRESHOLD': \"\"\"{{#env.MONTHLY_OVERRIDE_THRESHOLD#}}\"\
          \"\",\n            'MONTHLY_CLUSTER_STRENGTH_RATIO': \"\"\"{{#env.MONTHLY_CLUSTER_STRENGTH_RATIO#}}\"\
          \"\",\n            'CLUSTER_STRENGTH_THRESHOLD_STRONG': \"\"\"{{#env.CLUSTER_STRENGTH_THRESHOLD_STRONG#}}\"\
          \"\",\n            'CLUSTER_STRENGTH_THRESHOLD_TREND': \"\"\"{{#env.CLUSTER_STRENGTH_THRESHOLD_TREND#}}\"\
          \"\",\n            'DEX_SAME_DIR_THRESHOLD_STRONG': \"\"\"{{#env.DEX_SAME_DIR_THRESHOLD_STRONG#}}\"\
          \"\",\n            'DEX_SAME_DIR_THRESHOLD_MEDIUM': \"\"\"{{#env.DEX_SAME_DIR_THRESHOLD_MEDIUM#}}\"\
          \"\",\n            'DEX_SAME_DIR_THRESHOLD_WEAK': \"\"\"{{#env.DEX_SAME_DIR_THRESHOLD_WEAK#}}\"\
          \"\",\n            'PW_DEBIT_VANNA_WEIGHT_HIGH': \"\"\"{{#env.PW_DEBIT_VANNA_WEIGHT_HIGH#}}\"\
          \"\",\n            'PW_DEBIT_VANNA_WEIGHT_MEDIUM': \"\"\"{{#env.PW_DEBIT_VANNA_WEIGHT_MEDIUM#}}\"\
          \"\",\n            'PW_DEBIT_VANNA_WEIGHT_LOW': \"\"\"{{#env.PW_DEBIT_VANNA_WEIGHT_LOW#}}\"\
          \"\",\n            'ENTRY_THRESHOLD_SCORE': \"\"\"{{#env.ENTRY_THRESHOLD_SCORE#}}\"\
          \"\",\n            'ENTRY_THRESHOLD_PROBABILITY': \"\"\"{{#env.ENTRY_THRESHOLD_PROBABILITY#}}\"\
          \"\",\n            'LIGHT_POSITION_PROBABILITY': \"\"\"{{#env.LIGHT_POSITION_PROBABILITY#}}\"\
          \"\"\n        }\n        \n        for key, default_value in defaults.items():\n\
          \            value = env_vars.get(key, default_value)\n            # è½¬æ¢ä¸º\
          \ float\n            try:\n                parsed[key] = float(value)\n\
          \            except (ValueError, TypeError):\n                parsed[key]\
          \ = default_value\n                \n        return parsed\n    \n    def\
          \ calculate_gamma_regime_score(self, gamma_metrics: Dict) -> Dict:\n   \
          \     \"\"\"\n        1. Gamma Regime åˆ¤å®šï¼ˆæƒé‡ 40%ï¼‰\n        \n        è¿™æ˜¯æœ€å…³é”®çš„å¸‚åœºçŠ¶æ€åˆ¤æ–­ï¼š\n\
          \        - above: æ­£Î³å€¾å‘ï¼Œåšå¸‚å•†å‹åˆ¶æ³¢åŠ¨\n        - below: è´ŸÎ³å€¾å‘ï¼Œåšå¸‚å•†æ”¾å¤§æ³¢åŠ¨\n        -\
          \ near: ä¸´ç•ŒçŠ¶æ€ï¼Œå¯èƒ½åè½¬\n        \n        Args:\n            gamma_metrics: Gamma\
          \ æŒ‡æ ‡æ•°æ®\n            \n        Returns:\n            è¯„åˆ†ç»“æœå­—å…¸\n        \"\"\
          \"\n        spot = gamma_metrics.get('spot_price', 0)\n        vol_trigger\
          \ = gamma_metrics.get('vol_trigger', 0)\n        spot_vs_trigger = gamma_metrics.get('spot_vs_trigger',\
          \ 'unknown')\n        \n        if spot_vs_trigger == \"above\":\n     \
          \       base_scenario = \"åŒºé—´\"\n            regime_note = f\"ç°ä»·{spot}åœ¨VOL_TRIGGER\
          \ {vol_trigger}ä¸Šæ–¹ï¼Œæ­£Î³å€¾å‘ï¼Œåšå¸‚å•†å‹åˆ¶æ³¢åŠ¨ç»´æŒåŒºé—´\"\n            score = 7\n          \
          \  rationale = \"æ˜ç¡®aboveçŠ¶æ€ç»™7åˆ†\"\n            \n        elif spot_vs_trigger\
          \ == \"below\":\n            base_scenario = \"è¶‹åŠ¿\"\n            regime_note\
          \ = f\"ç°ä»·{spot}åœ¨VOL_TRIGGER {vol_trigger}ä¸‹æ–¹ï¼Œè´ŸÎ³å€¾å‘ï¼Œåšå¸‚å•†æ”¾å¤§æ³¢åŠ¨è¶‹åŠ¿åŠ é€Ÿ\"\n       \
          \     score = 7\n            rationale = \"æ˜ç¡®belowçŠ¶æ€ç»™7åˆ†\"\n            \n\
          \        else:  # near æˆ–å…¶ä»–\n            base_scenario = \"è¿‡æ¸¡\"\n       \
          \     regime_note = f\"ç°ä»·{spot}æ¥è¿‘VOL_TRIGGER {vol_trigger}ï¼Œä¸´ç•ŒçŠ¶æ€ï¼Œå¯èƒ½Gammaç¿»è½¬é«˜æ³¢åŠ¨\"\
          \n            score = 4\n            rationale = \"ä¸´ç•ŒnearçŠ¶æ€ç»™4åˆ†ï¼Œè­¦ç¤ºé£é™©\"\n\
          \            \n        return {\n            \"score\": score,\n       \
          \     \"base_scenario\": base_scenario,\n            \"regime_note\": regime_note,\n\
          \            \"rationale\": rationale\n        }\n    \n    def calculate_break_wall_score(self,\
          \ gamma_metrics: Dict) -> Dict:\n        \"\"\"\n        2. ç ´å¢™å¯èƒ½æ€§è¯„ä¼°ï¼ˆæƒé‡ 30%ï¼‰\n\
          \        \n        è¯„ä¼°çªç ´ä¸»è¦å¢™ä½çš„éš¾åº¦ï¼š\n        - è€ƒè™‘è·ç¦»ã€ç°‡å¼ºåº¦ã€æœˆåº¦å åŠ \n        \n   \
          \     Args:\n            gamma_metrics: Gamma æŒ‡æ ‡æ•°æ®\n            \n     \
          \   Returns:\n            è¯„åˆ†ç»“æœå­—å…¸\n        \"\"\"\n        gap_distance =\
          \ gamma_metrics.get('gap_distance_em1_multiple', 999)\n        cluster_strength\
          \ = gamma_metrics.get('cluster_strength_ratio', 0)\n        monthly_override\
          \ = gamma_metrics.get('monthly_cluster_override', False)\n        spot_vs_trigger\
          \ = gamma_metrics.get('spot_vs_trigger', 'unknown')\n        \n        #\
          \ æ­¥éª¤1: åˆ¤æ–­é˜ˆå€¼\n        if monthly_override:\n            threshold = self.env['MONTHLY_OVERRIDE_THRESHOLD']\n\
          \            threshold_note = f\"æœˆåº¦ç°‡å¼ºåº¦â‰¥å‘¨åº¦{self.env['MONTHLY_CLUSTER_STRENGTH_RATIO']}å€\"\
          \n        else:\n            threshold = self.env['BREAK_WALL_THRESHOLD_HIGH']\n\
          \            threshold_note = f\"æ ‡å‡†é˜ˆå€¼{threshold}Ã—EM1$\"\n        \n    \
          \    # æ­¥éª¤2: è¯„ä¼°ç ´å¢™æ¦‚ç‡\n        if gap_distance < self.env['BREAK_WALL_THRESHOLD_LOW']:\n\
          \            break_probability = \"é«˜\"\n            base_score = 9\n   \
          \         prob_desc = \"è·ç¦»è¿‘\"\n        elif gap_distance < self.env['BREAK_WALL_THRESHOLD_HIGH']:\n\
          \            break_probability = \"ä¸­\"\n            base_score = 6\n   \
          \         prob_desc = \"è·ç¦»é€‚ä¸­\"\n        else:\n            break_probability\
          \ = \"ä½\"\n            base_score = 3\n            prob_desc = \"è·ç¦»è¿œ\"\n\
          \        \n        # æ­¥éª¤3: ç°‡å¼ºåº¦è°ƒæ•´\n        if cluster_strength >= self.env['CLUSTER_STRENGTH_THRESHOLD_STRONG']:\n\
          \            adjustment = -1\n            cluster_note = f\"ç°‡å¼ºåº¦{cluster_strength:.2f}â‰¥{self.env['CLUSTER_STRENGTH_THRESHOLD_STRONG']}ï¼Œä¸»å¢™æå¼º\"\
          \n            cluster_desc = \"æå¼ºé˜»åŠ›\"\n        elif cluster_strength >=\
          \ self.env['CLUSTER_STRENGTH_THRESHOLD_TREND']:\n            adjustment\
          \ = 0\n            cluster_note = f\"ç°‡å¼ºåº¦{cluster_strength:.2f}åœ¨{self.env['CLUSTER_STRENGTH_THRESHOLD_TREND']}-{self.env['CLUSTER_STRENGTH_THRESHOLD_STRONG']}ï¼Œä¸­ç­‰å¼ºåº¦\"\
          \n            cluster_desc = \"ä¸­ç­‰é˜»åŠ›\"\n        else:\n            adjustment\
          \ = 1\n            cluster_note = f\"ç°‡å¼ºåº¦{cluster_strength:.2f}<{self.env['CLUSTER_STRENGTH_THRESHOLD_TREND']}ï¼Œè¾ƒæ˜“çªç ´\"\
          \n            cluster_desc = \"è¾ƒå¼±é˜»åŠ›\"\n        \n        final_score = max(1,\
          \ min(10, base_score + adjustment))  # é™åˆ¶åœ¨ 1-10\n        \n        # ç¡®å®šå¢™ä½æ–¹å‘\n\
          \        wall_direction = \"Call Wall\" if spot_vs_trigger == 'above' else\
          \ \"Put Wall\"\n        \n        # ç»¼åˆè¯´æ˜\n        break_note = (\n     \
          \       f\"éœ€{gap_distance:.2f}å€EM1$è·ç¦»åˆ°è¾¾{wall_direction}ï¼Œ\"\n           \
          \ f\"{cluster_note}ï¼Œç ´å¢™éš¾åº¦\"\n            f\"{'é«˜' if final_score < 5 else\
          \ 'ä¸­' if final_score < 7 else 'ä½'}\"\n        )\n        \n        rationale\
          \ = (\n            f\"gap_distance {gap_distance:.2f}({prob_desc})ç»™{base_score}åˆ†ï¼Œ\"\
          \n            f\"cluster {cluster_strength:.2f}({cluster_desc})è°ƒæ•´{adjustment:+d}åˆ†\"\
          \n        )\n        \n        return {\n            \"score\": final_score,\n\
          \            \"break_probability\": break_probability,\n            \"threshold\"\
          : threshold,\n            \"threshold_note\": threshold_note,\n        \
          \    \"break_note\": break_note,\n            \"rationale\": rationale,\n\
          \            \"gap_distance_em1\": gap_distance,\n            \"cluster_strength\"\
          : cluster_strength,\n            \"monthly_override\": monthly_override\n\
          \        }\n    \n    def calculate_direction_score(self, directional_metrics:\
          \ Dict) -> Dict:\n        \"\"\"\n        3. æ–¹å‘ä¸€è‡´æ€§è¯„ä¼°ï¼ˆæƒé‡ 20%ï¼‰\n        \n\
          \        ç»¼åˆ DEX åŒå‘æ€§å’Œ Vanna æ–¹å‘ä¿¡å·\n        \n        Args:\n            directional_metrics:\
          \ æ–¹å‘æŒ‡æ ‡æ•°æ®\n            \n        Returns:\n            è¯„åˆ†ç»“æœå­—å…¸\n        \"\
          \"\"\n        dex_same_dir = directional_metrics.get('dex_same_dir_pct',\
          \ 0)\n        vanna_dir = directional_metrics.get('vanna_dir', 'neutral')\n\
          \        vanna_confidence = directional_metrics.get('vanna_confidence',\
          \ 'low')\n        \n        # è®¡ç®— vanna æƒé‡\n        vanna_weight_map = {\n\
          \            'high': self.env['PW_DEBIT_VANNA_WEIGHT_HIGH'],\n         \
          \   'medium': self.env['PW_DEBIT_VANNA_WEIGHT_MEDIUM'],\n            'low':\
          \ self.env['PW_DEBIT_VANNA_WEIGHT_LOW']\n        }\n        vanna_weight\
          \ = vanna_weight_map.get(vanna_confidence, 0.3)\n        \n        # åˆ¤æ–­æ–¹å‘å¼ºåº¦\n\
          \        has_strong_dex = dex_same_dir >= self.env['DEX_SAME_DIR_THRESHOLD_STRONG']\n\
          \        has_clear_vanna = vanna_dir in ['up', 'down']\n        has_medium_vanna\
          \ = vanna_weight >= self.env['PW_DEBIT_VANNA_WEIGHT_MEDIUM']\n        \n\
          \        if has_strong_dex and has_clear_vanna and has_medium_vanna:\n \
          \           direction_strength = \"å¼ºæ–¹å‘ä¿¡å·\"\n            score = 9\n    \
          \        strength_desc = \"DEXå¼º+Vannaé«˜ç½®ä¿¡\"\n            \n        elif dex_same_dir\
          \ >= self.env['DEX_SAME_DIR_THRESHOLD_MEDIUM'] or vanna_weight == self.env['PW_DEBIT_VANNA_WEIGHT_MEDIUM']:\n\
          \            direction_strength = \"ä¸­ç­‰æ–¹å‘ä¿¡å·\"\n            score = 6\n  \
          \          strength_desc = \"DEXä¸­ç­‰æˆ–Vannaä¸­ç­‰ç½®ä¿¡\"\n            \n        elif\
          \ dex_same_dir < self.env['DEX_SAME_DIR_THRESHOLD_WEAK'] or vanna_confidence\
          \ == 'low':\n            direction_strength = \"å¼±æ–¹å‘ä¿¡å·\"\n            score\
          \ = 3\n            strength_desc = \"DEXå¼±æˆ–Vannaä½ç½®ä¿¡\"\n        else:\n  \
          \          direction_strength = \"ä¸­ç­‰åå¼±ä¿¡å·\"\n            score = 5\n    \
          \        strength_desc = \"ä¿¡å·æ¨¡ç³Š\"\n        \n        # DEX è¯„ä»·\n        if\
          \ dex_same_dir >= self.env['DEX_SAME_DIR_THRESHOLD_STRONG']:\n         \
          \   dex_eval = \"å¼º\"\n        elif dex_same_dir >= self.env['DEX_SAME_DIR_THRESHOLD_MEDIUM']:\n\
          \            dex_eval = \"ä¸­ç­‰\"\n        else:\n            dex_eval = \"\
          å¼±\"\n        \n        direction_note = (\n            f\"DEXåŒå‘{dex_same_dir:.1f}%({dex_eval})ï¼Œ\"\
          \n            f\"Vannaæ–¹å‘{vanna_dir}ä¸”ç½®ä¿¡åº¦{vanna_confidence}æƒé‡{vanna_weight:.1f}ï¼Œ\"\
          \n            f\"ç»¼åˆ{direction_strength}\"\n        )\n        \n       \
          \ rationale = f\"dex {dex_same_dir:.1f}%+vanna {vanna_confidence}({strength_desc})ç»¼åˆç»™{score}åˆ†\"\
          \n        \n        return {\n            \"score\": score,\n          \
          \  \"direction_strength\": direction_strength,\n            \"vanna_weight\"\
          : vanna_weight,\n            \"direction_note\": direction_note,\n     \
          \       \"rationale\": rationale,\n            \"dex_same_dir\": dex_same_dir,\n\
          \            \"vanna_dir\": vanna_dir,\n            \"vanna_confidence\"\
          : vanna_confidence\n        }\n    \n    def calculate_iv_score(self, directional_metrics:\
          \ Dict) -> Dict:\n        \"\"\"\n        4. IV åŠ¨æ€è¯„ä¼°ï¼ˆæƒé‡ 10%ï¼‰\n        \n\
          \        è¯„ä¼°éšå«æ³¢åŠ¨ç‡çš„è·¯å¾„å’Œç½®ä¿¡åº¦\n        \n        Args:\n            directional_metrics:\
          \ æ–¹å‘æŒ‡æ ‡æ•°æ®\n            \n        Returns:\n            è¯„åˆ†ç»“æœå­—å…¸\n        \"\
          \"\"\n        iv_path = directional_metrics.get('iv_path', 'å¹³')\n      \
          \  iv_confidence = directional_metrics.get('iv_path_confidence', 'low')\n\
          \        \n        if iv_path == \"å‡\" and iv_confidence in ['high', 'medium']:\n\
          \            iv_signal = \"æ³¢åŠ¨ç‡æ‰©å¼ \"\n            note = \"åˆ©å¤šæ³¢åŠ¨ç‡ç­–ç•¥\"\n   \
          \         score = 8 if iv_confidence == 'high' else 6\n            conf_desc\
          \ = \"é«˜ç½®ä¿¡\" if iv_confidence == 'high' else \"ä¸­ç­‰ç½®ä¿¡\"\n            \n   \
          \     elif iv_path == \"é™\":\n            iv_signal = \"æ³¢åŠ¨ç‡å‹ç¼©\"\n      \
          \      note = \"åˆ©ç©ºæ³¢åŠ¨ç‡\"\n            if iv_confidence == 'high':\n     \
          \           score = 3\n                conf_desc = \"é«˜ç½®ä¿¡ä¸‹é™\"\n         \
          \   elif iv_confidence == 'medium':\n                score = 4\n       \
          \         conf_desc = \"ä¸­ç­‰ç½®ä¿¡ä¸‹é™\"\n            else:\n                score\
          \ = 5\n                conf_desc = \"ä½ç½®ä¿¡ä¸‹é™\"\n                \n       \
          \ else:  # \"å¹³\" æˆ– \"æ•°æ®ä¸è¶³\"\n            iv_signal = \"ä¸­æ€§\"\n          \
          \  note = \"æ³¢åŠ¨ç‡ç¨³å®šæˆ–æ•°æ®ä¸è¶³\"\n            score = 5\n            conf_desc =\
          \ \"å¹³ç¨³æˆ–ä¸ç¡®å®š\"\n        \n        iv_note = f\"IVè·¯å¾„æ˜¾ç¤º{iv_path}è¶‹åŠ¿ï¼Œç½®ä¿¡åº¦{iv_confidence}ï¼Œ{note}\"\
          \n        rationale = f\"iv_path {iv_path}ä¸”confidence {iv_confidence}({conf_desc})ç»™{score}åˆ†\"\
          \n        \n        return {\n            \"score\": score,\n          \
          \  \"iv_signal\": iv_signal,\n            \"iv_note\": iv_note,\n      \
          \      \"rationale\": rationale,\n            \"iv_path\": iv_path,\n  \
          \          \"iv_path_confidence\": iv_confidence\n        }\n    \n    def\
          \ calculate_total_score(self, scores: Dict) -> Dict:\n        \"\"\"\n \
          \       ç»¼åˆè¯„åˆ†è®¡ç®—\n        \n        å››ç»´åŠ æƒæ±‚å’Œ\n        \n        Args:\n    \
          \        scores: å„ç»´åº¦è¯„åˆ†å­—å…¸\n            \n        Returns:\n            æ€»åˆ†å’Œæƒé‡åˆ†è§£\n\
          \        \"\"\"\n        gamma_score = scores['gamma']['score']\n      \
          \  break_score = scores['break_wall']['score']\n        direction_score\
          \ = scores['direction']['score']\n        iv_score = scores['iv']['score']\n\
          \        \n        w = self.env\n        \n        # åŠ æƒè®¡ç®—\n        total\
          \ = (\n            gamma_score * w['SCORE_WEIGHT_GAMMA_REGIME'] +\n    \
          \        break_score * w['SCORE_WEIGHT_BREAK_WALL'] +\n            direction_score\
          \ * w['SCORE_WEIGHT_DIRECTION'] +\n            iv_score * w['SCORE_WEIGHT_IV']\n\
          \        )\n        \n        # è¯¦ç»†åˆ†è§£\n        breakdown = (\n          \
          \  f\"{gamma_score}Ã—{w['SCORE_WEIGHT_GAMMA_REGIME']:.1f}+\"\n          \
          \  f\"{break_score}Ã—{w['SCORE_WEIGHT_BREAK_WALL']:.1f}+\"\n            f\"\
          {direction_score}Ã—{w['SCORE_WEIGHT_DIRECTION']:.1f}+\"\n            f\"\
          {iv_score}Ã—{w['SCORE_WEIGHT_IV']:.1f}=\"\n            f\"{gamma_score *\
          \ w['SCORE_WEIGHT_GAMMA_REGIME']:.1f}+\"\n            f\"{break_score *\
          \ w['SCORE_WEIGHT_BREAK_WALL']:.1f}+\"\n            f\"{direction_score\
          \ * w['SCORE_WEIGHT_DIRECTION']:.1f}+\"\n            f\"{iv_score * w['SCORE_WEIGHT_IV']:.1f}=\"\
          \n            f\"{total:.1f}\"\n        )\n        \n        return {\n\
          \            \"total_score\": round(total, 1),\n            \"weight_breakdown\"\
          : breakdown\n        }\n    \n    def check_entry_conditions(self, target_data:\
          \ Dict, total_score: float) -> Dict:\n        \"\"\"\n        å…¥åœºé—¨æ§›æ£€æŸ¥\n \
          \       \n        æ£€æŸ¥ 4 ä¸ªå…³é”®æ¡ä»¶ï¼š\n        1. spot_vs_trigger æ˜ç¡®\n        2.\
          \ gap_distance é€‚ä¸­\n        3. DEX åŒå‘æ€§\n        4. Vanna ç½®ä¿¡åº¦\n        \n\
          \        Args:\n            target_data: æ ‡çš„å®Œæ•´æ•°æ®\n            total_score:\
          \ æ€»è¯„åˆ†\n            \n        Returns:\n            å…¥åœºåˆ¤å®šç»“æœ\n        \"\"\"\
          \n        gamma = target_data.get('gamma_metrics', {})\n        directional\
          \ = target_data.get('directional_metrics', {})\n        \n        conditions_met\
          \ = []\n        conditions_failed = []\n        \n        # æ¡ä»¶1: spot_vs_trigger\
          \ æ˜ç¡®\n        spot_vs_trigger = gamma.get('spot_vs_trigger', 'unknown')\n\
          \        if spot_vs_trigger in ['above', 'below']:\n            conditions_met.append(f\"\
          æ¡ä»¶1: spot_vs_trigger={spot_vs_trigger}æ˜ç¡®\")\n        else:\n           \
          \ conditions_failed.append(f\"æ¡ä»¶1: spot_vs_trigger={spot_vs_trigger}ä¸´ç•ŒçŠ¶æ€\"\
          )\n        \n        # æ¡ä»¶2: gap_distance é€‚ä¸­\n        gap = gamma.get('gap_distance_em1_multiple',\
          \ 999)\n        if gap < 2:\n            conditions_met.append(f\"æ¡ä»¶2: gap_distance_em1={gap:.2f}<2\"\
          )\n        else:\n            conditions_failed.append(f\"æ¡ä»¶2: gap_distance_em1={gap:.2f}â‰¥2åå¤§\"\
          )\n        \n        # æ¡ä»¶3: DEX åŒå‘æ€§\n        dex = directional.get('dex_same_dir_pct',\
          \ 0)\n        if dex >= self.env['DEX_SAME_DIR_THRESHOLD_MEDIUM']:\n   \
          \         conditions_met.append(f\"æ¡ä»¶3: dex_same_dir={dex:.1f}â‰¥{self.env['DEX_SAME_DIR_THRESHOLD_MEDIUM']:.0f}%\"\
          )\n        else:\n            conditions_failed.append(f\"æ¡ä»¶3: dex_same_dir={dex:.1f}<{self.env['DEX_SAME_DIR_THRESHOLD_MEDIUM']:.0f}%\"\
          )\n        \n        # æ¡ä»¶4: Vanna ç½®ä¿¡åº¦\n        vanna_conf = directional.get('vanna_confidence',\
          \ 'low')\n        if vanna_conf in ['high', 'medium']:\n            conditions_met.append(f\"\
          æ¡ä»¶4: vanna_confidence={vanna_conf}\")\n        else:\n            conditions_failed.append(f\"\
          æ¡ä»¶4: vanna_confidence={vanna_conf}ä½ç½®ä¿¡\")\n        \n        # åˆ¤å®šé€»è¾‘\n   \
          \     met_count = len(conditions_met)\n        total_conditions = 4\n  \
          \      \n        # å…¥åœºåˆ¤å®š\n        if total_score >= self.env['ENTRY_THRESHOLD_SCORE']\
          \ and met_count >= 3:\n            entry_check = \"å…¥åœº\"\n            rationale_parts\
          \ = [\n                f\"æ€»åˆ†{total_score:.1f}â‰¥{self.env['ENTRY_THRESHOLD_SCORE']:.1f}æ»¡è¶³\"\
          ,\n                f\"å…³é”®ä¿¡å·ï¼š{met_count}/{total_conditions}ä¸ªæ¡ä»¶æ»¡è¶³\"\n     \
          \       ]\n            \n        elif total_score >= self.env['ENTRY_THRESHOLD_SCORE']\
          \ and met_count >= 2:\n            entry_check = \"è½»ä»“è¯•æ¢\"\n            rationale_parts\
          \ = [\n                f\"æ€»åˆ†{total_score:.1f}â‰¥{self.env['ENTRY_THRESHOLD_SCORE']:.1f}æ»¡è¶³\"\
          ,\n                f\"ä½†å…³é”®ä¿¡å·ä»…{met_count}/{total_conditions}ä¸ªæ¡ä»¶æ»¡è¶³\",\n   \
          \             \"å»ºè®®è½»ä»“è¯•æ¢\"\n            ]\n            \n        else:\n \
          \           entry_check = \"è§‚æœ›\"\n            rationale_parts = [\n    \
          \            f\"æ€»åˆ†{total_score:.1f}æˆ–æ¡ä»¶ä¸è¶³ï¼ˆ{met_count}/{total_conditions}ï¼‰\"\
          ,\n                \"å»ºè®®è§‚æœ›\"\n            ]\n        \n        # ç»„è£… rationale\n\
          \        rationale = \"ã€‚\".join(rationale_parts) + \"ã€‚\"\n        rationale\
          \ += f\"\\næ»¡è¶³ï¼š{', '.join(conditions_met) if conditions_met else 'æ— '}\"\n\
          \        rationale += f\"\\nä¸æ»¡è¶³ï¼š{', '.join(conditions_failed) if conditions_failed\
          \ else 'æ— '}\"\n        \n        return {\n            \"entry_threshold_check\"\
          : entry_check,\n            \"entry_rationale\": rationale,\n          \
          \  \"conditions_met_count\": met_count,\n            \"conditions_total\"\
          : total_conditions,\n            \"conditions_met\": conditions_met,\n \
          \           \"conditions_failed\": conditions_failed\n        }\n    \n\
          \    def generate_risk_warnings(self, target_data: Dict, scores: Dict) ->\
          \ str:\n        \"\"\"\n        ç”Ÿæˆé£é™©è­¦ç¤º\n        \n        Args:\n      \
          \      target_data: æ ‡çš„å®Œæ•´æ•°æ®\n            scores: å„ç»´åº¦è¯„åˆ†\n            \n  \
          \      Returns:\n            é£é™©è­¦ç¤ºå­—ç¬¦ä¸²\n        \"\"\"\n        warnings =\
          \ []\n        \n        gamma = target_data.get('gamma_metrics', {})\n \
          \       directional = target_data.get('directional_metrics', {})\n     \
          \   \n        gap_distance = gamma.get('gap_distance_em1_multiple', 0)\n\
          \        spot_vs_trigger = gamma.get('spot_vs_trigger', 'unknown')\n   \
          \     cluster_strength = gamma.get('cluster_strength_ratio', 0)\n      \
          \  vanna_dir = directional.get('vanna_dir', 'neutral')\n        iv_path\
          \ = directional.get('iv_path', 'å¹³')\n        \n        # è­¦ç¤º1: gap_distance\
          \ åå¤§\n        if gap_distance > 2:\n            wall_type = \"Call Wall\"\
          \ if spot_vs_trigger == 'above' else \"Put Wall\"\n            warnings.append(\n\
          \                f\"gap_distanceåå¤§éœ€{gap_distance:.2f}å€EM1$æ‰èƒ½åˆ°{wall_type}ï¼Œ\"\
          \n                f\"è‹¥çŸ­æœŸå†…æœªçªç ´éœ€è°ƒæ•´ä¸ºåŒºé—´ç­–ç•¥\"\n            )\n        \n      \
          \  # è­¦ç¤º2: ä¸´ç•ŒçŠ¶æ€\n        if spot_vs_trigger == \"near\":\n            warnings.append(\n\
          \                \"ç°ä»·æ¥è¿‘Gammaç¿»è½¬çº¿ï¼Œregimeå¯èƒ½åè½¬ï¼Œé«˜æ³¢åŠ¨é£é™©\"\n            )\n    \
          \    \n        # è­¦ç¤º3: Vanna ä¸ IV å†²çª\n        vanna_up = vanna_dir == 'up'\n\
          \        vanna_down = vanna_dir == 'down'\n        iv_up = iv_path == 'å‡'\n\
          \        iv_down = iv_path == 'é™'\n        \n        if (vanna_up and iv_down)\
          \ or (vanna_down and iv_up):\n            warnings.append(\n           \
          \     f\"Vannaæ–¹å‘{vanna_dir}ä¸IVè·¯å¾„{iv_path}å†²çªï¼Œä¿¡å·ä¸ä¸€è‡´ï¼Œå¢åŠ ä¸ç¡®å®šæ€§\"\n           \
          \ )\n        \n        # è­¦ç¤º4: ç°‡å¼ºåº¦æå¼º\n        if cluster_strength >= self.env['CLUSTER_STRENGTH_THRESHOLD_STRONG']:\n\
          \            warnings.append(\n                f\"ç°‡å¼ºåº¦{cluster_strength:.2f}â‰¥{self.env['CLUSTER_STRENGTH_THRESHOLD_STRONG']:.1f}ï¼Œ\"\
          \n                f\"ä¸»å¢™æå¼ºï¼Œç ´å¢™éš¾åº¦é«˜\"\n            )\n        \n        # è­¦ç¤º5:\
          \ ç°‡å¼ºåº¦æ¥è¿‘æå¼ºé˜ˆå€¼\n        elif cluster_strength >= self.env['CLUSTER_STRENGTH_THRESHOLD_STRONG']\
          \ - 0.2:\n            warnings.append(\n                f\"ç°‡å¼ºåº¦{cluster_strength:.2f}æ¥è¿‘{self.env['CLUSTER_STRENGTH_THRESHOLD_STRONG']:.1f}ï¼Œ\"\
          \n                f\"æ³¨æ„ä¸»å¢™é˜»åŠ›\"\n            )\n        \n        return \"\
          ; \".join(warnings) if warnings else \"é£é™©å¯æ§\"\n    \n    def process(self,\
          \ agent3_data: Dict) -> Dict:\n        \"\"\"\n        ä¸»å¤„ç†æµç¨‹\n        \n\
          \        Args:\n            agent3_data: Agent 3 çš„æ•°æ®æ ¡éªŒç»“æœ\n            \n\
          \        Returns:\n            å®Œæ•´çš„è¯„åˆ†ç»“æœ JSON\n        \"\"\"\n        # æå–ç›®æ ‡æ•°æ®ï¼ˆå‡è®¾å•æ ‡çš„ï¼‰\n\
          \        targets = agent3_data.get('targets', [])\n        if not targets:\n\
          \            raise ValueError(\"Agent 3 æ•°æ®ä¸­æœªæ‰¾åˆ° targets å­—æ®µ\")\n        \n\
          \        target = targets[0]\n        \n        # å››ç»´è¯„åˆ†\n        gamma_result\
          \ = self.calculate_gamma_regime_score(\n            target.get('gamma_metrics',\
          \ {})\n        )\n        \n        break_wall_result = self.calculate_break_wall_score(\n\
          \            target.get('gamma_metrics', {})\n        )\n        \n    \
          \    direction_result = self.calculate_direction_score(\n            target.get('directional_metrics',\
          \ {})\n        )\n        \n        iv_result = self.calculate_iv_score(\n\
          \            target.get('directional_metrics', {})\n        )\n        \n\
          \        # æ±‡æ€»è¯„åˆ†\n        scores = {\n            'gamma': gamma_result,\n\
          \            'break_wall': break_wall_result,\n            'direction':\
          \ direction_result,\n            'iv': iv_result\n        }\n        \n\
          \        # æ€»åˆ†è®¡ç®—\n        total_result = self.calculate_total_score(scores)\n\
          \        \n        # å…¥åœºæ£€æŸ¥\n        entry_result = self.check_entry_conditions(target,\
          \ total_result['total_score'])\n        \n        # é£é™©è­¦ç¤º\n        risk_warning\
          \ = self.generate_risk_warnings(target, scores)\n        \n        # æå–å…³é”®ä½\n\
          \        walls = target.get('walls', {})\n        gamma_metrics = target.get('gamma_metrics',\
          \ {})\n        \n        # ç»„è£…æœ€ç»ˆè¾“å‡º\n        result = {\n            \"gamma_regime\"\
          : {\n                \"vol_trigger\": gamma_metrics.get('vol_trigger'),\n\
          \                \"spot_vs_trigger\": gamma_metrics.get('spot_vs_trigger'),\n\
          \                \"base_scenario\": gamma_result['base_scenario'],\n   \
          \             \"regime_note\": gamma_result['regime_note']\n           \
          \ },\n            \"break_wall_assessment\": {\n                \"gap_distance_em1\"\
          : break_wall_result['gap_distance_em1'],\n                \"cluster_strength\"\
          : break_wall_result['cluster_strength'],\n                \"monthly_override\"\
          : break_wall_result['monthly_override'],\n                \"threshold\"\
          : break_wall_result['threshold'],\n                \"threshold_note\": break_wall_result['threshold_note'],\n\
          \                \"break_probability\": break_wall_result['break_probability'],\n\
          \                \"break_note\": break_wall_result['break_note']\n     \
          \       },\n            \"directional_signals\": {\n                \"dex_same_dir\"\
          : direction_result['dex_same_dir'],\n                \"vanna_dir\": direction_result['vanna_dir'],\n\
          \                \"vanna_confidence\": direction_result['vanna_confidence'],\n\
          \                \"vanna_weight\": direction_result['vanna_weight'],\n \
          \               \"direction_strength\": direction_result['direction_strength'],\n\
          \                \"direction_note\": direction_result['direction_note']\n\
          \            },\n            \"iv_dynamics\": {\n                \"iv_path\"\
          : iv_result['iv_path'],\n                \"iv_path_confidence\": iv_result['iv_path_confidence'],\n\
          \                \"iv_signal\": iv_result['iv_signal'],\n              \
          \  \"iv_note\": iv_result['iv_note']\n            },\n            \"scoring\"\
          : {\n                \"gamma_regime_score\": gamma_result['score'],\n  \
          \              \"gamma_regime_rationale\": gamma_result['rationale'],\n\
          \                \"break_wall_score\": break_wall_result['score'],\n   \
          \             \"break_wall_rationale\": break_wall_result['rationale'],\n\
          \                \"direction_score\": direction_result['score'],\n     \
          \           \"direction_rationale\": direction_result['rationale'],\n  \
          \              \"iv_score\": iv_result['score'],\n                \"iv_score_rationale\"\
          : iv_result['rationale'],\n                \"total_score\": total_result['total_score'],\n\
          \                \"weight_breakdown\": total_result['weight_breakdown']\n\
          \            },\n            \"entry_threshold_check\": entry_result['entry_threshold_check'],\n\
          \            \"entry_rationale\": entry_result['entry_rationale'],\n   \
          \         \"key_levels\": {\n                \"support\": walls.get('put_wall'),\n\
          \                \"resistance\": walls.get('call_wall'),\n             \
          \   \"trigger_line\": gamma_metrics.get('vol_trigger'),\n              \
          \  \"current_spot\": target.get('spot_price')\n            },\n        \
          \    \"risk_warning\": risk_warning\n        }\n        \n        return\
          \ result\n"
        code_language: python3
        desc: é‡åŒ–è®¡ç®—ï¼šæ‰§è¡Œå››ç»´è¯„åˆ†å’Œå…¥åœºæ¡ä»¶åˆ¤æ–­ --1007
        outputs:
          result:
            children: null
            type: object
        selected: false
        title: CODE2 è¯„åˆ†è®¡ç®—å¼•æ“
        type: code
        variables:
        - value_selector:
          - '3001'
          - text
          value_type: string
          variable: agent3_output
        - value_selector:
          - '4001'
          - text
          value_type: string
          variable: agent4_output
      height: 96
      id: '1007'
      position:
        x: 1999.7575755619544
        y: 228.0383411733186
      positionAbsolute:
        x: 1999.7575755619544
        y: 228.0383411733186
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: å¯¹æ¯”ä¸‰ç§ç­–ç•¥ï¼Œç»™å‡ºæ¨èæ’åº 1005
        model:
          completion_params:
            temperature: 0.5
          mode: chat
          name: Qwen3-VL-235B-A22B-Thinking
          provider: langgenius/openai_api_compatible/openai_api_compatible
        prompt_template:
        - id: 62397f3f-2606-4bb8-b151-b0100ed177c1
          role: system
          text: "ä½ æ˜¯ç­–ç•¥å¯¹æ¯” Agentã€‚\n\nã€ä»»åŠ¡ã€‘åŸºäºæœŸæœ›å€¼ã€é£é™©è°ƒæ•´æ”¶ç›Šã€å‰§æœ¬åŒ¹é…åº¦ã€æµåŠ¨æ€§ç­‰ç»´åº¦ï¼Œç»™å‡ºç­–ç•¥æ¨èæ’åºã€‚\n\nã€è¾“å…¥ã€‘\n\
            - ç­–ç•¥JSONï¼š{{#6001.text#}}\n- å‰§æœ¬è¯„åˆ†ï¼š{{#5001.text#}}\n- åŸå§‹æ•°æ®ï¼š{{#3001.text#}}\n\
            - è®¡ç®—è¾…åŠ©ï¼š\n```json\n{{#1006.result#}}\n```\n\n## æ ¸å¿ƒèŒè´£ \n### 1. è§£æç­–ç•¥æ•°æ® ä»\
            \ Agent 6 çš„è¾“å‡ºä¸­æå–ä¸‰ç§ç­–ç•¥çš„å…³é”®æ•°æ®ï¼š \n - ç­–ç•¥ç±»å‹ï¼ˆä¿å®ˆ/å‡è¡¡/è¿›å–ï¼‰ \n - ç»“æ„åç§°ï¼ˆIron Condor /\
            \ Bull Call Spread / Long Callï¼‰         - RR æ•°æ®ï¼šmax_profit, max_loss,\
            \ rr_ratio\n - Pw æ•°æ®ï¼špw_estimate (éœ€è½¬æ¢ä¸ºå°æ•°) \n- è…¿éƒ¨æ•°é‡ï¼ˆç”¨äºæµåŠ¨æ€§è¯„ä¼°ï¼‰\n\n**æ•°æ®æå–ç¤ºä¾‹**ï¼š\
            \ \n```python \nstrategies = json.loads(agent6_output)[\"strategies\"\
            ] for strategy in strategies: strategy_type = strategy[\"strategy_type\"\
            ] max_profit = strategy[\"rr_calculation\"][\"max_profit\"] max_loss =\
            \ strategy[\"rr_calculation\"][\"max_loss\"] pw_str = strategy[\"pw_calculation\"\
            ][\"pw_estimate\"] # \"68%\" pw = float(pw_str.rstrip(\"%\")) / 100 #\
            \ 0.68 \n``` ---\n\n### 2. é‡åŒ–æŒ‡æ ‡è®¡ç®—\n        \n#### æŒ‡æ ‡ Aï¼šæœŸæœ›å€¼ (EV)\n\n\n\
            **å…¬å¼**ï¼š\n```\nEV = Pw Ã— MaxProfit - (1 - Pw) Ã— MaxLoss\n```\n\n\n**è§£è¯»**ï¼š\n\
            - EV > 0ï¼šæ­£æœŸæœ›å€¼ï¼Œé•¿æœŸç›ˆåˆ©\n- EV < 0ï¼šè´ŸæœŸæœ›å€¼ï¼Œä¸å»ºè®®æ‰§è¡Œ\n- EV è¶Šé«˜è¶Šå¥½\n\n\n**ç¤ºä¾‹è®¡ç®—**ï¼š\n```\n\
            ä¿å®ˆç­–ç•¥ï¼ˆIron Condorï¼‰ï¼š\n- MaxProfit = 1.35\n- MaxLoss = 3.15\n- Pw = 68% =\
            \ 0.68\n\n\nEV = 0.68 Ã— 1.35 - (1 - 0.68) Ã— 3.15\n    = 0.918 - 1.008\n\
            \    = -0.09\n\n\nè§£è¯»ï¼šè™½ç„¶èƒœç‡é«˜ï¼Œä½†ç›ˆäºæ¯”ä¸å¯¹ç§°ï¼ŒæœŸæœ›å€¼ç•¥è´Ÿ\n```\n\n\n#### æŒ‡æ ‡ Bï¼šé£é™©è°ƒæ•´æ”¶ç›Š (Risk-Adjusted\
            \ Return)\n\n\n**å…¬å¼**ï¼š\n```\nRAR = EV / MaxLoss\n```\n\n\n**è§£è¯»**ï¼š\n- RAR\
            \ > 0.15ï¼šä¼˜ç§€ï¼ˆæ¯æ‰¿æ‹… 1 ç¾å…ƒé£é™©ï¼ŒæœŸæœ›èµš 0.15 ç¾å…ƒï¼‰\n- RAR > 0.05ï¼šåˆæ ¼\n- RAR < 0ï¼šä¸å»ºè®®\n\n\
            \n**ç¤ºä¾‹è®¡ç®—**ï¼š\n```\nå‡è¡¡ç­–ç•¥ï¼ˆBull Call Spreadï¼‰ï¼š\n- MaxProfit = 6.3\n- MaxLoss\
            \ = 2.7\n- Pw = 52% = 0.52\n\n\nEV = 0.52 Ã— 6.3 - 0.48 Ã— 2.7 = 3.276 -\
            \ 1.296 = 1.98\nRAR = 1.98 / 2.7 = 0.733\n\n\nè§£è¯»ï¼šé£é™©è°ƒæ•´æ”¶ç›Šæé«˜ï¼Œéå¸¸ä¼˜ç§€\n```\n\n\
            \n#### æŒ‡æ ‡ Cï¼šå‰§æœ¬åŒ¹é…åº¦\n\n\n**åŒ¹é…è§„åˆ™**ï¼š\n\n\n| ç­–ç•¥ç±»å‹ | ä¸»å¯¼å‰§æœ¬ | åŒ¹é…åº¦ | ç†ç”± |\n|---------|---------|--------|------|\n\
            | ä¿å®ˆ | åŒºé—´ | é«˜ | ä¿¡ç”¨ä»·å·®é€‚åˆæ­£Î³ç¯å¢ƒ |\n| ä¿å®ˆ | è¶‹åŠ¿ | ä½ | åŒºé—´ç­–ç•¥åœ¨è¶‹åŠ¿ä¸­æ˜“è¢«çªç ´ |\n| å‡è¡¡ | è¶‹åŠ¿\
            \ | é«˜ | å€Ÿè®°ä»·å·®é€‚åˆè¶‹åŠ¿åˆæœŸ |\n| å‡è¡¡ | åŒºé—´ | ä¸­ | å¯è·å–éƒ¨åˆ†æ–¹å‘æ”¶ç›Š |\n| è¿›å– | å¼ºè¶‹åŠ¿ | é«˜ | å•è…¿æ•å£é€‚åˆåŠ é€Ÿè¡Œæƒ…\
            \ |\n| è¿›å– | åŒºé—´/è¿‡æ¸¡ | ä½ | æ—¶é—´ä»·å€¼å¿«é€Ÿæµå¤± |\n\n\n**ä»£ç å®ç°**ï¼š\n```python\n    def\
            \ calculate_scenario_match(strategy_type: str, primary_scenario: str,\
            \ \n                                scenario_probability: int) -> tuple[str,\
            \ str]:\n        \"\"\"\n        è®¡ç®—å‰§æœ¬åŒ¹é…åº¦\n        \n        Returns:\n\
            \            (åŒ¹é…åº¦ç­‰çº§, ç†ç”±)\n        \"\"\"\n        if strategy_type ==\
            \ \"ä¿å®ˆ\":\n            if \"åŒºé—´\" in primary_scenario and scenario_probability\
            \ >= 60:\n                return \"é«˜\", f\"åŒºé—´å‰§æœ¬æ¦‚ç‡ {scenario_probability}%ï¼Œä¿¡ç”¨ç­–ç•¥å®Œç¾åŒ¹é…\"\
            \n            elif \"åŒºé—´\" in primary_scenario:\n                return\
            \ \"ä¸­\", f\"åŒºé—´å‰§æœ¬æ¦‚ç‡ {scenario_probability}% ç•¥ä½ï¼Œä½†ä»é€‚é…\"\n            else:\n\
            \                return \"ä½\", f\"è¶‹åŠ¿å‰§æœ¬ {primary_scenario}ï¼ŒåŒºé—´ç­–ç•¥ä¸é€‚é…\"\n\
            \        \n        elif strategy_type == \"å‡è¡¡\":\n            if \"è¶‹åŠ¿\"\
            \ in primary_scenario and scenario_probability >= 55:\n              \
            \  return \"é«˜\", f\"è¶‹åŠ¿å‰§æœ¬æ¦‚ç‡ {scenario_probability}%ï¼Œå€Ÿè®°ç­–ç•¥é€‚é…\"\n        \
            \    elif \"åŒºé—´\" in primary_scenario:\n                return \"ä¸­\", \"\
            åŒºé—´å‰§æœ¬ä¸‹å¯è·å–éƒ¨åˆ†æ–¹å‘æ”¶ç›Š\"\n            else:\n                return \"ä½\", \"\
            å‰§æœ¬ä¸æ˜ç¡®ï¼Œæ–¹å‘ç­–ç•¥é£é™©å¤§\"\n        \n        elif strategy_type == \"è¿›å–\":\n   \
            \         if \"å¼ºè¶‹åŠ¿\" in primary_scenario or scenario_probability >= 65:\n\
            \                return \"é«˜\", f\"å¼ºç¡®ä¿¡åœºæ™¯ï¼ˆ{scenario_probability}%ï¼‰ï¼Œå•è…¿æ•å£å¯æœ€å¤§åŒ–æ”¶ç›Š\"\
            \n            elif \"è¶‹åŠ¿\" in primary_scenario:\n                return\
            \ \"ä¸­\", \"è¶‹åŠ¿åˆæœŸï¼Œå•è…¿é£é™©è¾ƒå¤§\"\n            else:\n                return \"\
            ä½\", \"éè¶‹åŠ¿åœºæ™¯ï¼Œå•è…¿æ—¶é—´ä»·å€¼æµå¤±å¿«\"\n        \n        return \"ä½\", \"æ— æ³•åˆ¤æ–­åŒ¹é…åº¦\"\n\
            ```\n        \n#### æŒ‡æ ‡ Dï¼šæµåŠ¨æ€§è¯„ä¼°\n        \n**è¯„ä¼°æ ‡å‡†**ï¼š\n```python\n    def\
            \ check_liquidity(strategy: dict, spot: float, em1: float) -> tuple[bool,\
            \ str]:\n        \"\"\"\n        æ£€æŸ¥æµåŠ¨æ€§æ˜¯å¦è¾¾æ ‡\n        \n        Args:\n\
            \            strategy: ç­–ç•¥å¯¹è±¡\n            spot: ç°ä»·\n            em1: EM1$\n\
            \            \n        Returns:\n            (æ˜¯å¦é€šè¿‡, è¯´æ˜)\n        \"\"\"\
            \n        legs = strategy[\"legs\"]\n        \n        # 1. æ£€æŸ¥è…¿éƒ¨æ•°é‡ï¼ˆè…¿è¶Šå¤šæµåŠ¨æ€§è¦æ±‚è¶Šé«˜ï¼‰\n\
            \        leg_count = len(legs)\n        if leg_count > 4:\n          \
            \  return False, f\"è…¿éƒ¨æ•°é‡ {leg_count} è¿‡å¤šï¼ŒæµåŠ¨æ€§é£é™©é«˜\"\n        \n        #\
            \ 2. æ£€æŸ¥è¡Œæƒä»·è·ç¦»ç°ä»·ï¼ˆè¿‡è¿œè™šå€¼æµåŠ¨æ€§å·®ï¼‰\n        for leg in legs:\n            strike\
            \ = leg[\"strike\"]\n            \n            # å¤„ç†è®¡ç®—è¡¨è¾¾å¼ï¼ˆå¦‚ \"è®¡ç®—: 170.5\
            \ + 0.2Ã—3.0\"ï¼‰\n            if isinstance(strike, str) and \"è®¡ç®—:\" in\
            \ strike:\n                # è·³è¿‡è®¡ç®—è¡¨è¾¾å¼ï¼Œå‡è®¾ LLM ä¼šç®—å‡ºåˆç†å€¼\n                continue\n\
            \            \n            distance_em1 = abs(strike - spot) / em1\n \
            \           \n            if distance_em1 > 3:\n                return\
            \ False, f\"{leg['type']} @ {strike} è·ç°ä»· {distance_em1:.1f}Ã—EM1$ï¼ŒæµåŠ¨æ€§ä¸è¶³\"\
            \n        \n        # 3. æ£€æŸ¥å®½åº¦ï¼ˆè¿‡å®½çš„ spread ä¸­é—´è¡Œæƒä»·å¯èƒ½æµåŠ¨æ€§å·®ï¼‰\n        if strategy[\"\
            structure\"] in [\"Iron Condor\", \"Iron Butterfly\"]:\n            call_width\
            \ = None\n            put_width = None\n            \n            for\
            \ i, leg in enumerate(legs):\n                if leg[\"type\"] == \"call\"\
            :\n                    if call_width is None:\n                      \
            \  call_width = 0\n                    if i + 1 < len(legs) and legs[i+1][\"\
            type\"] == \"call\":\n                        call_width = abs(legs[i+1][\"\
            strike\"] - leg[\"strike\"])\n            \n            if call_width\
            \ and call_width > 2 * em1:\n                return False, f\"Call ä»·å·®å®½åº¦\
            \ {call_width:.1f} > 2Ã—EM1$ï¼Œä¸­é—´è¡Œæƒä»·æµåŠ¨æ€§å­˜ç–‘\"\n        \n        return True,\
            \ \"æµåŠ¨æ€§è¾¾æ ‡\"\n```\n        \n        ---\n        \n### 3. ç»¼åˆæ’åºé€»è¾‘\n\n\n\
            **æ’åºæƒé‡**ï¼š\n1. **æœŸæœ›å€¼ EV**ï¼ˆ40%ï¼‰ï¼šå¿…é¡» > 0 æ‰è€ƒè™‘\n2. **é£é™©è°ƒæ•´æ”¶ç›Š RAR**ï¼ˆ30%ï¼‰ï¼šè¶Šé«˜è¶Šå¥½\n\
            3. **å‰§æœ¬åŒ¹é…åº¦**ï¼ˆ20%ï¼‰ï¼šé«˜ > ä¸­ > ä½\n4. **æµåŠ¨æ€§**ï¼ˆ10%ï¼‰ï¼šä¸é€šè¿‡ç›´æ¥é™çº§\n\n\n**æ’åºç®—æ³•**ï¼š\n\
            ```python\n    def rank_strategies(strategies: list, primary_scenario:\
            \ str, \n                        scenario_probability: int, spot: float,\
            \ em1: float) -> list:\n        \"\"\"\n        ç­–ç•¥æ’åºä¸»å‡½æ•°\n        \n  \
            \      Returns:\n            æ’åºåçš„ç­–ç•¥åˆ—è¡¨ï¼ˆåŒ…å«è¯„åˆ†ï¼‰\n        \"\"\"\n        ranked\
            \ = []\n        \n        for strategy in strategies:\n            # æå–æ•°æ®\n\
            \            max_profit = strategy[\"rr_calculation\"][\"max_profit\"\
            ]\n            max_loss = strategy[\"rr_calculation\"][\"max_loss\"]\n\
            \            pw_str = strategy[\"pw_calculation\"][\"pw_estimate\"]\n\
            \            \n            # å¤„ç† pwï¼ˆå¯èƒ½æ˜¯ \"68%\" æˆ– \"çº¦ 35-50%\"ï¼‰\n     \
            \       if \"çº¦\" in pw_str:\n                # å–ä¸­é—´å€¼\n                pw\
            \ = 0.4  # é»˜è®¤ 40%\n            elif \"-\" in pw_str:\n               \
            \ # å–å¹³å‡å€¼\n                range_parts = pw_str.replace(\"%\", \"\").split(\"\
            -\")\n                pw = (float(range_parts[0]) + float(range_parts[1]))\
            \ / 200\n            else:\n                pw = float(pw_str.rstrip(\"\
            %\")) / 100\n            \n            # è®¡ç®— EV å’Œ RAR\n            ev =\
            \ pw * max_profit - (1 - pw) * max_loss\n            rar = ev / max_loss\
            \ if max_loss > 0 else 0\n            \n            # å‰§æœ¬åŒ¹é…åº¦\n        \
            \    scenario_match, match_reason = calculate_scenario_match(\n      \
            \          strategy[\"strategy_type\"], \n                primary_scenario,\
            \ \n                scenario_probability\n            )\n            \n\
            \            # æµåŠ¨æ€§æ£€æŸ¥\n            liquidity_pass, liquidity_note = check_liquidity(strategy,\
            \ spot, em1)\n            \n            # ç»¼åˆè¯„åˆ†ï¼ˆæ»¡åˆ† 100ï¼‰\n            score\
            \ = 0\n            \n            # EV è¯„åˆ†ï¼ˆ40 åˆ†ï¼‰\n            if ev > 0.5:\n\
            \                score += 40\n            elif ev > 0.2:\n           \
            \     score += 30\n            elif ev > 0:\n                score +=\
            \ 20\n            else:\n                score += 0  # è´Ÿ EV ä¸ç»™åˆ†\n    \
            \        \n            # RAR è¯„åˆ†ï¼ˆ30 åˆ†ï¼‰\n            if rar > 0.3:\n   \
            \             score += 30\n            elif rar > 0.15:\n            \
            \    score += 25\n            elif rar > 0.05:\n                score\
            \ += 15\n            else:\n                score += 0\n            \n\
            \            # å‰§æœ¬åŒ¹é…åº¦è¯„åˆ†ï¼ˆ20 åˆ†ï¼‰\n            if scenario_match == \"é«˜\":\n\
            \                score += 20\n            elif scenario_match == \"ä¸­\"\
            :\n                score += 10\n            else:\n                score\
            \ += 0\n            \n            # æµåŠ¨æ€§è¯„åˆ†ï¼ˆ10 åˆ†ï¼‰\n            if liquidity_pass:\n\
            \                score += 10\n            else:\n                score\
            \ += 0\n            \n            # æ·»åŠ åˆ°ç»“æœ\n            ranked.append({\n\
            \                \"strategy\": strategy,\n                \"ev\": round(ev,\
            \ 2),\n                \"rar\": round(rar, 3),\n                \"scenario_match\"\
            : scenario_match,\n                \"match_reason\": match_reason,\n \
            \               \"liquidity_pass\": liquidity_pass,\n                \"\
            liquidity_note\": liquidity_note,\n                \"composite_score\"\
            : score\n            })\n        \n        # æŒ‰ç»¼åˆè¯„åˆ†æ’åº\n        ranked.sort(key=lambda\
            \ x: x[\"composite_score\"], reverse=True)\n        \n        # æ·»åŠ æ’å\n\
            \        for i, item in enumerate(ranked):\n            item[\"rank\"\
            ] = i + 1\n        \n        return ranked\n```\n        \n---\n\n\n###\
            \ 4. æœ€ç»ˆæ¨èç”Ÿæˆ\n        \n**æ¨èé€»è¾‘**ï¼š\n```python\n    def generate_recommendation(ranked_strategies:\
            \ list) -> str:\n        \"\"\"\n        ç”Ÿæˆæœ€ç»ˆæ¨èæ–‡æœ¬\n        \"\"\"\n  \
            \      top1 = ranked_strategies[0]\n        top2 = ranked_strategies[1]\
            \ if len(ranked_strategies) > 1 else None\n        \n        # åŸºç¡€æ¨è\n\
            \        recommendation = f\"æ¨èæ‰§è¡Œ {top1['strategy']['strategy_type']}\
            \ ç­–ç•¥ï¼ˆ{top1['strategy']['structure']}ï¼‰\"\n        \n        # EV æ£€æŸ¥\n \
            \       if top1[\"ev\"] <= 0:\n            recommendation += \"ï¼Œä½†æ³¨æ„æœŸæœ›å€¼ä¸ºè´Ÿï¼Œå»ºè®®è°¨æ…æˆ–è§‚æœ›\"\
            \n            return recommendation\n        \n        # æµåŠ¨æ€§æ£€æŸ¥\n     \
            \   if not top1[\"liquidity_pass\"]:\n            recommendation += f\"\
            ï¼Œä½†å­˜åœ¨æµåŠ¨æ€§é—®é¢˜ï¼ˆ{top1['liquidity_note']}ï¼‰ï¼Œå»ºè®®é™ä½ä»“ä½æˆ–è°ƒæ•´ç»“æ„\"\n            return\
            \ recommendation\n        \n        # å‰§æœ¬åŒ¹é…åº¦æ£€æŸ¥\n        if top1[\"scenario_match\"\
            ] == \"ä½\":\n            recommendation += f\"ï¼Œä½†å‰§æœ¬åŒ¹é…åº¦ä½ï¼ˆ{top1['match_reason']}ï¼‰ï¼Œå»ºè®®è§‚æœ›æˆ–ç­‰å¾…ä¿¡å·æ˜ç¡®\"\
            \n            return recommendation\n        \n        # æ¬¡é€‰æ¨è\n      \
            \  if top2 and top2[\"ev\"] > 0 and top2[\"composite_score\"] >= 60:\n\
            \            recommendation += f\"ï¼›è‹¥é£é™©æ‰¿å—åŠ›è¾ƒé«˜ï¼Œå¯é…ç½® 20-30% ä»“ä½äº {top2['strategy']['strategy_type']}\
            \ ç­–ç•¥ä½œä¸ºè¡¥å……\"\n        \n        return recommendation\n```\n        \n---\n\
            \n\n## è¾“å‡º JSON æ ¼å¼\n```json\n    {\n    \"symbol\": \"AAPL\",\n    \"comparison_summary\"\
            : {\n    \"total_strategies\": 3,\n    \"positive_ev_count\": 2,\n   \
            \ \"recommended_count\": 1,\n    \"analysis_timestamp\": \"2025-01-15T10:30:00-05:00\"\
            \n    },\n    \"ranking\": [\n    {\n        \"rank\": 1,\n        \"\
            strategy_type\": \"å‡è¡¡\",\n        \"structure\": \"Bull Call Spread\"\
            ,\n        \"metrics\": {\n        \"ev\": 1.98,\n        \"rar\": 0.733,\n\
            \        \"pw\": 0.52,\n        \"max_profit\": 6.3,\n        \"max_loss\"\
            : 2.7,\n        \"rr_ratio\": \"2.3:1\"\n        },\n        \"assessment\"\
            : {\n        \"scenario_match\": \"é«˜\",\n        \"match_reason\": \"\
            è¶‹åŠ¿å‰§æœ¬æ¦‚ç‡ 65%ï¼Œå€Ÿè®°ç­–ç•¥é€‚é…\",\n        \"liquidity_pass\": true,\n        \"liquidity_note\"\
            : \"æµåŠ¨æ€§è¾¾æ ‡\",\n        \"composite_score\": 95\n        },\n        \"\
            recommendation\": \"å¼ºçƒˆæ¨è\",\n        \"note\": \"æœŸæœ›å€¼æ­£å‘ä¸”é£é™©è°ƒæ•´æ”¶ç›Šä¼˜ç§€ï¼Œå‰§æœ¬åŒ¹é…åº¦é«˜ï¼ŒæµåŠ¨æ€§å……è¶³\"\
            \n    },\n    {\n        \"rank\": 2,\n        \"strategy_type\": \"ä¿å®ˆ\"\
            ,\n        \"structure\": \"Iron Condor\",\n        \"metrics\": {\n \
            \       \"ev\": -0.09,\n        \"rar\": -0.029,\n        \"pw\": 0.68,\n\
            \        \"max_profit\": 1.35,\n        \"max_loss\": 3.15,\n        \"\
            rr_ratio\": \"1:2.3\"\n        },\n        \"assessment\": {\n       \
            \ \"scenario_match\": \"ä½\",\n        \"match_reason\": \"è¶‹åŠ¿å‰§æœ¬ è¶‹åŠ¿ä¸Šè¡Œï¼ŒåŒºé—´ç­–ç•¥ä¸é€‚é…\"\
            ,\n        \"liquidity_pass\": true,\n        \"liquidity_note\": \"æµåŠ¨æ€§è¾¾æ ‡\"\
            ,\n        \"composite_score\": 40\n        },\n        \"recommendation\"\
            : \"ä¸æ¨è\",\n        \"note\": \"è™½ç„¶èƒœç‡é«˜ä½†æœŸæœ›å€¼ä¸ºè´Ÿï¼Œä¸”å‰§æœ¬ä¸åŒ¹é…ï¼Œä¸å»ºè®®æ‰§è¡Œ\"\n    },\n \
            \   {\n        \"rank\": 3,\n        \"strategy_type\": \"è¿›å–\",\n    \
            \    \"structure\": \"Long Call\",\n        \"metrics\": {\n        \"\
            ev\": 0.32,\n        \"rar\": 0.1,\n        \"pw\": 0.4,\n        \"max_profit\"\
            : \"ç†è®ºæ— é™ï¼ˆå®é™…ç›®æ ‡ 8.8ï¼‰\",\n        \"max_loss\": 3.2,\n        \"rr_ratio\"\
            : \"2.75:1\"\n        },\n        \"assessment\": {\n        \"scenario_match\"\
            : \"ä¸­\",\n        \"match_reason\": \"è¶‹åŠ¿åˆæœŸï¼Œå•è…¿é£é™©è¾ƒå¤§\",\n        \"liquidity_pass\"\
            : true,\n        \"liquidity_note\": \"æµåŠ¨æ€§è¾¾æ ‡\",\n        \"composite_score\"\
            : 55\n        },\n        \"recommendation\": \"è°¨æ…è€ƒè™‘\",\n        \"note\"\
            : \"æœŸæœ›å€¼æ­£å‘ä½†èƒœç‡è¾ƒä½ï¼Œä»…é€‚åˆå°ä»“ä½è¯•æ¢ï¼ˆâ‰¤1% è´¦æˆ·èµ„é‡‘ï¼‰\"\n    }\n    ],\n    \"final_recommendation\"\
            : \"æ¨èæ‰§è¡Œ å‡è¡¡ ç­–ç•¥ï¼ˆBull Call Spreadï¼‰ï¼ŒæœŸæœ›å€¼ 1.98ï¼Œé£é™©è°ƒæ•´æ”¶ç›Š 0.733ï¼Œå‰§æœ¬åŒ¹é…åº¦é«˜ï¼›ä¸æ¨è ä¿å®ˆ ç­–ç•¥ï¼ˆæœŸæœ›å€¼è´Ÿï¼‰ï¼›è¿›å–\
            \ ç­–ç•¥å¯ä½œä¸ºå°ä»“ä½è¯•æ¢\",\n    \"execution_priority\": {\n    \"primary\": {\n \
            \       \"strategy_type\": \"å‡è¡¡\",\n        \"allocation\": \"70-80% å¯ç”¨èµ„é‡‘\"\
            ,\n        \"rationale\": \"ç»¼åˆè¯„åˆ†æœ€é«˜ï¼ŒæœŸæœ›å€¼å’Œé£é™©è°ƒæ•´æ”¶ç›Šå‡ä¼˜ç§€\"\n    },\n    \"secondary\"\
            : {\n        \"strategy_type\": \"è¿›å–\",\n        \"allocation\": \"10-20%\
            \ å¯ç”¨èµ„é‡‘\",\n        \"rationale\": \"æœŸæœ›å€¼æ­£å‘ï¼Œä½œä¸ºæ–¹å‘æ€§è¡¥å……ï¼Œä¸¥æ ¼æ­¢æŸ\"\n    },\n   \
            \ \"avoid\": {\n        \"strategy_type\": \"ä¿å®ˆ\",\n        \"reason\"\
            : \"æœŸæœ›å€¼è´Ÿä¸”å‰§æœ¬ä¸åŒ¹é…\"\n    }\n    }\n    }\n```\n        \n---\n        \n\
            ## å…³é”®æ³¨æ„äº‹é¡¹\n\n\n1. **EV å¿…é¡»æ­£å‘**ï¼šæœŸæœ›å€¼ â‰¤ 0 çš„ç­–ç•¥ç›´æ¥æ ‡è®°ä¸º\"ä¸æ¨è\"\n2. **Pw æ ¼å¼å¤„ç†**ï¼šAgent\
            \ 6 å¯èƒ½è¾“å‡º \"68%\"ã€\"çº¦ 40%\"ã€\"35-50%\"ï¼Œéœ€æ­£ç¡®è§£æ\n3. **MaxProfit ç‰¹æ®Šå€¼**ï¼šè¿›å–ç­–ç•¥å¯èƒ½ä¸º\
            \ \"ç†è®ºæ— é™\"ï¼Œéœ€ç‰¹æ®Šå¤„ç†\n4. **æµåŠ¨æ€§ä¼˜å…ˆ**ï¼šæµåŠ¨æ€§ä¸é€šè¿‡çš„ç­–ç•¥é™çº§ï¼Œå³ä½¿ EV å¾ˆé«˜\n5. **å‰§æœ¬ä¸€è‡´æ€§**ï¼šä¼˜å…ˆæ¨èä¸ä¸»å¯¼å‰§æœ¬åŒ¹é…çš„ç­–ç•¥\n\
            6. **æ•°å€¼ç²¾åº¦**ï¼šEV ä¿ç•™ 2 ä½å°æ•°ï¼ŒRAR ä¿ç•™ 3 ä½å°æ•°\n\n---\n\nç°åœ¨è¯·åŸºäºè¾“å…¥æ•°æ®è¿›è¡Œç­–ç•¥å¯¹æ¯”å’Œæ’åºã€‚"
        - id: d6ff96ac-f577-4cdf-ac82-a19f6ce22151
          role: user
          text: "è¯·å¯¹ä»¥ä¸‹ç­–ç•¥è¿›è¡Œé‡åŒ–å¯¹æ¯”å’Œæ’åºã€‚\n        \nã€å¸‚åœºçŠ¶æ€ã€‘\n- æ ‡çš„ï¼š{{#3001.text.targets.symbol#}}\n\
            - ç°ä»·ï¼š{{#3001.text.targets.spot_price#}}\n- EM1$ï¼š{{#3001.text.targets.em1_dollar#}}\n\
            - ä¸»å¯¼å‰§æœ¬ï¼š{{#5001.text.scenario_classification.primary_scenario#}}\n- å‰§æœ¬æ¦‚ç‡ï¼š{{#5001.text.scenario_classification.scenario_probability#}}%\n\
            ã€ç­–ç•¥åˆ—è¡¨ã€‘ {{#6001.text#}}\nè¯·ä¸¥æ ¼æŒ‰ç…§ç³»ç»Ÿæç¤ºçš„é€»è¾‘è¿›è¡Œè®¡ç®—å’Œæ’åºï¼Œè¾“å‡ºå®Œæ•´çš„ JSON ç»“æœã€‚\n"
        selected: true
        title: AGENT 7 ç­–ç•¥å¯¹æ¯”
        type: llm
        vision:
          enabled: false
      height: 116
      id: '1005'
      position:
        x: 3195.5721415064195
        y: 202.92482559236925
      positionAbsolute:
        x: 3195.5721415064195
        y: 202.92482559236925
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "import json\nfrom typing import Dict, Any, Optional\n\n\ndef main(agent3_output:\
          \ str, agent5_output: str, agent4_output: str = \"\", **env_vars) -> dict:\n\
          \    \"\"\"\n    Agent 6 ç­–ç•¥è®¡ç®—è¾…åŠ©å‡½æ•°\n    \n    Args:\n        agent3_output:\
          \ Agent 3 çš„æ•°æ®æ ¡éªŒç»“æœ JSON\n        agent5_output: Agent 5 çš„å‰§æœ¬åˆ†æç»“æœ JSON\n  \
          \      agent4_output: Agent 4 çš„æŠ€æœ¯é¢åˆ†æç»“æœ JSON (å¯é€‰)\n        **env_vars: ç¯å¢ƒå˜é‡å­—å…¸\n\
          \        \n    Returns:\n        {\"result\": ç­–ç•¥è®¡ç®—è¾…åŠ©ç»“æœ JSON å­—ç¬¦ä¸²}\n    \"\
          \"\"\n    try:\n        agent3_data = json.loads(agent3_output)\n      \
          \  agent5_data = json.loads(agent5_output)\n        \n        technical_score\
          \ = 0\n        if agent4_output:\n            try:\n                agent4_data\
          \ = json.loads(agent4_output)\n                technical_score = agent4_data.get(\"\
          ta_score\", 0)\n            except:\n                technical_score = 0\n\
          \        \n        calculator = StrategyCalculator(env_vars)\n        result\
          \ = calculator.process(agent3_data, agent5_data, technical_score)\n    \
          \    \n        return {\n            \"result\": json.dumps(result, ensure_ascii=False,\
          \ indent=2)\n        }\n        \n    except Exception as e:\n        return\
          \ {\n            \"result\": json.dumps({\n                \"error\": True,\n\
          \                \"error_message\": str(e)\n            }, ensure_ascii=False,\
          \ indent=2)\n        }\n\n\nclass StrategyCalculator:\n    \"\"\"ç­–ç•¥è®¡ç®—å¼•æ“\"\
          \"\"\n    \n    def __init__(self, env_vars: Dict[str, Any]):\n        \"\
          \"\"åˆå§‹åŒ–ç¯å¢ƒå˜é‡\"\"\"\n        self.env = self._parse_env_vars(env_vars)\n \
          \   \n    def _parse_env_vars(self, env_vars: Dict[str, Any]) -> Dict[str,\
          \ float]:\n        \"\"\"è§£æç¯å¢ƒå˜é‡å¹¶è®¾ç½®é»˜è®¤å€¼\"\"\"\n        defaults = {\n    \
          \        # Greeks ç›®æ ‡èŒƒå›´\n            'CONSERVATIVE_DELTA_MIN': -0.1,\n  \
          \          'CONSERVATIVE_DELTA_MAX': 0.1,\n            'CONSERVATIVE_THETA_MIN':\
          \ 5.0,\n            'CONSERVATIVE_VEGA_MAX': -10.0,\n            'BALANCED_DELTA_RANGE':\
          \ 0.2,\n            'BALANCED_THETA_MIN': 8.0,\n            'AGGRESSIVE_DELTA_MIN':\
          \ 0.3,\n            'AGGRESSIVE_DELTA_MAX': 0.6,\n            'AGGRESSIVE_VEGA_MIN':\
          \ 10.0,\n            \n            # DTE é€‰æ‹©\n            'DTE_GAP_HIGH_THRESHOLD':\
          \ 3.0,\n            'DTE_GAP_MID_THRESHOLD': 2.0,\n            'DTE_MONTHLY_ADJUSTMENT':\
          \ 7,\n            \n            # è¡Œæƒä»·åç§»\n            'STRIKE_CONSERVATIVE_LONG_OFFSET':\
          \ 1.5,\n            'STRIKE_BALANCED_WING_OFFSET': 1.0,\n            'STRIKE_RATIO_SHORT_OFFSET':\
          \ 0.5,\n            'STRIKE_RATIO_LONG_OFFSET': 1.5,\n            'STRIKE_AGGRESSIVE_LONG_OFFSET':\
          \ 0.2,\n            \n            # ä»·å·®å®½åº¦\n            'WIDTH_CREDIT_MIN':\
          \ 0.8,\n            'WIDTH_CREDIT_MAX': 1.0,\n            'WIDTH_DEBIT_MIN':\
          \ 1.0,\n            'WIDTH_DEBIT_MAX': 1.2,\n            \n            #\
          \ RR è®¡ç®— - ä¿¡ç”¨ IVR æ˜ å°„\n            'CREDIT_IVR_0_25': 0.20,\n            'CREDIT_IVR_25_50':\
          \ 0.30,\n            'CREDIT_IVR_50_75': 0.40,\n            'CREDIT_IVR_75_100':\
          \ 0.50,\n            \n            # RR è®¡ç®— - å€Ÿè´· IVR æ˜ å°„\n            'DEBIT_IVR_0_40':\
          \ 0.30,\n            'DEBIT_IVR_40_70': 0.40,\n            'DEBIT_IVR_70_100':\
          \ 0.50,\n            \n            # Pw è®¡ç®— - ä¿¡ç”¨\n            'PW_CREDIT_BASE':\
          \ 0.5,\n            'PW_CREDIT_CLUSTER_COEF': 0.1,\n            'PW_CREDIT_DISTANCE_PENALTY_COEF':\
          \ 0.05,\n            'PW_CREDIT_MIN': 0.4,\n            'PW_CREDIT_MAX':\
          \ 0.85,\n            \n            # Pw è®¡ç®— - å€Ÿè´·\n            'PW_DEBIT_BASE':\
          \ 0.3,\n            'PW_DEBIT_DEX_COEF': 0.1,\n            'PW_DEBIT_VANNA_COEF':\
          \ 0.2,\n            'PW_DEBIT_VANNA_WEIGHT_HIGH': 1.0,\n            'PW_DEBIT_VANNA_WEIGHT_MEDIUM':\
          \ 0.6,\n            'PW_DEBIT_VANNA_WEIGHT_LOW': 0.3,\n            'PW_DEBIT_MIN':\
          \ 0.25,\n            'PW_DEBIT_MAX': 0.75,\n            \n            #\
          \ Pw è®¡ç®— - è¶å¼\n            'PW_BUTTERFLY_BODY_INSIDE': 0.65,\n          \
          \  'PW_BUTTERFLY_BODY_OFFSET_1EM': 0.45,\n            \n            # æ­¢ç›ˆæ­¢æŸ\n\
          \            'PROFIT_TARGET_CREDIT_PCT': 30,\n            'PROFIT_TARGET_DEBIT_PCT':\
          \ 60,\n            'STOP_LOSS_DEBIT_PCT': 50,\n            'STOP_LOSS_CREDIT_PCT':\
          \ 150,\n            'TIME_DECAY_EXIT_DAYS': 3,\n            \n         \
          \   # é£é™©ç®¡ç†\n            'MAX_SINGLE_RISK_PCT': 2,\n        }\n        \n\
          \        parsed = {}\n        for key, default_value in defaults.items():\n\
          \            value = env_vars.get(key, default_value)\n            try:\n\
          \                parsed[key] = float(value)\n            except (ValueError,\
          \ TypeError):\n                parsed[key] = default_value\n        \n \
          \       return parsed\n    \n    # ============= 1. è¡Œæƒä»·è®¡ç®— =============\n\
          \    \n    def calculate_strikes(self, spot: float, em1: float, walls: Dict)\
          \ -> Dict:\n        \"\"\"\n        è®¡ç®—å„ç­–ç•¥çš„è¡Œæƒä»·\n        \n        Args:\n\
          \            spot: ç°ä»·\n            em1: EM1$ é¢„æœŸå•æ—¥æ³¢å¹…\n            walls:\
          \ å¢™ä½ä¿¡æ¯ {call_wall, put_wall, major_wall}\n        \n        Returns:\n \
          \           å„ç­–ç•¥çš„è¡Œæƒä»·å­—å…¸\n        \"\"\"\n        call_wall = walls.get(\"\
          call_wall\", spot * 1.05)\n        put_wall = walls.get(\"put_wall\", spot\
          \ * 0.95)\n        \n        return {\n            \"iron_condor\": {\n\
          \                \"short_call\": round(call_wall, 2),\n                \"\
          long_call\": round(call_wall + self.env['STRIKE_CONSERVATIVE_LONG_OFFSET']\
          \ * em1, 2),\n                \"short_put\": round(put_wall, 2),\n     \
          \           \"long_put\": round(put_wall - self.env['STRIKE_CONSERVATIVE_LONG_OFFSET']\
          \ * em1, 2),\n                \"width_call\": round(self.env['STRIKE_CONSERVATIVE_LONG_OFFSET']\
          \ * em1, 2),\n                \"width_put\": round(self.env['STRIKE_CONSERVATIVE_LONG_OFFSET']\
          \ * em1, 2)\n            },\n            \"iron_butterfly\": {\n       \
          \         \"body\": round(spot, 2),\n                \"call_wing\": round(spot\
          \ + self.env['STRIKE_BALANCED_WING_OFFSET'] * em1, 2),\n               \
          \ \"put_wing\": round(spot - self.env['STRIKE_BALANCED_WING_OFFSET'] * em1,\
          \ 2),\n                \"wing_width\": round(self.env['STRIKE_BALANCED_WING_OFFSET']\
          \ * em1, 2)\n            },\n            \"bull_call_spread\": {\n     \
          \           \"long_call\": round(spot + self.env['STRIKE_AGGRESSIVE_LONG_OFFSET']\
          \ * em1, 2),\n                \"short_call\": round(call_wall, 2),\n   \
          \             \"width\": round(call_wall - (spot + self.env['STRIKE_AGGRESSIVE_LONG_OFFSET']\
          \ * em1), 2)\n            },\n            \"bear_put_spread\": {\n     \
          \           \"long_put\": round(spot - self.env['STRIKE_AGGRESSIVE_LONG_OFFSET']\
          \ * em1, 2),\n                \"short_put\": round(put_wall, 2),\n     \
          \           \"width\": round((spot - self.env['STRIKE_AGGRESSIVE_LONG_OFFSET']\
          \ * em1) - put_wall, 2)\n            },\n            \"bull_put_spread\"\
          : {\n                \"long_put\": round(put_wall - self.env['STRIKE_CONSERVATIVE_LONG_OFFSET']\
          \ * em1, 2),\n                \"short_put\": round(put_wall, 2),\n     \
          \           \"width\": round(self.env['STRIKE_CONSERVATIVE_LONG_OFFSET']\
          \ * em1, 2)\n            },\n            \"bear_call_spread\": {\n     \
          \           \"long_call\": round(call_wall + self.env['STRIKE_CONSERVATIVE_LONG_OFFSET']\
          \ * em1, 2),\n                \"short_call\": round(call_wall, 2),\n   \
          \             \"width\": round(self.env['STRIKE_CONSERVATIVE_LONG_OFFSET']\
          \ * em1, 2)\n            },\n            \"call_ratio_spread\": {\n    \
          \            \"long_call\": round(spot + self.env['STRIKE_RATIO_SHORT_OFFSET']\
          \ * em1, 2),\n                \"short_call\": round(spot + self.env['STRIKE_RATIO_LONG_OFFSET']\
          \ * em1, 2),\n                \"ratio\": \"1:2\"\n            },\n     \
          \       \"put_ratio_spread\": {\n                \"long_put\": round(spot\
          \ - self.env['STRIKE_RATIO_SHORT_OFFSET'] * em1, 2),\n                \"\
          short_put\": round(spot - self.env['STRIKE_RATIO_LONG_OFFSET'] * em1, 2),\n\
          \                \"ratio\": \"1:2\"\n            },\n            \"long_call\"\
          : {\n                \"strike\": round(spot + self.env['STRIKE_AGGRESSIVE_LONG_OFFSET']\
          \ * em1, 2)\n            },\n            \"long_put\": {\n             \
          \   \"strike\": round(spot - self.env['STRIKE_AGGRESSIVE_LONG_OFFSET'] *\
          \ em1, 2)\n            }\n        }\n    \n    # ============= 2. DTE è®¡ç®—\
          \ =============\n    \n    def calculate_dte(self, gap_distance_em1: float,\
          \ monthly_override: bool) -> Dict:\n        \"\"\"\n        åŠ¨æ€ DTE è®¡ç®—\n\
          \        \n        Args:\n            gap_distance_em1: gap è·ç¦»ï¼ˆEM1$ å€æ•°ï¼‰\n\
          \            monthly_override: æ˜¯å¦æœˆåº¦å åŠ \n        \n        Returns:\n    \
          \        DTE ä¿¡æ¯å­—å…¸\n        \"\"\"\n        # åŸºç¡€è§„åˆ™\n        if gap_distance_em1\
          \ > self.env['DTE_GAP_HIGH_THRESHOLD']:\n            base_dte = 14\n   \
          \         gap_level = \"high\"\n        elif gap_distance_em1 >= self.env['DTE_GAP_MID_THRESHOLD']:\n\
          \            base_dte = 10\n            gap_level = \"mid\"\n        else:\n\
          \            base_dte = 7\n            gap_level = \"low\"\n        \n \
          \       # æœˆåº¦è°ƒæ•´\n        if monthly_override:\n            adjustment = int(self.env['DTE_MONTHLY_ADJUSTMENT'])\n\
          \            final_dte = base_dte + adjustment\n            rationale =\
          \ f\"gap_distance_em1={gap_distance_em1:.2f}>{self.env['DTE_GAP_HIGH_THRESHOLD']if\
          \ gap_level=='high' else f'åœ¨{self.env['DTE_GAP_MID_THRESHOLD']}-{self.env['DTE_GAP_HIGH_THRESHOLD']}'\
          \ if gap_level=='mid' else f'<{self.env['DTE_GAP_MID_THRESHOLD']}'}é€‰æ‹©{base_dte}æ—¥DTEï¼Œæœˆåº¦å åŠ +{adjustment}æ—¥={final_dte}æ—¥\"\
          \n        else:\n            final_dte = base_dte\n            rationale\
          \ = f\"gap_distance_em1={gap_distance_em1:.2f}é€‰æ‹©{final_dte}æ—¥DTEï¼Œæ— æœˆåº¦å åŠ \"\n\
          \        \n        return {\n            \"base_dte\": base_dte,\n     \
          \       \"final_dte\": final_dte,\n            \"gap_level\": gap_level,\n\
          \            \"monthly_override\": monthly_override,\n            \"rationale\"\
          : rationale\n        }\n    \n    # ============= 3. RR ç›ˆäºæ¯”è®¡ç®— =============\n\
          \    \n    def calculate_rr_credit(self, width: float, ivr: float = 40)\
          \ -> Dict:\n        \"\"\"\n        ä¿¡ç”¨ä»·å·® RR è®¡ç®—\n        \n        Args:\n\
          \            width: ä»·å·®å®½åº¦\n            ivr: éšå«æ³¢åŠ¨ç‡ç™¾åˆ†ä½ï¼ˆ0-100ï¼‰\n        \n \
          \       Returns:\n            RR è®¡ç®—ç»“æœ\n        \"\"\"\n        # IVR æ˜ å°„\n\
          \        if ivr <= 25:\n            credit_ratio = self.env['CREDIT_IVR_0_25']\n\
          \            ivr_range = \"0-25%\"\n        elif ivr <= 50:\n          \
          \  credit_ratio = self.env['CREDIT_IVR_25_50']\n            ivr_range =\
          \ \"25-50%\"\n        elif ivr <= 75:\n            credit_ratio = self.env['CREDIT_IVR_50_75']\n\
          \            ivr_range = \"50-75%\"\n        else:\n            credit_ratio\
          \ = self.env['CREDIT_IVR_75_100']\n            ivr_range = \"75-100%\"\n\
          \        \n        credit = width * credit_ratio\n        max_loss = width\
          \ - credit\n        \n        # æ ¼å¼åŒ– RR æ¯”ç‡\n        if credit > 0:\n    \
          \        rr_simplified = f\"1:{max_loss/credit:.1f}\"\n        else:\n \
          \           rr_simplified = \"N/A\"\n        \n        formula = f\"Width={width:.2f},\
          \ IVR={ivr}%åœ¨{ivr_range}â†’credit_ratio={credit_ratio}, Credit={credit:.2f},\
          \ MaxLoss={max_loss:.2f}, RR={credit:.2f}:{max_loss:.2f}\"\n        \n \
          \       return {\n            \"width\": round(width, 2),\n            \"\
          ivr\": ivr,\n            \"ivr_range\": ivr_range,\n            \"credit_ratio\"\
          : credit_ratio,\n            \"credit\": round(credit, 2),\n           \
          \ \"max_profit\": round(credit, 2),\n            \"max_loss\": round(max_loss,\
          \ 2),\n            \"rr_ratio\": rr_simplified,\n            \"formula\"\
          : formula\n        }\n    \n    def calculate_rr_debit(self, width: float,\
          \ ivr: float = 40) -> Dict:\n        \"\"\"\n        å€Ÿè´·ä»·å·® RR è®¡ç®—\n      \
          \  \n        Args:\n            width: ä»·å·®å®½åº¦\n            ivr: éšå«æ³¢åŠ¨ç‡ç™¾åˆ†ä½ï¼ˆ0-100ï¼‰\n\
          \        \n        Returns:\n            RR è®¡ç®—ç»“æœ\n        \"\"\"\n     \
          \   # IVR æ˜ å°„\n        if ivr <= 40:\n            debit_ratio = self.env['DEBIT_IVR_0_40']\n\
          \            ivr_range = \"0-40%\"\n        elif ivr <= 70:\n          \
          \  debit_ratio = self.env['DEBIT_IVR_40_70']\n            ivr_range = \"\
          40-70%\"\n        else:\n            debit_ratio = self.env['DEBIT_IVR_70_100']\n\
          \            ivr_range = \"70-100%\"\n        \n        debit = width *\
          \ debit_ratio\n        max_profit = width - debit\n        \n        # æ ¼å¼åŒ–\
          \ RR æ¯”ç‡\n        if debit > 0:\n            rr_simplified = f\"{max_profit/debit:.1f}:1\"\
          \n        else:\n            rr_simplified = \"N/A\"\n        \n       \
          \ formula = f\"Width={width:.2f}, IVR={ivr}%åœ¨{ivr_range}â†’debit_ratio={debit_ratio},\
          \ Debit={debit:.2f}, MaxProfit={max_profit:.2f}, RR={max_profit:.2f}:{debit:.2f}\"\
          \n        \n        return {\n            \"width\": round(width, 2),\n\
          \            \"ivr\": ivr,\n            \"ivr_range\": ivr_range,\n    \
          \        \"debit_ratio\": debit_ratio,\n            \"debit\": round(debit,\
          \ 2),\n            \"max_profit\": round(max_profit, 2),\n            \"\
          max_loss\": round(debit, 2),\n            \"rr_ratio\": rr_simplified,\n\
          \            \"formula\": formula\n        }\n    \n    # =============\
          \ 4. Pw èƒœç‡è®¡ç®— =============\n    \n    def calculate_pw_credit(self, cluster_strength:\
          \ float, gap_distance_em1: float, \n                           technical_score:\
          \ float = 0) -> Dict:\n        \"\"\"\n        ä¿¡ç”¨ä»·å·®èƒœç‡è®¡ç®—\n        \n    \
          \    Args:\n            cluster_strength: ç°‡å¼ºåº¦æ¯”ç‡\n            gap_distance_em1:\
          \ gap è·ç¦»ï¼ˆEM1$ å€æ•°ï¼‰\n            technical_score: æŠ€æœ¯é¢è¯„åˆ†ï¼ˆ0-2ï¼‰\n        \n \
          \       Returns:\n            Pw è®¡ç®—ç»“æœ\n        \"\"\"\n        base = self.env['PW_CREDIT_BASE']\n\
          \        cluster_adj = self.env['PW_CREDIT_CLUSTER_COEF'] * cluster_strength\n\
          \        distance_penalty = self.env['PW_CREDIT_DISTANCE_PENALTY_COEF']\
          \ * gap_distance_em1\n        \n        pw_raw = base + cluster_adj - distance_penalty\n\
          \        \n        # æŠ€æœ¯é¢æå‡\n        technical_boost = 0.05 * technical_score\
          \ if technical_score > 0 else 0\n        \n        # é™åˆ¶èŒƒå›´\n        pw_adjusted\
          \ = max(self.env['PW_CREDIT_MIN'], \n                          min(self.env['PW_CREDIT_MAX'],\
          \ \n                              pw_raw + technical_boost))\n        \n\
          \        formula = f\"base {base} + cluster {cluster_adj:.3f} - distance\
          \ {distance_penalty:.3f} + technical {technical_boost:.2f} = {pw_adjusted:.2f}\"\
          \n        \n        return {\n            \"base\": base,\n            \"\
          cluster_strength\": cluster_strength,\n            \"cluster_adj\": round(cluster_adj,\
          \ 3),\n            \"gap_distance_em1\": gap_distance_em1,\n           \
          \ \"distance_penalty\": round(distance_penalty, 3),\n            \"technical_score\"\
          : technical_score,\n            \"technical_boost\": round(technical_boost,\
          \ 2),\n            \"pw_raw\": round(pw_raw, 3),\n            \"pw_adjusted\"\
          : round(pw_adjusted, 2),\n            \"pw_estimate\": f\"{int(pw_adjusted\
          \ * 100)}%\",\n            \"formula\": formula\n        }\n    \n    def\
          \ calculate_pw_debit(self, dex_same_dir_pct: float, vanna_confidence: str,\
          \ \n                          gap_distance_em1: float) -> Dict:\n      \
          \  \"\"\"\n        å€Ÿè´·ä»·å·®èƒœç‡è®¡ç®—\n        \n        Args:\n            dex_same_dir_pct:\
          \ DEX åŒå‘ç™¾åˆ†æ¯”ï¼ˆ0-100ï¼‰\n            vanna_confidence: Vanna ç½®ä¿¡åº¦ï¼ˆhigh/medium/lowï¼‰\n\
          \            gap_distance_em1: gap è·ç¦»ï¼ˆEM1$ å€æ•°ï¼‰\n        \n        Returns:\n\
          \            Pw è®¡ç®—ç»“æœ\n        \"\"\"\n        # Vanna æƒé‡\n        vanna_weight_map\
          \ = {\n            'high': self.env['PW_DEBIT_VANNA_WEIGHT_HIGH'],\n   \
          \         'medium': self.env['PW_DEBIT_VANNA_WEIGHT_MEDIUM'],\n        \
          \    'low': self.env['PW_DEBIT_VANNA_WEIGHT_LOW']\n        }\n        vanna_weight\
          \ = vanna_weight_map.get(vanna_confidence, self.env['PW_DEBIT_VANNA_WEIGHT_LOW'])\n\
          \        \n        # åŸºç¡€è®¡ç®—\n        base = self.env['PW_DEBIT_BASE']\n  \
          \      dex_adj = self.env['PW_DEBIT_DEX_COEF'] * (dex_same_dir_pct / 100)\n\
          \        vanna_adj = vanna_weight * self.env['PW_DEBIT_VANNA_COEF']\n  \
          \      \n        pw_raw = base + dex_adj + vanna_adj\n        \n       \
          \ # gap è·ç¦»æƒ©ç½š\n        if gap_distance_em1 > 3:\n            gap_penalty\
          \ = -0.05\n        elif gap_distance_em1 > 2:\n            gap_penalty =\
          \ -0.03\n        else:\n            gap_penalty = 0\n        \n        #\
          \ é™åˆ¶èŒƒå›´\n        pw_adjusted = max(self.env['PW_DEBIT_MIN'], \n         \
          \                 min(self.env['PW_DEBIT_MAX'], \n                     \
          \         pw_raw + gap_penalty))\n        \n        formula = f\"base {base}\
          \ + dex {dex_adj:.3f} + vanna {vanna_adj:.2f} + gap_penalty {gap_penalty:.2f}\
          \ = {pw_adjusted:.2f}\"\n        \n        return {\n            \"base\"\
          : base,\n            \"dex_same_dir_pct\": dex_same_dir_pct,\n         \
          \   \"dex_adj\": round(dex_adj, 3),\n            \"vanna_confidence\": vanna_confidence,\n\
          \            \"vanna_weight\": vanna_weight,\n            \"vanna_adj\"\
          : round(vanna_adj, 2),\n            \"gap_distance_em1\": gap_distance_em1,\n\
          \            \"gap_penalty\": gap_penalty,\n            \"pw_raw\": round(pw_raw,\
          \ 3),\n            \"pw_adjusted\": round(pw_adjusted, 2),\n           \
          \ \"pw_estimate\": f\"{int(pw_adjusted * 100)}%\",\n            \"formula\"\
          : formula\n        }\n    \n    def calculate_pw_butterfly(self, spot: float,\
          \ body: float, em1: float, \n                               iv_path: str\
          \ = \"å¹³\") -> Dict:\n        \"\"\"\n        è¶å¼ç­–ç•¥èƒœç‡è®¡ç®—\n        \n      \
          \  Args:\n            spot: ç°ä»·\n            body: è¶å¼ä¸­å¿ƒä»·æ ¼\n            em1:\
          \ EM1$\n            iv_path: IV è·¯å¾„ï¼ˆå‡/é™/å¹³ï¼‰\n        \n        Returns:\n\
          \            Pw è®¡ç®—ç»“æœ\n        \"\"\"\n        distance_em1 = abs(spot -\
          \ body) / em1 if em1 > 0 else 0\n        \n        # åŸºç¡€èƒœç‡\n        if distance_em1\
          \ < 0.3:\n            pw_base = self.env['PW_BUTTERFLY_BODY_INSIDE']\n \
          \           distance_desc = \"spotåœ¨bodyå†…\"\n        elif distance_em1 <\
          \ 1.0:\n            pw_base = 0.55\n            distance_desc = \"è½»å¾®åç¦»\"\
          \n        else:\n            pw_base = self.env['PW_BUTTERFLY_BODY_OFFSET_1EM']\n\
          \            distance_desc = \"åç¦»1EM1$\"\n        \n        # IV è°ƒæ•´\n  \
          \      if iv_path == \"å‡\":\n            iv_adj = -0.05\n            iv_note\
          \ = \"IVæ‰©å¼ ä¸åˆ©è¶å¼\"\n        elif iv_path == \"é™\":\n            iv_adj = 0.05\n\
          \            iv_note = \"IVå‹ç¼©æœ‰åˆ©è¶å¼\"\n        else:\n            iv_adj =\
          \ 0\n            iv_note = \"IVç¨³å®š\"\n        \n        pw_adjusted = max(0.3,\
          \ min(0.75, pw_base + iv_adj))\n        \n        formula = f\"è·ç¦»body {distance_em1:.2f}Ã—EM1$({distance_desc})â†’base\
          \ {pw_base}, IVè·¯å¾„{iv_path}è°ƒæ•´{iv_adj:+.2f} = {pw_adjusted:.2f}\"\n      \
          \  \n        return {\n            \"spot\": spot,\n            \"body\"\
          : body,\n            \"distance_em1\": round(distance_em1, 2),\n       \
          \     \"distance_desc\": distance_desc,\n            \"iv_path\": iv_path,\n\
          \            \"iv_adj\": iv_adj,\n            \"iv_note\": iv_note,\n  \
          \          \"pw_base\": pw_base,\n            \"pw_adjusted\": round(pw_adjusted,\
          \ 2),\n            \"pw_estimate\": f\"{int(pw_adjusted * 100)}%\",\n  \
          \          \"formula\": formula\n        }\n    \n    # ============= 5.\
          \ Greeks èŒƒå›´ =============\n    \n    def get_greeks_ranges(self) -> Dict:\n\
          \        \"\"\"\n        è·å–å„ç­–ç•¥ç±»å‹çš„ Greeks ç›®æ ‡èŒƒå›´\n        \n        Returns:\n\
          \            Greeks èŒƒå›´å­—å…¸\n        \"\"\"\n        return {\n           \
          \ \"conservative\": {\n                \"delta_min\": self.env['CONSERVATIVE_DELTA_MIN'],\n\
          \                \"delta_max\": self.env['CONSERVATIVE_DELTA_MAX'],\n  \
          \              \"theta_min\": self.env['CONSERVATIVE_THETA_MIN'],\n    \
          \            \"vega_max\": self.env['CONSERVATIVE_VEGA_MAX'],\n        \
          \        \"description\": \"ä¿å®ˆç­–ç•¥ï¼šæ¥è¿‘ä¸­æ€§Deltaï¼Œæ­£Thetaæ”¶ç›Šï¼Œè´ŸVegaåšç©ºæ³¢åŠ¨ç‡\"\n     \
          \       },\n            \"balanced\": {\n                \"delta_range\"\
          : self.env['BALANCED_DELTA_RANGE'],\n                \"theta_min\": self.env['BALANCED_THETA_MIN'],\n\
          \                \"vega_range\": [-5, 5],\n                \"description\"\
          : \"å‡è¡¡ç­–ç•¥ï¼šè½»å¾®æ–¹å‘æ•å£Â±Delta_rangeï¼Œæ­£Thetaï¼ŒVegaä¸­æ€§\"\n            },\n          \
          \  \"aggressive\": {\n                \"delta_min\": self.env['AGGRESSIVE_DELTA_MIN'],\n\
          \                \"delta_max\": self.env['AGGRESSIVE_DELTA_MAX'],\n    \
          \            \"vega_min\": self.env['AGGRESSIVE_VEGA_MIN'],\n          \
          \      \"description\": \"è¿›å–ç­–ç•¥ï¼šæ˜ç¡®æ–¹å‘Delta 0.3-0.6ï¼ŒThetaå¯ä¸ºè´Ÿï¼Œæ­£Vegaåšå¤šæ³¢åŠ¨ç‡\"\n\
          \            }\n        }\n    \n    # ============= 6. æ­¢ç›ˆæ­¢æŸå‚æ•° =============\n\
          \    \n    def get_exit_parameters(self) -> Dict:\n        \"\"\"\n    \
          \    è·å–æ­¢ç›ˆæ­¢æŸå‚æ•°\n        \n        Returns:\n            æ­¢ç›ˆæ­¢æŸå‚æ•°å­—å…¸\n      \
          \  \"\"\"\n        return {\n            \"credit_strategies\": {\n    \
          \            \"profit_target_pct\": int(self.env['PROFIT_TARGET_CREDIT_PCT']),\n\
          \                \"stop_loss_pct\": int(self.env['STOP_LOSS_CREDIT_PCT']),\n\
          \                \"time_decay_exit_days\": int(self.env['TIME_DECAY_EXIT_DAYS']),\n\
          \                \"description\": f\"ä¿¡ç”¨ç­–ç•¥ï¼šæƒåˆ©é‡‘è¡°å‡è‡³{int(self.env['PROFIT_TARGET_CREDIT_PCT'])}%æ­¢ç›ˆï¼Œæµ®äº{int(self.env['STOP_LOSS_CREDIT_PCT'])}%æ­¢æŸ\"\
          \n            },\n            \"debit_strategies\": {\n                \"\
          profit_target_pct\": int(self.env['PROFIT_TARGET_DEBIT_PCT']),\n       \
          \         \"stop_loss_pct\": int(self.env['STOP_LOSS_DEBIT_PCT']),\n   \
          \             \"time_decay_exit_days\": int(self.env['TIME_DECAY_EXIT_DAYS']),\n\
          \                \"description\": f\"å€Ÿè´·ç­–ç•¥ï¼šæµ®ç›ˆ{int(self.env['PROFIT_TARGET_DEBIT_PCT'])}%æ­¢ç›ˆï¼ŒäºæŸ{int(self.env['STOP_LOSS_DEBIT_PCT'])}%æ­¢æŸ\"\
          \n            },\n            \"time_management\": {\n                \"\
          exit_days_before_expiry\": int(self.env['TIME_DECAY_EXIT_DAYS']),\n    \
          \            \"description\": f\"æ—¶é—´ç®¡ç†ï¼šåˆ°æœŸå‰{int(self.env['TIME_DECAY_EXIT_DAYS'])}æ—¥å¹³ä»“é¿å…Pin\
          \ Risk\"\n            }\n        }\n    \n    # ============= ä¸»å¤„ç†å‡½æ•° =============\n\
          \    \n    def process(self, agent3_data: Dict, agent5_data: Dict, technical_score:\
          \ float = 0) -> Dict:\n        \"\"\"\n        ä¸»å¤„ç†æµç¨‹\n        \n       \
          \ Args:\n            agent3_data: Agent 3 æ•°æ®\n            agent5_data: Agent\
          \ 5 æ•°æ®\n            technical_score: æŠ€æœ¯é¢è¯„åˆ†\n        \n        Returns:\n\
          \            å®Œæ•´è®¡ç®—ç»“æœ\n        \"\"\"\n        \n        # ç›´æ¥ä»æ ¹èŠ‚ç‚¹è·å–æ•°æ®ï¼ˆä¸å†å¤„ç†\
          \ targets æ•°ç»„ï¼‰\n        spot = agent3_data.get(\"spot_price\", 0)\n     \
          \   em1 = agent3_data.get(\"em1_dollar\", 0)\n        walls = agent3_data.get(\"\
          walls\", {})\n        gamma_metrics = agent3_data.get(\"gamma_metrics\"\
          , {})\n        directional_metrics = agent3_data.get(\"directional_metrics\"\
          , {})\n        \n        # æ ¡éªŒå¿…éœ€å­—æ®µ\n        if spot == 0 or em1 == 0:\n \
          \           raise ValueError(\"Agent 3 æ•°æ®ç¼ºå¤±å…³é”®å­—æ®µï¼šspot_price æˆ– em1_dollar\"\
          )\n        \n        # Agent 5 æ•°æ®\n        scenario = agent5_data.get(\"\
          scenario_classification\", {})\n        \n        # æ‰§è¡Œè®¡ç®—\n        strikes\
          \ = self.calculate_strikes(spot, em1, walls)\n        dte_info = self.calculate_dte(\n\
          \            gamma_metrics.get(\"gap_distance_em1_multiple\", 2.0),\n  \
          \          gamma_metrics.get(\"monthly_cluster_override\", False)\n    \
          \    )\n        \n        # ä¼°ç®— IVRï¼ˆç®€åŒ–å¤„ç†ï¼Œå®é™…åº”ä»å¸‚åœºæ•°æ®è·å–ï¼‰\n        ivr_estimate\
          \ = 40  # é»˜è®¤ä¸­ç­‰ IVR\n        \n        # RR è®¡ç®—ï¼ˆä½¿ç”¨å®é™…å®½åº¦ï¼‰\n        rr_credit_ic\
          \ = self.calculate_rr_credit(\n            strikes[\"iron_condor\"][\"width_call\"\
          ],\n            ivr_estimate\n        )\n        \n        rr_debit_bull\
          \ = self.calculate_rr_debit(\n            strikes[\"bull_call_spread\"][\"\
          width\"],\n            ivr_estimate\n        )\n        \n        # Pw è®¡ç®—\n\
          \        pw_credit = self.calculate_pw_credit(\n            gamma_metrics.get(\"\
          cluster_strength_ratio\", 1.5),\n            gamma_metrics.get(\"gap_distance_em1_multiple\"\
          , 2.0),\n            technical_score\n        )\n        \n        pw_debit\
          \ = self.calculate_pw_debit(\n            directional_metrics.get(\"dex_same_dir_pct\"\
          , 50),\n            directional_metrics.get(\"vanna_confidence\", \"medium\"\
          ),\n            gamma_metrics.get(\"gap_distance_em1_multiple\", 2.0)\n\
          \        )\n        \n        pw_butterfly = self.calculate_pw_butterfly(\n\
          \            spot,\n            spot,  # body åœ¨ç°ä»·\n            em1,\n  \
          \          directional_metrics.get(\"iv_path\", \"å¹³\")\n        )\n    \
          \    \n        # Greeks èŒƒå›´\n        greeks_ranges = self.get_greeks_ranges()\n\
          \        \n        # æ­¢ç›ˆæ­¢æŸå‚æ•°\n        exit_params = self.get_exit_parameters()\n\
          \        \n        # ç»„è£…ç»“æœ\n        result = {\n            # è¡Œæƒä»·ï¼ˆä¿ç•™ç»“æ„ï¼Œä¾›\
          \ Agent 6 é€‰æ‹©ï¼‰\n            \"strikes\": strikes,\n            \n       \
          \     # DTEï¼ˆæ‰å¹³åŒ–ï¼‰\n            \"dte_final\": dte_info[\"final_dte\"],\n\
          \            \"dte_rationale\": dte_info[\"rationale\"],\n            \"\
          dte_base\": dte_info[\"base_dte\"],\n            \"dte_gap_level\": dte_info[\"\
          gap_level\"],\n            \"dte_monthly_override\": dte_info[\"monthly_override\"\
          ],\n            \n            # RR - Iron Condorï¼ˆæ‰å¹³åŒ–ï¼‰\n            \"rr_ic_credit\"\
          : rr_credit_ic[\"credit\"],\n            \"rr_ic_max_profit\": rr_credit_ic[\"\
          max_profit\"],\n            \"rr_ic_max_loss\": rr_credit_ic[\"max_loss\"\
          ],\n            \"rr_ic_ratio\": rr_credit_ic[\"rr_ratio\"],\n         \
          \   \"rr_ic_formula\": rr_credit_ic[\"formula\"],\n            \"rr_ic_width\"\
          : rr_credit_ic[\"width\"],\n            \"rr_ic_ivr\": rr_credit_ic[\"ivr\"\
          ],\n            \n            # RR - Bull Call Spreadï¼ˆæ‰å¹³åŒ–ï¼‰\n           \
          \ \"rr_bull_debit\": rr_debit_bull[\"debit\"],\n            \"rr_bull_max_profit\"\
          : rr_debit_bull[\"max_profit\"],\n            \"rr_bull_max_loss\": rr_debit_bull[\"\
          max_loss\"],\n            \"rr_bull_ratio\": rr_debit_bull[\"rr_ratio\"\
          ],\n            \"rr_bull_formula\": rr_debit_bull[\"formula\"],\n     \
          \       \"rr_bull_width\": rr_debit_bull[\"width\"],\n            \n   \
          \         # Pw - Creditï¼ˆæ‰å¹³åŒ–ï¼‰\n            \"pw_credit_estimate\": pw_credit[\"\
          pw_estimate\"],\n            \"pw_credit_formula\": pw_credit[\"formula\"\
          ],\n            \"pw_credit_note\": pw_credit[\"pw_note\"],\n          \
          \  \"pw_credit_base\": pw_credit[\"base\"],\n            \"pw_credit_cluster_adj\"\
          : pw_credit[\"cluster_adj\"],\n            \"pw_credit_distance_penalty\"\
          : pw_credit[\"distance_penalty\"],\n            \"pw_credit_technical_boost\"\
          : pw_credit[\"technical_boost\"],\n            \"pw_credit_adjusted\": pw_credit[\"\
          pw_adjusted\"],\n            \n            # Pw - Debitï¼ˆæ‰å¹³åŒ–ï¼‰\n         \
          \   \"pw_debit_estimate\": pw_debit[\"pw_estimate\"],\n            \"pw_debit_formula\"\
          : pw_debit[\"formula\"],\n            \"pw_debit_note\": pw_debit[\"pw_note\"\
          ],\n            \"pw_debit_base\": pw_debit[\"base\"],\n            \"pw_debit_dex_adj\"\
          : pw_debit[\"dex_adj\"],\n            \"pw_debit_vanna_adj\": pw_debit[\"\
          vanna_adj\"],\n            \"pw_debit_gap_penalty\": pw_debit[\"gap_penalty\"\
          ],\n            \"pw_debit_adjusted\": pw_debit[\"pw_adjusted\"],\n    \
          \        \n            # Pw - Butterflyï¼ˆæ‰å¹³åŒ–ï¼‰\n            \"pw_butterfly_estimate\"\
          : pw_butterfly[\"pw_estimate\"],\n            \"pw_butterfly_formula\":\
          \ pw_butterfly[\"formula\"],\n            \"pw_butterfly_note\": pw_butterfly[\"\
          pw_note\"],\n            \"pw_butterfly_distance_em1\": pw_butterfly[\"\
          distance_em1\"],\n            \n            # Greeks - Conservativeï¼ˆæ‰å¹³åŒ–ï¼‰\n\
          \            \"greeks_conservative_delta_min\": greeks_ranges[\"conservative\"\
          ][\"delta_min\"],\n            \"greeks_conservative_delta_max\": greeks_ranges[\"\
          conservative\"][\"delta_max\"],\n            \"greeks_conservative_theta_min\"\
          : greeks_ranges[\"conservative\"][\"theta_min\"],\n            \"greeks_conservative_vega_max\"\
          : greeks_ranges[\"conservative\"][\"vega_max\"],\n            \"greeks_conservative_desc\"\
          : greeks_ranges[\"conservative\"][\"description\"],\n            \n    \
          \        # Greeks - Balancedï¼ˆæ‰å¹³åŒ–ï¼‰\n            \"greeks_balanced_delta_range\"\
          : greeks_ranges[\"balanced\"][\"delta_range\"],\n            \"greeks_balanced_theta_min\"\
          : greeks_ranges[\"balanced\"][\"theta_min\"],\n            \"greeks_balanced_desc\"\
          : greeks_ranges[\"balanced\"][\"description\"],\n            \n        \
          \    # Greeks - Aggressiveï¼ˆæ‰å¹³åŒ–ï¼‰\n            \"greeks_aggressive_delta_min\"\
          : greeks_ranges[\"aggressive\"][\"delta_min\"],\n            \"greeks_aggressive_delta_max\"\
          : greeks_ranges[\"aggressive\"][\"delta_max\"],\n            \"greeks_aggressive_vega_min\"\
          : greeks_ranges[\"aggressive\"][\"vega_min\"],\n            \"greeks_aggressive_desc\"\
          : greeks_ranges[\"aggressive\"][\"description\"],\n            \n      \
          \      # Exit Parameters - Creditï¼ˆæ‰å¹³åŒ–ï¼‰\n            \"exit_credit_profit_pct\"\
          : exit_params[\"credit_strategies\"][\"profit_target_pct\"],\n         \
          \   \"exit_credit_stop_pct\": exit_params[\"credit_strategies\"][\"stop_loss_pct\"\
          ],\n            \"exit_credit_time_days\": exit_params[\"credit_strategies\"\
          ][\"time_decay_exit_days\"],\n            \"exit_credit_desc\": exit_params[\"\
          credit_strategies\"][\"description\"],\n            \n            # Exit\
          \ Parameters - Debitï¼ˆæ‰å¹³åŒ–ï¼‰\n            \"exit_debit_profit_pct\": exit_params[\"\
          debit_strategies\"][\"profit_target_pct\"],\n            \"exit_debit_stop_pct\"\
          : exit_params[\"debit_strategies\"][\"stop_loss_pct\"],\n            \"\
          exit_debit_time_days\": exit_params[\"debit_strategies\"][\"time_decay_exit_days\"\
          ],\n            \"exit_debit_desc\": exit_params[\"debit_strategies\"][\"\
          description\"],\n            \n            # Exit Parameters - Timeï¼ˆæ‰å¹³åŒ–ï¼‰\n\
          \            \"exit_time_days\": exit_params[\"time_management\"][\"exit_days_before_expiry\"\
          ],\n            \"exit_time_desc\": exit_params[\"time_management\"][\"\
          description\"],\n            \n            # Metadataï¼ˆæ‰å¹³åŒ–ï¼‰\n           \
          \ \"meta_spot\": spot,\n            \"meta_em1\": em1,\n            \"meta_ivr\"\
          : ivr_estimate,\n            \"meta_technical_score\": technical_score,\n\
          \            \"meta_primary_scenario\": scenario.get(\"primary_scenario\"\
          , \"æœªçŸ¥\"),\n            \"meta_scenario_probability\": scenario.get(\"scenario_probability\"\
          , 0),\n            \"meta_gamma_regime\": agent5_data.get(\"gamma_regime\"\
          , {}).get(\"spot_vs_trigger\", \"unknown\")\n        }\n        \n     \
          \   return result"
        code_language: python3
        desc: ç­–ç•¥è¾…åŠ©è®¡ç®— 1006
        outputs:
          result:
            children: null
            type: string
        selected: false
        title: CODE3 Code Helper
        type: code
        variables:
        - value_selector:
          - '3001'
          - text
          value_type: string
          variable: agent3_output
        - value_selector:
          - '4001'
          - text
          value_type: string
          variable: agent4_output
        - value_selector:
          - '5001'
          - text
          value_type: string
          variable: agent5_output
      height: 80
      id: '1006'
      position:
        x: 2594.1154473752654
        y: 245.3277478801421
      positionAbsolute:
        x: 2594.1154473752654
        y: 245.3277478801421
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    viewport:
      x: -1823.9580554121467
      y: 75.20065237789754
      zoom: 0.8019031969575764
  rag_pipeline_variables: []
